[{"id":"373c5e3e.da3782","type":"tab","label":"Flow 1","disabled":false,"info":""},{"id":"51c21e98.03293","type":"tab","label":"WMS","disabled":true,"info":""},{"id":"76082a9f.b8c304","type":"tab","label":"DAS_Lam","disabled":true,"info":""},{"id":"33010803.e6c778","type":"tab","label":"DAS_Lam","disabled":false,"info":""},{"id":"656c9332.45ed8c","type":"ui_group","z":"","name":"Group 2","tab":"7c331462.6407ac","order":2,"disp":false,"width":"17","collapse":false},{"id":"4fa8196a.1f7818","type":"ui_group","z":"","name":"Group 2","tab":"7c331462.6407ac","order":2,"disp":true,"width":"35","collapse":false},{"id":"82d6eb50.a21208","type":"ui_group","z":"","name":"AGV SIM","tab":"7c331462.6407ac","order":1,"disp":false,"width":"35","collapse":false},{"id":"ce15c407.088b78","type":"MySQLdatabaseTSDV","z":0,"name":"","host":"127.0.0.1","port":"3306","user":"","db":"","tz":""},{"id":"7c331462.6407ac","type":"ui_tab","z":"","name":"DAS Dynamic","icon":"DAS Dynamic","disabled":false,"hidden":false},{"id":"bfb1b339.67dc9","type":"ui_group","z":"","name":"Group 2","tab":"e4520e74.158e7","order":2,"disp":false,"width":"17","collapse":false},{"id":"a56c3b1a.6c3818","type":"ui_group","z":"","name":"Group 2","tab":"e4520e74.158e7","order":2,"disp":true,"width":"35","collapse":false},{"id":"af8ce21.3f9db2","type":"ui_group","z":"","name":"AGV SIM","tab":"e4520e74.158e7","order":1,"disp":false,"width":"35","collapse":false},{"id":"d7565ef1.aea1a","type":"MySQLdatabaseTSDV","z":0,"name":"","host":"127.0.0.1","port":"3306","user":"","db":"","tz":""},{"id":"e4520e74.158e7","type":"ui_tab","z":"","name":"DAS Dynamic","icon":"DAS Dynamic","disabled":false,"hidden":false},{"id":"5d140a62.cc8934","type":"ui_base","theme":{"name":"theme-dark","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#097479","value":"#097479","edited":false},"page-titlebar-backgroundColor":{"value":"#097479","edited":false},"page-backgroundColor":{"value":"#111111","edited":false},"page-sidebar-backgroundColor":{"value":"#333333","edited":false},"group-textColor":{"value":"#0eb8c0","edited":false},"group-borderColor":{"value":"#555555","edited":false},"group-backgroundColor":{"value":"#333333","edited":false},"widget-textColor":{"value":"#eeeeee","edited":false},"widget-backgroundColor":{"value":"#097479","edited":false},"widget-borderColor":{"value":"#333333","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"4c405a11.d494a4","type":"ui_group","z":"","name":"Main","tab":"69ebaff6.3a466","order":2,"disp":true,"width":"11","collapse":false},{"id":"10d05305.f2742d","type":"ui_group","z":"","name":"Exception","tab":"69ebaff6.3a466","order":3,"disp":true,"width":"11","collapse":false},{"id":"a38733fe.8aa21","type":"ui_group","z":"","name":"Table Order List","tab":"69ebaff6.3a466","order":6,"disp":true,"width":"35","collapse":false},{"id":"4a9af7f4.510218","type":"ui_group","z":"","name":"Log All","tab":"69ebaff6.3a466","order":4,"disp":true,"width":"13","collapse":false},{"id":"f1595030.9867f","type":"ui_group","z":"","name":"Controlling Buttons","tab":"69ebaff6.3a466","order":1,"disp":false,"width":"35","collapse":false},{"id":"75f3b99c.ea9348","type":"ui_group","z":"","name":"Menu","tab":"69ebaff6.3a466","order":5,"disp":false,"width":"35","collapse":false},{"id":"e6ca46c4.db0ff8","type":"ui_group","z":"","name":"Table Products","tab":"69ebaff6.3a466","order":7,"disp":true,"width":"35","collapse":false},{"id":"69ebaff6.3a466","type":"ui_tab","z":"","name":"WMS0806","icon":"","order":11,"disabled":false,"hidden":false},{"id":"1df6f975.e48df7","type":"ui_group","z":"","name":"Main","tab":"29ddec71.8bc674","order":2,"disp":true,"width":"11","collapse":false},{"id":"241b56d1.3b12fa","type":"ui_group","z":"","name":"Exception","tab":"29ddec71.8bc674","order":3,"disp":true,"width":"11","collapse":false},{"id":"23b5a78.ab96f58","type":"ui_group","z":"","name":"Table Order List","tab":"29ddec71.8bc674","order":6,"disp":true,"width":"35","collapse":false},{"id":"b580a727.8bf078","type":"ui_group","z":"","name":"Log All","tab":"29ddec71.8bc674","order":4,"disp":true,"width":"13","collapse":false},{"id":"4095cbef.1c44c4","type":"ui_group","z":"","name":"Controlling Buttons","tab":"29ddec71.8bc674","order":1,"disp":false,"width":"35","collapse":false},{"id":"fb4fee1c.baa0a","type":"ui_group","z":"","name":"Menu","tab":"29ddec71.8bc674","order":5,"disp":false,"width":"35","collapse":false},{"id":"eac8d8a2.3a7828","type":"ui_group","z":"","name":"Table Products","tab":"29ddec71.8bc674","order":7,"disp":true,"width":"35","collapse":false},{"id":"29ddec71.8bc674","type":"ui_tab","z":"","name":"WMS0806","icon":"","order":11,"disabled":false,"hidden":false},{"id":"c14fa1e.38aa36","type":"ui_group","z":"","name":"Group 2","tab":"ea1ba77a.7ea108","order":2,"disp":false,"width":"17","collapse":false},{"id":"ff5cab0a.813058","type":"ui_group","z":"","name":"Group 2","tab":"ea1ba77a.7ea108","order":2,"disp":true,"width":"35","collapse":false},{"id":"9f807f6.5666e8","type":"ui_group","z":"","name":"AGV SIM","tab":"ea1ba77a.7ea108","order":1,"disp":false,"width":"35","collapse":false},{"id":"5ed7d551.872e1c","type":"MySQLdatabaseTSDV","z":0,"name":"","host":"127.0.0.1","port":"3306","user":"","db":"","tz":""},{"id":"ea1ba77a.7ea108","type":"ui_tab","z":"","name":"DAS Dynamic","icon":"DAS Dynamic","disabled":false,"hidden":false},{"id":"fc6b6fc0.4ccf3","type":"ui_group","z":"","name":"Group 2","tab":"d1b956eb.46db38","order":2,"disp":false,"width":"17","collapse":false},{"id":"b50986f5.1203e8","type":"ui_group","z":"","name":"Group 2","tab":"d1b956eb.46db38","order":2,"disp":true,"width":"35","collapse":false},{"id":"13ea8cb5.fc97a3","type":"ui_group","z":"","name":"AGV SIM","tab":"d1b956eb.46db38","order":1,"disp":false,"width":"35","collapse":false},{"id":"b7dfc222.c1566","type":"MySQLdatabaseTSDV","z":0,"name":"","host":"127.0.0.1","port":"3306","user":"","db":"","tz":""},{"id":"d1b956eb.46db38","type":"ui_tab","z":"","name":"DAS Dynamic","icon":"DAS Dynamic","disabled":false,"hidden":false},{"id":"be8b8efb.7f2bc","type":"function","z":"51c21e98.03293","name":"Check single or multiple products","func":"node.warn(\"Testtt\");\nvar len = msg.payload.data.length;\n\n//var url = \"http://10.116.41.70:5050/agv-web/v1.0/products\";\n\n//var url = \"http://localhost:1880/test\";\n\nvar url = global.get(\"post_products\");\n\nif(msg.actionName == \"Insert\" ){\n    if (len == 1) {\n    var insertId = msg.payload.data[0][\"jan-code\"];\n    msg.url = `${url}`;\n    return [msg,,,,,];\n    }else {\n         msg.url = url;\n         return [,msg,,,,];\n    }\n    \n}else if(msg.actionName == \"Update\"){\n    if (len == 1) {\n    var updateId = msg.payload.data[0][\"jan-code\"];\n    msg.url = `${url}/${updateId}`;\n    return [,,msg,,,];\n    } else {\n         msg.url = url;\n         return [,,,msg,,];\n    }\n    \n}else if(msg.actionName == \"Delete\"){\n    if (len == 1) {\n    var deleteId = msg.payload.data[0][\"jan-code\"];\n    msg.url = `${url}/${deleteId}`;\n    return [,,,,msg,];\n    } else {\n         msg.url = url;\n         return [,,,,,msg];\n    }\n}\n\n","outputs":6,"noerr":0,"initialize":"","finalize":"","x":220,"y":620,"wires":[["1aa550c3.b89d7f","fed1fa36.7205a8"],["25c008a9.12b7d8","fed1fa36.7205a8"],["4302a32e.9615bc","fed1fa36.7205a8"],["624221a.d62b3e","fed1fa36.7205a8"],["83bac8ab.0cf2b8","fed1fa36.7205a8"],["3d2c53ad.f4210c","fed1fa36.7205a8"]]},{"id":"d7885281.e56ec","type":"http in","z":"51c21e98.03293","name":"Server: Picking Result","url":"/v1.0/outbound-result","method":"post","upload":false,"swaggerDoc":"","x":160,"y":120,"wires":[["a1b383f6.94d43","d82e674.daf8b98"]]},{"id":"e74cf11c.b6e6b","type":"http response","z":"51c21e98.03293","name":"Response","statusCode":"","headers":{},"x":960,"y":120,"wires":[]},{"id":"399df613.78fdaa","type":"http request","z":"51c21e98.03293","name":"HTTP Client: Send Picking Order List (outbound)","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":true,"proxy":"","authType":"","x":600,"y":1240,"wires":[["fcf304da.190e28","3a4dd38a.c47a4c","b3376dda.4080a"]]},{"id":"97725893.aeef98","type":"inject","z":"51c21e98.03293","name":"Input picking order list","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"data\":[{\"key-no\":\"KEY000000000002\",\"job-no\":\"J290001\",\"unit-uketuke-no\":\"UU8A0MYY4378859\",\"gyomu-code\":\"1\",\"gyomu-name\":\"出荷\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":\"1\",\"jan-code\":\"4946452029816\",\"quantity\":1,\"unit-sequence-no\":1,\"unit-name\":\"標準梱包\",\"hso-uketuke-no\":\"HS8A0MYY4945063\",\"rte\":\"B005\",\"rte-name\":\"大阪 Ｂ朝 005\",\"gosya-no\":\"002\",\"coop-code\":\"00680\",\"coop-name\":\"共同配車\",\"niuke-adsr-code\":\"27123\",\"okurijo-no\":\"82120671\"},{\"key-no\":\"KEY000000000003\",\"job-no\":\"J290002\",\"unit-uketuke-no\":\"UU8A0MYY4378860\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":1,\"unit-sequence-no\":2,\"unit-name\":\"SX-J\",\"yso-no\":\"G2698\",\"alert-message\":\"※数量注意※\"},{\"key-no\":\"KEY000000000004\",\"job-no\":\"J290001\",\"unit-uketuke-no\":\"UU8A0MYY4378859\",\"gyomu-code\":\"1\",\"gyomu-name\":\"出荷\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":\"1\",\"jan-code\":\"4946452029816\",\"quantity\":1,\"unit-sequence-no\":1,\"unit-name\":\"標準梱包\",\"hso-uketuke-no\":\"HS8A0MYY4945063\",\"rte\":\"B005\",\"rte-name\":\"大阪 Ｂ朝 005\",\"gosya-no\":\"002\",\"coop-code\":\"00680\",\"coop-name\":\"共同配車\",\"niuke-adsr-code\":\"27123\",\"okurijo-no\":\"82120671\"},{\"key-no\":\"KEY000000000005\",\"job-no\":\"J290002\",\"unit-uketuke-no\":\"UU8A0MYY4378860\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":1,\"unit-sequence-no\":2,\"unit-name\":\"SX-J\",\"yso-no\":\"G2698\",\"alert-message\":\"※数量注意※\"},{\"key-no\":\"KEY000000000006\",\"job-no\":\"J290001\",\"unit-uketuke-no\":\"UU8A0MYY4378859\",\"gyomu-code\":\"1\",\"gyomu-name\":\"出荷\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":\"1\",\"jan-code\":\"4946452029816\",\"quantity\":1,\"unit-sequence-no\":1,\"unit-name\":\"標準梱包\",\"hso-uketuke-no\":\"HS8A0MYY4945063\",\"rte\":\"B005\",\"rte-name\":\"大阪 Ｂ朝 005\",\"gosya-no\":\"002\",\"coop-code\":\"00680\",\"coop-name\":\"共同配車\",\"niuke-adsr-code\":\"27123\",\"okurijo-no\":\"82120671\"},{\"key-no\":\"KEY000000000007\",\"job-no\":\"J290002\",\"unit-uketuke-no\":\"UU8A0MYY4378860\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":1,\"unit-sequence-no\":2,\"unit-name\":\"SX-J\",\"yso-no\":\"G2698\",\"alert-message\":\"※数量注意※\"},{\"key-no\":\"KEY000000000008\",\"job-no\":\"J290001\",\"unit-uketuke-no\":\"UU8A0MYY4378859\",\"gyomu-code\":\"1\",\"gyomu-name\":\"出荷\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":\"1\",\"jan-code\":\"4946452029816\",\"quantity\":1,\"unit-sequence-no\":1,\"unit-name\":\"標準梱包\",\"hso-uketuke-no\":\"HS8A0MYY4945063\",\"rte\":\"B005\",\"rte-name\":\"大阪 Ｂ朝 005\",\"gosya-no\":\"002\",\"coop-code\":\"00680\",\"coop-name\":\"共同配車\",\"niuke-adsr-code\":\"27123\",\"okurijo-no\":\"82120671\"},{\"key-no\":\"KEY000000000009\",\"job-no\":\"J290002\",\"unit-uketuke-no\":\"UU8A0MYY4378860\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":1,\"unit-sequence-no\":2,\"unit-name\":\"SX-J\",\"yso-no\":\"G2698\",\"alert-message\":\"※数量注意※\"},{\"key-no\":\"KEY0000000000010\",\"job-no\":\"J290001\",\"unit-uketuke-no\":\"UU8A0MYY4378859\",\"gyomu-code\":\"1\",\"gyomu-name\":\"出荷\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":\"1\",\"jan-code\":\"4946452029816\",\"quantity\":1,\"unit-sequence-no\":1,\"unit-name\":\"標準梱包\",\"hso-uketuke-no\":\"HS8A0MYY4945063\",\"rte\":\"B005\",\"rte-name\":\"大阪 Ｂ朝 005\",\"gosya-no\":\"002\",\"coop-code\":\"00680\",\"coop-name\":\"共同配車\",\"niuke-adsr-code\":\"27123\",\"okurijo-no\":\"82120671\"},{\"key-no\":\"KEY0000000000011\",\"job-no\":\"J290002\",\"unit-uketuke-no\":\"UU8A0MYY4378860\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":1,\"unit-sequence-no\":2,\"unit-name\":\"SX-J\",\"yso-no\":\"G2698\",\"alert-message\":\"※数量注意※\"},{\"key-no\":\"KEY0000000000012\",\"job-no\":\"J290001\",\"unit-uketuke-no\":\"UU8A0MYY4378859\",\"gyomu-code\":\"1\",\"gyomu-name\":\"出荷\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":\"1\",\"jan-code\":\"4946452029816\",\"quantity\":1,\"unit-sequence-no\":1,\"unit-name\":\"標準梱包\",\"hso-uketuke-no\":\"HS8A0MYY4945063\",\"rte\":\"B005\",\"rte-name\":\"大阪 Ｂ朝 005\",\"gosya-no\":\"002\",\"coop-code\":\"00680\",\"coop-name\":\"共同配車\",\"niuke-adsr-code\":\"27123\",\"okurijo-no\":\"82120671\"},{\"key-no\":\"KEY0000000000013\",\"job-no\":\"J290002\",\"unit-uketuke-no\":\"UU8A0MYY4378860\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":1,\"unit-sequence-no\":2,\"unit-name\":\"SX-J\",\"yso-no\":\"G2698\",\"alert-message\":\"※数量注意※\"}]}","payloadType":"json","x":208,"y":1240,"wires":[["399df613.78fdaa"]]},{"id":"2372fb1c.169294","type":"comment","z":"51c21e98.03293","name":"SERVER: picking result","info":"","x":160,"y":80,"wires":[]},{"id":"c7f5b4e8.22a508","type":"comment","z":"51c21e98.03293","name":"CLIENT: PRODUCT LIST","info":"","x":210,"y":549,"wires":[]},{"id":"6c2aa711.ef0a88","type":"comment","z":"51c21e98.03293","name":"CLIENT: PICKING ORDER LIST","info":"","x":550,"y":1200,"wires":[]},{"id":"64a9459f.875dec","type":"function","z":"51c21e98.03293","name":"Handle exception ","func":"/******************************************************************************\n * @brief   Handle exception to show on logview\n * @return  The exception\n * @author  DuyTM\n * @date    2020/08/04  Create\n ******************************************************************************/\nvar err = \"\";\nif( msg.fileType == \"Product\"){\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('Cannot POST') )\n    {\n        node.warn(\"Send send product data: Cannot POST\", msg);\n        err=\"Send product data: Cannot POST\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('empty_file') )\n    {\n        node.warn(\"Empty file\", msg);\n        err=\"There’s no data in file\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('wrong_file') )\n    {\n        node.warn(\"Empty file\", msg);\n        err=\"Wrong file format\";\n    }\n    node.warn(\"msg.payload:   \" + msg.payload);\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('empty_file_content') )\n    {\n        node.warn(\"Empty file content\", msg);\n        err=\"There’s no product data in file\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('wrong_extension') )\n    {\n        node.warn(\"Wrong file extension\", msg);\n        err=\"The selected file format is wrong\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('not_select_file') )\n    {\n        node.warn(\"Not select file\", msg);\n        err=\"Product data is not selected\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('data_invalid') )\n    {\n        node.warn(\"Data of file invalid\", msg);\n        err=\"Product data is wrong. Please check and correct it\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('wrong_file_path') )\n    {\n        node.warn(\"Wrong file path\", msg);\n        err=\"The file path is wrong\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('no_data_item') )\n    {\n        node.warn(\"No data item\", msg);\n        err=\"There’s no product data in file\";\n    }\n    \n    if(msg.statusCode == 404 ){\n        node.warn(\"error 404\", msg);\n        err=\"AGV Picking System cannot process the product data request. The response with status code is 404. Please check and correct it\";\n    }\n    \n    if(msg.statusCode == 403 ){\n        node.warn(\"error 403\", msg);\n        err=\"AGV Picking System cannot process the product data request. The response with status code is 403. Please check and correct it\";\n    }\n    \n    if(msg.statusCode == 405 ){\n        node.warn(\"error 405\", msg);\n        err=\"AGV Picking System cannot process the product data request. The response with status code is 405. Please check and correct it\";\n    }\n    \n    \n    if(msg.statusCode == 400 ){\n        node.warn(\"error 400\", msg);\n        err=\"AGV Picking System cannot process the product data request. The response with status code is 400. Please check and correct it\";\n    }\n    \n    if(msg.statusCode == 500 ){\n        node.warn(\"error 500\", msg);\n        err=\"AGV Picking System cannot process the product data request. The response with status code is 500. Please check and correct it\";\n    }\n    \n    if(msg.statusCode == \"EHOSTUNREACH\" ){\n        node.warn(\"Lost connect to AGV Picking System\", msg);\n        err=\"The connection with AGV Picking System is not available. Please check and correct it\";\n    }\n    \n    if(msg.statusCode == \"ESOCKETTIMEDOUT\" ){\n        node.warn(\"No response from server\", msg);\n        err=\"No response from server. Please check and correct it\";\n    }\n    \n    \n}else if (msg.fileType == \"Picking\"){\n    if ( typeof msg.payload ==='string' && msg.payload.includes('Cannot POST') )\n    {\n        node.warn(\"Send picking order list: Cannot POST\", msg);\n        err=\"Send picking order list: Cannot POST\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('not_select_file') )\n    {\n        node.warn(\"Not select file\", msg);\n        err=\"Picking order list is not selected\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('empty_file') )\n    {\n        node.warn(\"Empty file\", msg);\n        err=\"There’s no picking order in file\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('wrong_file') )\n    {\n        node.warn(\"Wrong file\", msg);\n        err=\"The selected file format is wrong\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('empty_file_content') )\n    {\n        node.warn(\"Empty file content\", msg);\n        err=\"No picking order is chosen\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('wrong_extension') )\n    {\n        node.warn(\"Wrong file extension\", msg);\n        err=\"The selected file format is wrong\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('data_invalid') )\n    {\n        node.warn(\"Data of file invalid\", msg);\n        err=\"Picking order is wrong. Please check and correct it\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('wrong_file_path') )\n    {\n        node.warn(\"Wrong file path\", msg);\n        err=\"The file path is wrong\";\n    }\n    \n    if(msg.statusCode == 404 ){\n        node.warn(\"error 404\", msg);\n        err=\"AGV Picking System cannot process the product data request. The response with status code is 404. Please check and correct it\";\n    }\n    \n    if(msg.statusCode == 403 ){\n        node.warn(\"error 403\", msg);\n        err=\"AGV Picking System cannot process the product data request. The response with status code is 403. Please check and correct it\";\n    }\n    \n    if(msg.statusCode == 400 ){\n        node.warn(\"error 400\", msg);\n        err=\"AGV Picking System cannot process the product data request. The response with status code is 400. Please check and correct it\";\n    }\n    \n    if(msg.statusCode == 500 ){\n        node.warn(\"error 500\", msg);\n        err=\"AGV Picking System cannot process the product data request. The response with status code is 500. Please check and correct it\";\n    }\n    \n    if(msg.statusCode == \"EHOSTUNREACH\" ){\n        node.warn(\"Lost connect to AGV Picking System\", msg);\n        err=\"The connection with AGV Picking System is not available. Please check and correct it\";\n    }\n    \n    if(msg.statusCode == \"ESOCKETTIMEDOUT\" ){\n        node.warn(\"No response from server\", msg);\n        err=\"No response from server. Please check and correct it\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('no_data_item') )\n    {\n        node.warn(\"No data item\", msg);\n        err=\"There’s no picking order in file\";\n    }    \n   \n}else if(msg.fileType == \"Stowing\"){\n    if ( typeof msg.payload ==='string' && msg.payload.includes('Cannot POST') )\n    {\n        node.warn(\"Send stowing order list: Cannot POST\", msg);\n        err=\"Send stowing order list: Cannot POST\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('not_select_file') )\n    {\n        node.warn(\"Not select file\", msg);\n        err=\"Stowing order list is not selected\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('empty_file') )\n    {\n        node.warn(\"Empty file\", msg);\n        err=\"There’s no stowing order in file\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('wrong_file') )\n    {\n        node.warn(\"Wrong file\", msg);\n        err=\"The selected file format is wrong\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('empty_file_content') )\n    {\n        node.warn(\"Empty file content\", msg);\n        err=\"No stowing order is chosen\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('wrong_extension') )\n    {\n        node.warn(\"Wrong file extension\", msg);\n        err=\"The selected file format is wrong\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('data_invalid') )\n    {\n        node.warn(\"Data of file invalid\", msg);\n        err=\"Stowing order is wrong. Please check and correct it\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('wrong_file_path') )\n    {\n        node.warn(\"Wrong file path\", msg);\n        err=\"The file path is wrong\";\n    }\n    \n    if(msg.statusCode == 404 ){\n        node.warn(\"error 404\", msg);\n        err=\"AGV Picking System cannot process the product data request. The response with status code is 404. Please check and correct it\";\n    }\n    \n    if(msg.statusCode == 403 ){\n        node.warn(\"error 403\", msg);\n        err=\"AGV Picking System cannot process the product data request. The response with status code is 403. Please check and correct it\";\n    }\n    \n    if(msg.statusCode == 400 ){\n        node.warn(\"error 400\", msg);\n        err=\"AGV Picking System cannot process the product data request. The response with status code is 400. Please check and correct it\";\n    }\n    \n    if(msg.statusCode == 500 ){\n        node.warn(\"error 500\", msg);\n        err=\"AGV Picking System cannot process the product data request. The response with status code is 500. Please check and correct it\";\n    }\n    \n    if(msg.statusCode == \"EHOSTUNREACH\" ){\n        node.warn(\"Lost connect to AGV Picking System\", msg);\n        err=\"The connection with AGV Picking System is not available. Please check and correct it\";\n    }\n    \n    if(msg.statusCode == \"ESOCKETTIMEDOUT\" ){\n        node.warn(\"No response from server\", msg);\n        err=\"No response from server. Please check and correct it\";\n    }\n    \n    if ( typeof msg.payload ==='string' && msg.payload.includes('no_data_item') )\n    {\n        node.warn(\"No data item\", msg);\n        err=\"There’s no stowing order in file\";\n    }   \n\n}else{\n    //do_something\n}\n\n\n\n\n\n\n\n\n\nvar list_Ex_Result = [];\nif(!global.get(\"list_Ex_Result\")){\n    global.set(\"list_Ex_Result\",list_Ex_Result);\n}\nelse{\n    list_Result = global.get(\"list_Ex_Result\");\n}\n\nvar msglist = global.get(\"list_Ex_Result\");\n\nif (!msglist) {\n    msglist = [];\n}\n\n\n\n\nvar currentdate = new Date();\nvar timeStemp = \"Time: \" +currentdate.getDay() + \"/\" + currentdate.getMonth() + \"/\" + currentdate.getFullYear() + \" \" +\ncurrentdate.getHours() + \":\" + currentdate.getMinutes() + \":\" + currentdate.getSeconds();\n\n\nif (err !== \"\") {\n    err = timeStemp +\" Exception: \" +err;\nmsglist.push(err);\n}\n\n\nglobal.set(\"list_Ex_Result\",msglist);\n\nmsg.payload = msglist;\n\nreturn msg;\n\n\n// if (err !== \"\") {\n//          msglist.push(\n//              {\n//              \"time\": timeStemp.toString(),\n//              \"key-no\": \"NA\",\n//              \"result\": \"NG\",\n//              \"error\": err.toString()\n//              });   \n// }\n\n\n// if ( typeof msg.payload ==='string' && msg.payload.includes('Cannot POST') )\n// {\n//     node.warn(\"Send picking order list: Cannot POST\", msg);\n//     err=\"Send picking order list: Cannot POST\";\n// }\n\n// if ( typeof msg.payload ==='string' && msg.payload.includes('404') )\n// {\n//     node.warn(\"Send picking order: Error 404\", msg);\n//     err=\"Send picking order: Error 404\";\n// }\n\n// if ( typeof msg.payload ==='string' && msg.payload.includes('not_select_file') )\n// {\n//     node.warn(\"Not select file\", msg);\n//     err=\"Not select file\";\n// }\n\n// if ( typeof msg.payload ==='string' && msg.payload.includes('empty_file') )\n// {\n//     node.warn(\"Empty file\", msg);\n//     err=\"There’s no data in file\";\n// }\n\n// if ( typeof msg.payload ==='string' && msg.payload.includes('wrong_file') )\n// {\n//     node.warn(\"Empty file\", msg);\n//     err=\"Wrong file format\";\n// }\n// node.warn(\"msg.payload:   \" + msg.payload);\n\n// if ( typeof msg.payload ==='string' && msg.payload.includes('empty_file_content') )\n// {\n//     node.warn(\"Empty file content\", msg);\n//     err=\"Empty file content\";\n// }\n\n// if ( typeof msg.payload ==='string' && msg.payload.includes('wrong_extension') )\n// {\n//     node.warn(\"Wrong file extension\", msg);\n//     err=\"The selected file format is wrong\";\n// }\n\n// if ( typeof msg.payload ==='string' && msg.payload.includes('not_select_file') )\n// {\n//     node.warn(\"Not select file\", msg);\n//     err=\"Not select file\";\n// }\n\n// if ( typeof msg.payload ==='string' && msg.payload.includes('data_invalid') )\n// {\n//     node.warn(\"Data of file invalid\", msg);\n//     err=\"Data of file invalid\";\n// }\n\n// if ( typeof msg.payload ==='string' && msg.payload.includes('wrong_file_path') )\n// {\n//     node.warn(\"Wrong file path\", msg);\n//     err=\"Wrong file path\";\n// }\n\n// if(msg.statusCode == 403 ){\n//     node.warn(\"error 403\", msg);\n//     err=\"Forbidden (Error 403)\";\n// }\n\n// if(msg.statusCode == 400 ){\n//     node.warn(\"error 400\", msg);\n//     err=\"Bad Request (Error 400)\";\n// }\n\n// if(msg.statusCode == 500 ){\n//     node.warn(\"error 500\", msg);\n//     err=\"Internal Server Error (Error 500)\";\n// }\n\n// if(msg.statusCode == \"EHOSTUNREACH\" ){\n//     node.warn(\"Lost connect to AGV Picking System\", msg);\n//     err=\"Lost connect to AGV Picking System\";\n// }\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":850,"y":2880,"wires":[["fd7caa77.86c038"]]},{"id":"569522bc.d6f3ac","type":"http in","z":"51c21e98.03293","name":"","url":"/send-product","method":"post","upload":true,"swaggerDoc":"","x":150,"y":1500,"wires":[["e9717cb5.29cbd"]]},{"id":"ddf2d7df.bf6108","type":"json","z":"51c21e98.03293","name":"parser_json_product","property":"payload","action":"obj","pretty":false,"x":1340,"y":1460,"wires":[["40c1b93c.5e7398"]]},{"id":"a9557e44.bc47c","type":"template","z":"51c21e98.03293","name":"html response","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"/******************************************************************************\n * @brief   Node show receive data on the GUI\n * @return  The receive data from input file\n * @author  DuyTM\n * @date    2020/08/04  Create\n ******************************************************************************/\n<p></p>File {{name}} has been sent !</p>\n<h2>Contents:</h2>\n<pre>\n{{{payload}}}\n</pre>","output":"str","x":880,"y":1480,"wires":[["5e7d42e1.fa12cc"]]},{"id":"878463e6.c05ba","type":"ui_template","z":"51c21e98.03293","group":"1df6f975.e48df7","name":"GUI choose file","order":1,"width":"11","height":"7","format":"\n<iframe name=\"dummyframe\" id=\"dummyframe\" style=\"display: none;\"></iframe>\n<h2>Product data:</h2>\n<div class=\"container\">\n    <form action=\"/send-product\" method=\"POST\" enctype=\"multipart/form-data\" target=\"dummyframe\" id=\"myform\">\n            \n            <input type=\"file\" id=\"file_product\" name=\"file\" />\n            \n            <!--<input type=\"file\" id=\"selectedFile\" style=\"display: none;\" />-->\n            \n            <!--<input type=\"button\" id=\"btnShowPathFile\" value=\"Browse...\" onclick=\"document.getElementById('selectedFile').click();\" />-->\n            \n            <!--<input type=\"button\" id=\"btnShowPathFile\" value=\"Choose File\" onclick=\"chooseFileFunc()\" />-->\n            \n            <!--<input type=\"button\" id=\"btnShowPathFile\" value=\"Browse...\" onclick=\"chooseFileFunc()\" />-->\n            \n            <!--<button type=\"button\" id=\"btnShowPathFile\" value=\"Browse...\" ng-click=\"send(payload: {abc: lam1})\"></button> -->\n            \n            <!--<input type=\"button\" id=\"btnShowPathFile\" value=\"Choose file\" />-->\n            <br/>\n            <!--<input type=\"button\" id=\"btn-choose\" onclick=\"chooseFileFunc()\" value=\"Choose file\"/>-->\n            \n            \n            \n            \n            <!--<input type=\"text\" id=\"file_path_value\" ng-model=\"file_path\" name=\"file\" style=\"width: 50%\" />-->\n            \n            <!--<button onclick=\"chooseFileFunc()\">Choose file</button>-->\n            \n            <input type=\"text\" id=\"file_path_value\" placeholder=\"Enter file path\" name=\"file\" style=\"width: 50%\" />\n            <br/>\n            <input type=\"submit\" value=\"Insert\">\n            <input type=\"button\" class=\"button-update\" value=\"Update\" id=\"but_upload_product\">\n            <input type=\"button\" class=\"button-delete\" value=\"Delete\" id=\"but_delete_prodct\">\n    </form>\n</div>\n\n<h2>Picking order:</h2>\n<div class=\"container\">\n    <form action=\"/send-picking-order\" method=\"POST\" enctype=\"multipart/form-data\" target=\"dummyframe\" id=\"myform\">\n            <input type=\"file\" id=\"file_picking\" name=\"file\" />\n             <br/>\n            <input type=\"text\" id=\"picking_file_path\" placeholder=\"Enter file path\" name=\"file\" style=\"width: 50%\" />\n             <br/>\n            <input type=\"submit\" value=\"Send\">\n    </form>\n</div>\n\n<h2>Stowing order:</h2>\n<div class=\"container\">\n    <form action=\"/send-stowing-order\" method=\"POST\" enctype=\"multipart/form-data\" target=\"dummyframe\" id=\"myform\">\n            <input type=\"file\" id=\"file_stowing\" name=\"file\" />\n             <br/>\n             <input type=\"text\" id=\"stowing_file_path\" placeholder=\"Enter file path\" name=\"file\" style=\"width: 50%\" />\n             <br/>\n            <input type=\"submit\" value=\"Send\">\n    </form>\n</div>\n\n\n<script>\n\n   var theScope = scope;\n    \n    function chooseFileFunc() {\n        var inputValue = document.getElementById(\"file_path_value\").value;\n        if(inputValue){\n            //alert(inputValue);\n            //then use where needed\n            theScope.send({payload:inputValue});\n        }else{\n            document.getElementById('selectedFile').click();\n        // document.getElementById(\"demo\").innerHTML = \"Hello World\";\n        //alert(\"Hello\");\n        }\n    }\n    \n    \n \n \n$(document).ready(function(){\n    \n\n    // \n    $(function(){\n        $('#file_product').on('change',function ()\n        {\n            var filePath = $(this).val();\n            //alert(filePath);\n            document.getElementById(\"file_path_value\").value = \"\";\n            // document.getElementById(\"btn-choose\").value = filePath;\n            //document.getElementById(\"file_product\").value = filePath;\n        });\n    });\n    \n    $(function(){\n        $('#file_path_value').on('change',function ()\n        {\n            var filePath = $(this).val();\n            document.getElementById(\"file_product\").value = \"\";\n\n        });\n    });\n\n\n    \n    // \n    $(function(){\n        $('#file_picking').on('change',function ()\n        {\n            var filePath = $(this).val();\n            //alert(filePath);\n            document.getElementById(\"picking_file_path\").value = \"\";\n            // document.getElementById(\"btn-choose\").value = filePath;\n            //document.getElementById(\"file_product\").value = filePath;\n        });\n    });\n    \n    $(function(){\n        $('#picking_file_path').on('change',function ()\n        {\n            var filePath = $(this).val();\n            document.getElementById(\"file_picking\").value = \"\";\n\n        });\n    });\n    \n    \n    \n    // \n    $(function(){\n        $('#file_stowing').on('change',function ()\n        {\n            var filePath = $(this).val();\n            //alert(filePath);\n            document.getElementById(\"stowing_file_path\").value = \"\";\n            // document.getElementById(\"btn-choose\").value = filePath;\n            //document.getElementById(\"file_product\").value = filePath;\n        });\n    });\n    \n    $(function(){\n        $('#stowing_file_path').on('change',function ()\n        {\n            var filePath = $(this).val();\n            document.getElementById(\"file_stowing\").value = \"\";\n\n        });\n    });\n    \n\n\n    $(\"#but_upload_product\").click(function(){\n        var fd = new FormData();\n        console.log(fd);\n        var files = $('#file_product')[0].files[0];\n        var inputValue = $('#file_path_value').val();\n        if(files){\n            fd.append('file',files);\n        }else{\n            fd.append('file',inputValue);\n        }\n      \n        \n        $.ajax({\n            url: '/update-product',\n            type: 'post',\n            data: fd,\n            contentType: false,\n            processData: false,\n            dataType: \"json\",\n            success: function(response){\n                alert('Successfully called');\n                if(response != 0){\n                   response = jQuery.parseJSON(data);\n                   console.log(response);\n                }else{\n                    console.log('file not uploaded');\n                }\n                console.log(\"Updated\");\n            },\n             error: function(r) {\n             console.log('error by tuancv', r);\n            }\n        });\n        \n       \n    });\n    \n    $(\"#but_delete_prodct\").click(function(){\n        \n        var fd = new FormData();\n        var files = $('#file_product')[0].files[0];\n        var inputValue = $('#file_path_value').val();\n        if(files){\n            fd.append('file',files);\n        }else{\n            fd.append('file',inputValue);\n        }\n\n        $.ajax({\n            url: '/delete-product',\n            type: 'post',\n            data: fd,\n            contentType: false,\n            processData: false,\n            dataType: \"json\",\n            success: function(response){\n                console.log(\"Updated\");\n            },\n        });\n    });\n});\n\n</script>\n\n\n\n\n","storeOutMessages":true,"fwdInMessages":true,"resendOnRefresh":false,"templateScope":"local","x":1420,"y":2580,"wires":[["4ab07c43.d40bc4"]]},{"id":"5e7d42e1.fa12cc","type":"http response","z":"51c21e98.03293","name":"","statusCode":"200","headers":{},"x":1040,"y":1480,"wires":[]},{"id":"823be6b8.031ac8","type":"http in","z":"51c21e98.03293","name":"","url":"/send-picking-order","method":"post","upload":true,"swaggerDoc":"","x":172,"y":1800,"wires":[["bcd4265b.85a7f8"]]},{"id":"93b980a0.6adc1","type":"function","z":"51c21e98.03293","name":"Read selected file","func":"/******************************************************************************\n * @brief   Node get data of input file\n * @return  The data of input file\n * @author  DuyTM\n * @date    2020/08/04  Create\n ******************************************************************************/\nnode.warn({\"test aaa\":msg.payload.data}); \nnode.warn({\"filelength\":msg.req.files.length});\nnode.warn({\"test 1\":msg.payload});\n\n\n//Choose file => msg.payload = \"\"\nif(msg.req.files.length != 0){\n    msg.name = msg.req.files[0].originalname;\n    \n    if (msg.req.files[0].mimetype.includes('image')) {\n        msg.payload = `<img src=\"data:image/gif;base64,${msg.req.files[0].buffer.toString('base64')}\">`;\n    } else {\n    msg.payload = msg.req.files[0].buffer.toString();\n        }\n    var file_name =  msg.req.files[0].originalname;\n    \n    // Not JSON file\n    if (!file_name.includes('.json') && !file_name.includes('.JSON') ){\n        node.error(\"NOT JSON\");\n        return [,,,msg,,,,,];\n    }\n    \n    node.warn({\"data test\":msg.payload.data});\n    // Content is empty\n    if (msg.payload == \"\"){\n        \n        // msg.payload == \"\"\n        // || !msg.payload.data.hasOwnProperty(\"key-no\") || !msg.payload.data.hasOwnProperty(\"jan-code\")\n        \n        node.error(\"EMPTY FILE\");\n        return [,,msg,,,,,,];\n    }\n    \n    if(msg.fileType == \"Product\"){\n        return [msg,,,,,,,,];\n    }\n    else if(msg.fileType == \"Picking\"){\n        return [,msg,,,,,,,];\n    }else if(msg.fileType == \"Stowing\"){\n        return [,,,,,msg,,,];\n    }\n    else{\n        //Do no thing\n    }\n    \n}else{\n    //Insert file path => msg.files = \"\"\n    node.warn({\"Not File\":msg});\n    \n    if(!msg.payload.file){\n        node.error(\"Not SELECT FILE\");\n        return [,,,,msg,,,,];\n    }\n    else{\n        if (!msg.payload.file.includes('.json') && !msg.payload.file.includes('.JSON') ){\n            node.error(\"NOT JSON\");\n            return [,,,msg,,,,,];\n        }\n        node.warn({\"EX\":msg});\n        if(msg.fileType == \"Product\"){\n            return [,,,,,,msg,,];\n        }\n        else if(msg.fileType == \"Picking\"){\n            return [,,,,,,,msg,];\n        }\n        else if(msg.fileType == \"Stowing\"){\n            return [,,,,,,,,msg];\n        }\n        //return [,,,,,,msg];\n    }\n}\n\n\n\n\n// if(!msg.req.files[0]){\n//     node.error(\"Not SELECT FILE\");\n//     return [,,,,msg];\n// }\n\n// msg.name = msg.req.files[0].originalname;\n\n// if (msg.req.files[0].mimetype.includes('image')) {\n//     msg.payload = `<img src=\"data:image/gif;base64,${msg.req.files[0].buffer.toString('base64')}\">`;\n// } else {\n//     msg.payload = msg.req.files[0].buffer.toString();\n// }\n\n// var file_name =  msg.req.files[0].originalname;\n\n// // Not JSON file\n// if (!file_name.includes('json') && !file_name.includes('JSON') ){\n//     node.error(\"NOT JSON\");\n//     return [,,,msg,];\n// }\n\n// // Content is empty\n// if (msg.payload == \"\"){\n//     node.error(\"EMPTY FILE\");\n//     return [,,msg,,];\n// }\n\n// if(msg.fileType == \"Product\"){\n//     return [msg,,,,];\n// }\n// else if(msg.fileType == \"Picking\"){\n//     return [,msg,,,];\n// }else if(msg.fileType == \"Stowing\"){\n//     return [,,,,,msg];\n// }\n// else{\n//     //Do no thing\n// }\n","outputs":9,"noerr":0,"initialize":"","finalize":"","x":690,"y":1700,"wires":[["a9557e44.bc47c","e0709e6d.61f93"],["a9557e44.bc47c","824466af.318d28"],["44317765.9b1538"],["518a2532.f5fd6c"],["2e8273b7.af025c"],["75e3acd3.7e05d4"],["df8bacf3.e7627"],["df8bacf3.e7627"],["df8bacf3.e7627"]]},{"id":"241cc28.850403e","type":"json","z":"51c21e98.03293","name":"parser_json_pickinglist","property":"payload","action":"obj","pretty":false,"x":1340,"y":1520,"wires":[["40c1b93c.5e7398"]]},{"id":"fcf304da.190e28","type":"function","z":"51c21e98.03293","name":"Handle Picking Response Data","func":"/******************************************************************************\n * @brief   Node handle result to show data on logView\n * @return  The list result data\n * @author  DuyTM\n * @date    2020/08/04  Create\n ******************************************************************************/\nnode.warn({\"data\":msg.payload.data[0][\"sequence-no\"]});\nvar list_Result = [];\nif(!global.get(\"list_Result\")){\n    global.set(\"list_Result\",list_Result);\n}\nelse{\n    list_Result = global.get(\"list_Result\");\n}\n\n/******************************************************************************\n * @brief   Get real time \n * @return  The time data\n * @author  DuyTM\n * @date    2020/08/27  Create\n ******************************************************************************/\nvar currentdate = new Date();\nvar timeStemp = currentdate.getDay() + \"/\" + currentdate.getMonth() + \"/\" + currentdate.getFullYear() + \" \" +\ncurrentdate.getHours() + \":\" + currentdate.getMinutes() + \":\" + currentdate.getSeconds();\n\n/******************************************************************************\n * @brief   Handle response data when received from API server\n * @return  The handled response data\n * @author  DuyTM\n * @date    2020/08/27  Create\n ******************************************************************************/\nvar responseData = msg.payload.data;\nif((msg.payload) ===\"\"){\n    list_Result.push(timeStemp + `Received Data: empty`);\n}else{\n   if(!(responseData[0][\"sequence-no\"])){\n   for(var key in responseData){\n    if (responseData.hasOwnProperty(key)) {\n         list_Result.push(\n             {\"time\": timeStemp.toString(),\n             \"key-no\": responseData[key][\"key-no\"].toString(),\n             \"sequence-no\": \"\",\n             \"result\": \"Response ok\"\n             });\n            }\n         }\n    } \n}\n\n/******************************************************************************\n * @brief   Update result status when received \n * @return  The handled response data\n * @author  DuyTM\n * @date    2020/08/27  Create\n ******************************************************************************/\n// if((msg.payload.data[0][\"sequence-no\"])){\n//     var keyValue = msg.payload.data[0][\"key-no\"];\n//     var listKeyId= [] ;\n//     for(var item in list_Result)\n//     {\n//         if(list_Result[item][\"key-no\"] == keyValue){\n//             listKeyId.push(item);\n//         }\n//     }\n//     var newKey = Math.max.apply(Math, listKeyId);\n//     list_Result[newKey][\"result\"] = \"Picking completed\";\n//     list_Result[newKey][\"sequence-no\"] =  msg.payload.data[0][\"sequence-no\"];\n//     list_Result[newKey][\"time\"] = timeStemp.toString();\n\n//     //node.warn({\"key\":keyValue}); \n// }\n\n//node.warn({\"key\":list_Result[item][\"key-no\"]}); \nglobal.set(\"list_Result\",list_Result);\nmsg.payload = list_Result;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":990,"y":1180,"wires":[["df6b11dc.da64a"]]},{"id":"3a4dd38a.c47a4c","type":"link out","z":"51c21e98.03293","name":"Send picking exception","links":["417fddb1.a12f14"],"x":970,"y":1240,"wires":[],"l":true},{"id":"fd7caa77.86c038","type":"link out","z":"51c21e98.03293","name":"Send handle exception","links":["4a55e31b.7f9c9c","da388975.2333c8"],"x":1120,"y":2880,"wires":[],"l":true},{"id":"4a55e31b.7f9c9c","type":"link in","z":"51c21e98.03293","name":"","links":["fd7caa77.86c038","b0eac190.81ad7"],"x":1195,"y":2260,"wires":[["caa93e24.ba00a"]]},{"id":"277736b.ba4b8ca","type":"link out","z":"51c21e98.03293","name":"Send picking order list","links":["194d9aa3.c50fe5","498d0a43.a99864"],"x":1940,"y":1540,"wires":[],"l":true},{"id":"194d9aa3.c50fe5","type":"link in","z":"51c21e98.03293","name":"","links":["277736b.ba4b8ca"],"x":95,"y":1300,"wires":[["84ee9b70.456d78"]]},{"id":"518c0c96.1c4574","type":"link out","z":"51c21e98.03293","name":"Send product data","links":["c3872516.c9a778"],"x":1930,"y":1500,"wires":[],"l":true},{"id":"c3872516.c9a778","type":"link in","z":"51c21e98.03293","name":"","links":["518c0c96.1c4574","68bae82b.591f88"],"x":75,"y":720,"wires":[["be8b8efb.7f2bc"]]},{"id":"87c3d62c.09a958","type":"comment","z":"51c21e98.03293","name":"Insert product file","info":"","x":142,"y":1460,"wires":[]},{"id":"8d688592.cb40c8","type":"comment","z":"51c21e98.03293","name":"Insert picking file","info":"","x":143,"y":1760,"wires":[]},{"id":"cbfc9782.e385f8","type":"comment","z":"51c21e98.03293","name":"Clear log table","info":"","x":250,"y":2200,"wires":[]},{"id":"78042c7d.a835f4","type":"comment","z":"51c21e98.03293","name":"Handle exception","info":"","x":140,"y":2660,"wires":[]},{"id":"e9717cb5.29cbd","type":"function","z":"51c21e98.03293","name":"Check Product List","func":"/******************************************************************************\n * @brief   Node add file type parameter \n * @return  The data file of product list\n * @author  DuyTM\n * @date    2020/08/04  Create\n ******************************************************************************/\nmsg.fileType = \"Product\";\nmsg.actionName = \"Insert\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":430,"y":1500,"wires":[["93b980a0.6adc1"]]},{"id":"bcd4265b.85a7f8","type":"function","z":"51c21e98.03293","name":"Check Picking Order List","func":"/******************************************************************************\n * @brief   Node add file type parameter \n * @return  The data file of picking order list\n * @author  DuyTM\n * @date    2020/08/04  Create\n ******************************************************************************/\nmsg.fileType = \"Picking\";\nreturn msg;","outputs":1,"noerr":0,"x":441,"y":1800,"wires":[["93b980a0.6adc1"]]},{"id":"1fd19095.c9ef6f","type":"function","z":"51c21e98.03293","name":"Throw exception empty file content","func":"throw \"empty_file_content\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1800,"y":2000,"wires":[[]]},{"id":"10d89968.aa23b7","type":"catch","z":"51c21e98.03293","name":"Catch empty file content","scope":["1fd19095.c9ef6f"],"uncaught":false,"x":160,"y":2700,"wires":[["89d65f0e.34cc9"]]},{"id":"89d65f0e.34cc9","type":"function","z":"51c21e98.03293","name":"Throw exception empty file content","func":"/******************************************************************************\n * @brief   Node throw exception when choose empty file\n * @return  The exception\n * @author  DuyTM\n * @date    2020/08/04  Create\n ******************************************************************************/\nmsg.payload = \"empty_file_content\";\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":2700,"wires":[["64a9459f.875dec"]]},{"id":"417fddb1.a12f14","type":"link in","z":"51c21e98.03293","name":"","links":["3a4dd38a.c47a4c","6f550b19.ab0e44","6b795b6e.aed684","49c8a3f6.7e5f9c","680e4877.5cee98","1b06729d.2d813d","f02e4d7d.3e458","d0d6d73e.a40b68"],"x":755,"y":2820,"wires":[["64a9459f.875dec"]]},{"id":"518a2532.f5fd6c","type":"function","z":"51c21e98.03293","name":"Throw exception wrong extension","func":"throw \"wrong_extension\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1260,"y":1740,"wires":[[]]},{"id":"e8041bf1.fbd218","type":"function","z":"51c21e98.03293","name":"Throw exception wrong extension","func":"/******************************************************************************\n * @brief   Node throw exception when choose empty file\n * @return  The exception\n * @author  DuyTM\n * @date    2020/08/04  Create\n ******************************************************************************/\nmsg.payload = \"wrong_extension\";\n\nreturn msg;","outputs":1,"noerr":0,"x":460,"y":2760,"wires":[["64a9459f.875dec"]]},{"id":"a066c634.30e148","type":"catch","z":"51c21e98.03293","name":"Catch wrong extension","scope":["518a2532.f5fd6c"],"uncaught":false,"x":160,"y":2760,"wires":[["e8041bf1.fbd218"]]},{"id":"2e8273b7.af025c","type":"function","z":"51c21e98.03293","name":"Throw exception not select file","func":"throw \"not_select_file\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1250,"y":1800,"wires":[[]]},{"id":"906973e5.d72e","type":"function","z":"51c21e98.03293","name":"Throw exception not select file","func":"/******************************************************************************\n * @brief   Node throw exception when choose empty file\n * @return  The exception\n * @author  DuyTM\n * @date    2020/08/04  Create\n ******************************************************************************/\nmsg.payload = \"not_select_file\";\n\nreturn msg;","outputs":1,"noerr":0,"x":450,"y":2820,"wires":[["64a9459f.875dec"]]},{"id":"a9fa782e.7853d8","type":"catch","z":"51c21e98.03293","name":"Catch not select file","scope":["2e8273b7.af025c"],"uncaught":false,"x":150,"y":2820,"wires":[["906973e5.d72e"]]},{"id":"71117e91.93c1f","type":"comment","z":"51c21e98.03293","name":"Manipulation GUI","info":"","x":1420,"y":2541,"wires":[]},{"id":"caa93e24.ba00a","type":"ui_list","z":"51c21e98.03293","group":"241b56d1.3b12fa","name":"Exception View","order":9,"width":"11","height":"6","lineType":"one","actionType":"none","allowHTML":true,"outputs":0,"topic":"","x":1320,"y":2320,"wires":[],"info":"// Comments"},{"id":"3502911e.4015ee","type":"ui_button","z":"51c21e98.03293","name":"Clear log table","group":"23b5a78.ab96f58","order":3,"width":"3","height":1,"passthru":true,"label":"Clear Log Table","tooltip":"","color":"","bgcolor":"","icon":"","payload":"saaaa","payloadType":"str","topic":"Clear log table","x":260,"y":2238,"wires":[["2877122c.32855e"]]},{"id":"effde220.bc67a","type":"comment","z":"51c21e98.03293","name":"Clear log view","info":"","x":250,"y":2298,"wires":[]},{"id":"b2d402d0.a3655","type":"ui_button","z":"51c21e98.03293","name":"Clear log view","group":"241b56d1.3b12fa","order":19,"width":"3","height":1,"passthru":false,"label":"Clear Log View","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Do you want to delete data ?","payloadType":"str","topic":"Clear log view","x":260,"y":2338,"wires":[["2877122c.32855e"]]},{"id":"7572b251.41857c","type":"ui_table","z":"51c21e98.03293","group":"23b5a78.ab96f58","name":"Table Order View","order":2,"width":"35","height":"4","columns":[{"field":"time","title":"Time","width":"15%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"key-no","title":"Key-no","width":"40%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"sequence-no","title":"Sequence-no","width":"30%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"result","title":"Result","width":"15%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":0,"cts":false,"x":1330,"y":2229,"wires":[]},{"id":"c78ef600.88bb98","type":"comment","z":"51c21e98.03293","name":"Clear log view","info":"","x":250,"y":2398,"wires":[]},{"id":"17415d4c.633f43","type":"ui_button","z":"51c21e98.03293","name":"Clear log all view","group":"b580a727.8bf078","order":8,"width":"3","height":1,"passthru":false,"label":"Clear Log  All View","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Do you want to delete data ?","payloadType":"str","topic":"Clear log all view","x":270,"y":2435,"wires":[["2877122c.32855e"]]},{"id":"3eee87dd.039b58","type":"ui_list","z":"51c21e98.03293","group":"b580a727.8bf078","name":"Log All View","order":1,"width":"13","height":"6","lineType":"one","actionType":"none","allowHTML":true,"outputs":0,"topic":"","x":1310,"y":2420,"wires":[],"info":"// Comments"},{"id":"cfdc09cd.17b2f8","type":"function","z":"51c21e98.03293","name":"Handle Result","func":"/******************************************************************************\n * @brief   Node handle result to show data on logView\n * @return  The list result data\n * @author  DuyTM\n * @date    2020/08/04  Create\n ******************************************************************************/\nvar listAllResult = [];\nif(!global.get(\"listAllResult\")){\n    global.set(\"listAllResult\",listAllResult);\n}\nelse{\n    listAllResult = global.get(\"listAllResult\");\n}\n\nnode.warn(\"LEN: \" + global.get(\"listAllResult\").length);\n\nvar currentdate = new Date();\nvar timeStemp = \"<b>Receive time: </b> \" + currentdate.getDay() + \"/\" + currentdate.getMonth() + \"/\" + currentdate.getFullYear() + \" \" +\ncurrentdate.getHours() + \":\" + currentdate.getMinutes() + \":\" + currentdate.getSeconds();\nif((msg.payload)){\n    //listAllResult.push(\"<br/><div>\" + timeStemp +\"</div>\");\n    listAllResult.push(\"<br/><div>\" + timeStemp + `<br/><b>Received Data </b>: <br/>${(msg.payload)}` + \"</div>\");\n}else if((msg.payload) ===\"\"){\n    listAllResult.push(timeStemp + ` Received Data: empty`);\n}\nglobal.set(\"listAllResult\",listAllResult);\nmsg.payload = listAllResult;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1000,"y":2480,"wires":[["3eee87dd.039b58"]]},{"id":"ceae5a7f.6aab28","type":"comment","z":"51c21e98.03293","name":"Log  All View","info":"","x":1310,"y":2380,"wires":[]},{"id":"b2fdbd67.6cdef","type":"json","z":"51c21e98.03293","name":"","property":"payload","action":"","pretty":false,"x":750,"y":2480,"wires":[["cfdc09cd.17b2f8"]]},{"id":"c79dab77.d54728","type":"http in","z":"51c21e98.03293","name":"","url":"/update-product","method":"post","upload":true,"swaggerDoc":"","x":161,"y":1600,"wires":[["bfa4038d.5f47a"]]},{"id":"beb6e197.eee32","type":"comment","z":"51c21e98.03293","name":"Update product file","info":"","x":151,"y":1560,"wires":[]},{"id":"bfa4038d.5f47a","type":"function","z":"51c21e98.03293","name":"Check Product List","func":"/******************************************************************************\n * @brief   Node add file type parameter \n * @return  The data file of product list\n * @author  DuyTM\n * @date    2020/08/04  Create\n ******************************************************************************/\nmsg.fileType = \"Product\";\nmsg.actionName = \"Update\";\nreturn msg;","outputs":1,"noerr":0,"x":431,"y":1600,"wires":[["93b980a0.6adc1"]]},{"id":"8a403517.1b6f18","type":"http in","z":"51c21e98.03293","name":"","url":"/delete-product","method":"post","upload":true,"swaggerDoc":"","x":161,"y":1700,"wires":[["dfe1c29b.ae67c"]]},{"id":"18669a5b.ed0586","type":"comment","z":"51c21e98.03293","name":"Delete product file","info":"","x":151,"y":1660,"wires":[]},{"id":"dfe1c29b.ae67c","type":"function","z":"51c21e98.03293","name":"Check Product List","func":"/******************************************************************************\n * @brief   Node add file type parameter \n * @return  The data file of product list\n * @author  DuyTM\n * @date    2020/08/04  Create\n ******************************************************************************/\nmsg.fileType = \"Product\";\nmsg.actionName = \"Delete\";\nreturn msg;","outputs":1,"noerr":0,"x":431,"y":1700,"wires":[["93b980a0.6adc1"]]},{"id":"802f5c8f.d0a01","type":"link in","z":"51c21e98.03293","name":"","links":["1b06729d.2d813d","6b795b6e.aed684","f02e4d7d.3e458","680e4877.5cee98","49c8a3f6.7e5f9c","b3376dda.4080a","d0d6d73e.a40b68","6ef7736b.7ff33c"],"x":615,"y":2480,"wires":[["b2fdbd67.6cdef"]]},{"id":"b3376dda.4080a","type":"link out","z":"51c21e98.03293","name":"","links":["802f5c8f.d0a01"],"x":875,"y":1300,"wires":[]},{"id":"82008362.af56a","type":"link in","z":"51c21e98.03293","name":"","links":["df6b11dc.da64a","95c5424f.113a8","ed01286e.59ac68","85374659.8a5ef8","9e94dae.d436b28","597f2156.4f86d"],"x":1195,"y":2200,"wires":[["7572b251.41857c"]]},{"id":"df6b11dc.da64a","type":"link out","z":"51c21e98.03293","name":"Send data log view","links":["82008362.af56a"],"x":1290,"y":1180,"wires":[],"l":true},{"id":"eb4b9d6c.54f7","type":"ui_button","z":"51c21e98.03293","name":"","group":"4095cbef.1c44c4","order":1,"width":"3","height":"1","passthru":false,"label":"Start WMS","tooltip":"","color":"","bgcolor":"","icon":"","payload":"start","payloadType":"str","topic":"","x":170,"y":3180,"wires":[["fb8f036a.ea69e"]]},{"id":"a5b64523.87f128","type":"ui_button","z":"51c21e98.03293","name":"","group":"4095cbef.1c44c4","order":1,"width":"3","height":"1","passthru":false,"label":"Stop WMS","tooltip":"","color":"","bgcolor":"","icon":"","payload":"stop","payloadType":"str","topic":"","x":170,"y":3300,"wires":[["fb8f036a.ea69e"]]},{"id":"fb8f036a.ea69e","type":"function","z":"51c21e98.03293","name":"Start/Stop SIM","func":"if (msg.payload === \"start\") {\n    flow.set(\"running\", true);\n} else if (msg.payload === \"stop\") {\n    flow.set(\"running\", false);\n} else {\n    node.warn(\"Wrong payload message\");\n}\n\nlet enableMsg = {};\nenableMsg.enabled = !flow.get(\"running\");\nenableMsg.payload = '';\nenableMsg.typeClick = 'start_stop';\n\nlet disableMsg = {};\ndisableMsg.enabled = flow.get(\"running\");\ndisableMsg.payload = '';\ndisableMsg.typeClick = 'start_stop';\n\nreturn [enableMsg, disableMsg];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":380,"y":3240,"wires":[["eb4b9d6c.54f7"],["4b163c2b.139444","a5b64523.87f128"]]},{"id":"4b163c2b.139444","type":"link out","z":"51c21e98.03293","name":"Disable when stop","links":["bd1d8e1b.4cb47","784be2bd.b6cd6c","3910a8d3.1fcff8","1ac4f818.2bcfa8"],"x":625,"y":3247,"wires":[],"l":true},{"id":"bd1d8e1b.4cb47","type":"link in","z":"51c21e98.03293","name":"","links":["4b163c2b.139444"],"x":1255,"y":2580,"wires":[["878463e6.c05ba"]]},{"id":"c6d14261.ee45b","type":"function","z":"51c21e98.03293","name":"Function response","func":"/******************************************************************************\n * @brief   Node return picking result\n * @return  the picking result value\n * @author  DuyTM\n * @date    2020/08/04  Create\n ******************************************************************************/\nnode.warn({\"data outbound result\":msg.payload});\nvar isRunning = flow.get(\"running\");\n\nvar res_msg = {};\n\nif (isRunning)\n{\n    msg.statusCode = 200;\n    var response = {\"result\": \"ok\"};\n    msg.payload = response;\n\n} else {\n    msg.statusCode = 503;\n    var response = {};\n    msg.payload = undefined;\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":120,"wires":[["e74cf11c.b6e6b"]]},{"id":"1aa550c3.b89d7f","type":"http request","z":"51c21e98.03293","name":"HTTP client: Insert single product data","method":"POST","ret":"obj","paytoqs":"query","url":"","tls":"","persist":true,"proxy":"","authType":"","x":650,"y":480,"wires":[["6b795b6e.aed684","5a977e0e.149ff"]]},{"id":"6b795b6e.aed684","type":"link out","z":"51c21e98.03293","name":"","links":["802f5c8f.d0a01","417fddb1.a12f14","8aa45fd6.f2241"],"x":875,"y":480,"wires":[]},{"id":"25c008a9.12b7d8","type":"http request","z":"51c21e98.03293","name":"HTTP client: Insert multiple product data","method":"POST","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":true,"proxy":"","authType":"","x":660,"y":540,"wires":[["f02e4d7d.3e458","5a977e0e.149ff"]]},{"id":"f02e4d7d.3e458","type":"link out","z":"51c21e98.03293","name":"","links":["802f5c8f.d0a01","8aa45fd6.f2241","417fddb1.a12f14"],"x":875,"y":580,"wires":[]},{"id":"4302a32e.9615bc","type":"http request","z":"51c21e98.03293","name":"HTTP client: Update single product data","method":"PUT","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":true,"proxy":"","authType":"","x":660,"y":620,"wires":[["49c8a3f6.7e5f9c","5a977e0e.149ff"]]},{"id":"49c8a3f6.7e5f9c","type":"link out","z":"51c21e98.03293","name":"","links":["802f5c8f.d0a01","417fddb1.a12f14","8aa45fd6.f2241"],"x":875,"y":640,"wires":[]},{"id":"624221a.d62b3e","type":"http request","z":"51c21e98.03293","name":"HTTP client: Update multiple product data","method":"PUT","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":true,"proxy":"","authType":"","x":660,"y":700,"wires":[["d0d6d73e.a40b68","5a977e0e.149ff"]]},{"id":"d0d6d73e.a40b68","type":"link out","z":"51c21e98.03293","name":"","links":["802f5c8f.d0a01","8aa45fd6.f2241","417fddb1.a12f14"],"x":875,"y":720,"wires":[]},{"id":"83bac8ab.0cf2b8","type":"http request","z":"51c21e98.03293","name":"HTTP client: Delete single product data","method":"DELETE","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":true,"proxy":"","authType":"","x":660,"y":780,"wires":[["680e4877.5cee98","5a977e0e.149ff"]]},{"id":"680e4877.5cee98","type":"link out","z":"51c21e98.03293","name":"","links":["802f5c8f.d0a01","417fddb1.a12f14","8aa45fd6.f2241"],"x":875,"y":800,"wires":[]},{"id":"3d2c53ad.f4210c","type":"http request","z":"51c21e98.03293","name":"HTTP client: Delete multiple product data","method":"DELETE","ret":"obj","paytoqs":"ignore","url":"","tls":"","persist":true,"proxy":"","authType":"","x":660,"y":860,"wires":[["1b06729d.2d813d","5a977e0e.149ff"]]},{"id":"1b06729d.2d813d","type":"link out","z":"51c21e98.03293","name":"","links":["802f5c8f.d0a01","417fddb1.a12f14","8aa45fd6.f2241"],"x":875,"y":880,"wires":[]},{"id":"feef91b1.8c579","type":"function","z":"51c21e98.03293","name":"Append sending product event","func":"var listAllResult = [];\nif(!global.get(\"listAllResult\")){\n    global.set(\"listAllResult\",listAllResult);\n}\nelse{\n    listAllResult = global.get(\"listAllResult\");\n}\n\nvar currentdate = new Date();\nvar timeStemp = \"<b>Time: </b> \" + currentdate.getDay() + \"/\" + currentdate.getMonth() + \"/\" + currentdate.getFullYear() + \" \" +\ncurrentdate.getHours() + \":\" + currentdate.getMinutes() + \":\" + currentdate.getSeconds();\n\nif((msg.payload)){\n    listAllResult.push(\"<br/><div>\" + timeStemp + `<br/><b>${msg.actionName} Product Data </b>: <br/>${(msg.payload)}` + \"</div>\");\n}else if((msg.payload) ===\"\"){\n    listAllResult.push(timeStemp + ` Received Data: empty`);\n}\nglobal.set(\"listAllResult\",listAllResult);\nmsg.payload = listAllResult;\nreturn msg;\n\nreturn msg;","outputs":1,"noerr":0,"x":970,"y":2520,"wires":[["3eee87dd.039b58"]]},{"id":"fed1fa36.7205a8","type":"link out","z":"51c21e98.03293","name":"","links":["be56f57d.12e6b8"],"x":355,"y":760,"wires":[]},{"id":"be56f57d.12e6b8","type":"link in","z":"51c21e98.03293","name":"","links":["fed1fa36.7205a8"],"x":615,"y":2520,"wires":[["d5d6cd2a.cded4"]]},{"id":"d5d6cd2a.cded4","type":"json","z":"51c21e98.03293","name":"","property":"payload","action":"","pretty":false,"x":750,"y":2520,"wires":[["feef91b1.8c579"]]},{"id":"634c0012.34cf6","type":"http response","z":"51c21e98.03293","name":"","statusCode":"","headers":{},"x":630,"y":3560,"wires":[]},{"id":"8be3227b.6785","type":"function","z":"51c21e98.03293","name":"Handle ","func":"msg.title =\"Update All\";\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":3560,"wires":[["634c0012.34cf6"]]},{"id":"d46e0c79.ae46b","type":"http in","z":"51c21e98.03293","name":" Update Multiple Server","url":"/test","method":"put","upload":true,"swaggerDoc":"","x":150,"y":3560,"wires":[["8be3227b.6785"]]},{"id":"44c1d237.54e5ac","type":"http response","z":"51c21e98.03293","name":"","statusCode":"","headers":{},"x":630,"y":3620,"wires":[]},{"id":"5bdee797.870448","type":"function","z":"51c21e98.03293","name":"Handle ","func":"msg.title =\"Update sigle\";\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":3620,"wires":[["44c1d237.54e5ac"]]},{"id":"747d0ad7.4fe4c4","type":"http in","z":"51c21e98.03293","name":" Update Single Server","url":"/test/4946452029816","method":"put","upload":true,"swaggerDoc":"","x":150,"y":3620,"wires":[["5bdee797.870448"]]},{"id":"e456b998.062f78","type":"http response","z":"51c21e98.03293","name":"","statusCode":"","headers":{},"x":630,"y":3440,"wires":[]},{"id":"fd1404da.82eb58","type":"function","z":"51c21e98.03293","name":"Handle ","func":"msg.title =\"Insert All\";\nmsg.payload = \n{\t\n\t\"data\": [\n\t\t{\n\t\t\t\"jan-code\": \"4946452000228\",\n\t\t\t\"result\": \"ok\"\n\t\t}\n\t\t]\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":3440,"wires":[["e456b998.062f78"]]},{"id":"9a78b906.d998e8","type":"http in","z":"51c21e98.03293","name":"Insert Multiple Server","url":"/test","method":"post","upload":true,"swaggerDoc":"","x":150,"y":3440,"wires":[["fd1404da.82eb58"]]},{"id":"fa1cbd3a.e64a2","type":"http response","z":"51c21e98.03293","name":"","statusCode":"","headers":{},"x":630,"y":3500,"wires":[]},{"id":"7b019437.503e6c","type":"function","z":"51c21e98.03293","name":"Handle ","func":"msg.title =\"Insert sigle\";\nmsg.payload = \n{\t\n\t\"data\": [\n\t\t{\n\t\t\t\"jan-code\": \"4946452000228\",\n\t\t\t\"result\": \"ok\"\n\t\t}\n\t\t]\n}\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":400,"y":3500,"wires":[["fa1cbd3a.e64a2"]]},{"id":"3fd7ef7e.5535d","type":"http in","z":"51c21e98.03293","name":" Insert Single Server","url":"/test","method":"post","upload":true,"swaggerDoc":"","x":140,"y":3500,"wires":[["7b019437.503e6c"]]},{"id":"a7acc9c7.4d7508","type":"http response","z":"51c21e98.03293","name":"","statusCode":"","headers":{},"x":630,"y":3680,"wires":[]},{"id":"b01e4e51.1a2ba","type":"function","z":"51c21e98.03293","name":"Handle ","func":"msg.title =\"Update All\";\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":3680,"wires":[["a7acc9c7.4d7508"]]},{"id":"a79b2960.abaed8","type":"http in","z":"51c21e98.03293","name":" Delete Multiple Server","url":"/test","method":"delete","upload":true,"swaggerDoc":"","x":150,"y":3680,"wires":[["b01e4e51.1a2ba"]]},{"id":"6b3cfefa.07e74","type":"http response","z":"51c21e98.03293","name":"","statusCode":"","headers":{},"x":630,"y":3740,"wires":[]},{"id":"5d17ed24.03a1f4","type":"function","z":"51c21e98.03293","name":"Handle ","func":"msg.title =\"Update sigle\";\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":3740,"wires":[["6b3cfefa.07e74"]]},{"id":"9f0ff4ab.3fe638","type":"http in","z":"51c21e98.03293","name":" Delete Single Server","url":"/test/4946452029816","method":"delete","upload":true,"swaggerDoc":"","x":138,"y":3740,"wires":[["5d17ed24.03a1f4"]]},{"id":"aca4e15e.dc23f","type":"comment","z":"51c21e98.03293","name":"Mockup server","info":"","x":132,"y":3400,"wires":[]},{"id":"c4504df0.32337","type":"function","z":"51c21e98.03293","name":"Append sending  order event","func":"var listAllResult = [];\nif(!global.get(\"listAllResult\")){\n    global.set(\"listAllResult\",listAllResult);\n}\nelse{\n    listAllResult = global.get(\"listAllResult\");\n}\n\nvar currentdate = new Date();\nvar timeStemp = \"<b>Send time: </b> \" + currentdate.getDay() + \"/\" + currentdate.getMonth() + \"/\" + currentdate.getFullYear() + \" \" +\ncurrentdate.getHours() + \":\" + currentdate.getMinutes() + \":\" + currentdate.getSeconds();\n\nif((msg.payload)){\n    //listAllResult.push(\"<br/><div>\" + timeStemp + `<br/><b>Product Data </b>: <br/>${(msg.payload)}` + \"</div>\");\n    listAllResult.push(\"<br/><div>\" + timeStemp +\"</div>\");\n}else if((msg.payload) ===\"\"){\n    listAllResult.push(timeStemp + ` Received Data: empty`);\n}\nglobal.set(\"listAllResult\",listAllResult);\nmsg.payload = listAllResult;\nreturn msg;\n\nreturn msg;","outputs":1,"noerr":0,"x":980,"y":2580,"wires":[["3eee87dd.039b58"]]},{"id":"498d0a43.a99864","type":"link in","z":"51c21e98.03293","name":"","links":["277736b.ba4b8ca","ec647814.b8d118"],"x":616,"y":2580,"wires":[["1325e73e.dea6e9"]]},{"id":"1325e73e.dea6e9","type":"json","z":"51c21e98.03293","name":"","property":"payload","action":"","pretty":false,"x":750,"y":2580,"wires":[["c4504df0.32337"]]},{"id":"a1b383f6.94d43","type":"debug","z":"51c21e98.03293","name":"Outbound Result","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":410,"y":80,"wires":[]},{"id":"95c5424f.113a8","type":"link out","z":"51c21e98.03293","name":"","links":["82008362.af56a"],"x":655,"y":160,"wires":[]},{"id":"d82e674.daf8b98","type":"function","z":"51c21e98.03293","name":"Function Update Picking Complete","func":"/******************************************************************************\n * @brief   Update result status when received \n * @return  The handled response data\n * @author  DuyTM\n * @date    2020/08/27  Create\n ******************************************************************************/\nnode.warn({\"data-test\":msg.payload.data});\n\nif(!global.get(\"list_Result\")){\n    var list_Result = [];\n    global.set(\"list_Result\",list_Result);\n}\nelse{\n    list_Result = global.get(\"list_Result\");\n}\n\n/******************************************************************************\n * @brief   Get real time \n * @return  The time data\n * @author  DuyTM\n * @date    2020/08/27  Create\n ******************************************************************************/\nvar currentdate = new Date();\nvar timeStemp = currentdate.getDay() + \"/\" + currentdate.getMonth() + \"/\" + currentdate.getFullYear() + \" \" +\ncurrentdate.getHours() + \":\" + currentdate.getMinutes() + \":\" + currentdate.getSeconds();\n\n\n/******************************************************************************\n * @brief   Update result status when received \n * @return  The handled response data\n * @author  DuyTM\n * @date    2020/08/27  Create\n ******************************************************************************/\nif((msg.payload)){\n    var keyValue = msg.payload.data[0][\"key-no\"];\n    var listKeyId= [] ;\n    if(list_Result.length >0 ){\n        for(var item in list_Result)\n        {\n            if(list_Result[item][\"key-no\"] == keyValue){\n                listKeyId.push(item);\n            }\n        }\n        node.warn({\"listKeyId\":listKeyId});\n        if(listKeyId.length >0){\n            var newKey = Math.max.apply(Math, listKeyId);\n            node.warn({\"index-key\":newKey});\n            list_Result[newKey][\"result\"] = \"Stowing completed\";\n            list_Result[newKey][\"sequence-no\"] =  msg.payload.data[0][\"sequence-no\"];\n            list_Result[newKey][\"time\"] = timeStemp.toString();\n        }else{\n            list_Result.push(\n             {\"time\": timeStemp.toString(),\n             \"key-no\": msg.payload.data[0][\"key-no\"],\n             \"sequence-no\": msg.payload.data[0][\"sequence-no\"],\n            //\"tray-id\": responseData[key][\"unit_uketuke_no\"].toString(),\n             \"result\": \"Stowing completed\"\n        });\n        }\n    }\n   else{\n        node.warn({\"testData\":msg.payload.data});\n    //   for(var i in msg.payload.data ){\n        \n    //     list_Result.push(\n    //          {\"time\": timeStemp.toString(),\n    //          \"key-no\": i[\"key-no\"],\n    //          \"sequence-no\": i[\"sequence-no\"],\n    //         //  \"tray-id\": responseData[key][\"hkat-shiji-no\"].toString(),\n    //          \"result\": \"Stowing completed\"\n    //     });\n    //   }\n    \n        list_Result.push(\n             {\"time\": timeStemp.toString(),\n             \"key-no\": msg.payload.data[0][\"key-no\"],\n             \"sequence-no\": msg.payload.data[0][\"sequence-no\"],\n            //  \"tray-id\": responseData[key][\"hkat-shiji-no\"].toString(),\n             \"result\": \"Stowing completed\"\n        });\n    }\n    \n}\n\n\n//node.warn({\"key\":list_Result[item][\"key-no\"]}); \nglobal.set(\"list_Result\",list_Result);\n\nmsg.payload = global.get(\"list_Result\");\n\nnode.warn({\"data-list\":msg.payload});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":120,"wires":[["c6d14261.ee45b","95c5424f.113a8","5369b197.09496"]]},{"id":"5369b197.09496","type":"debug","z":"51c21e98.03293","name":"Data outbound","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":720,"y":80,"wires":[]},{"id":"b0ca0bdc.921ca8","type":"inject","z":"51c21e98.03293","name":"Post Outbound","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"$env('Post_Outbound')","payloadType":"jsonata","x":1240,"y":120,"wires":[["15298ded.ff6322"]]},{"id":"15298ded.ff6322","type":"json","z":"51c21e98.03293","name":"Parser json","property":"payload","action":"obj","pretty":false,"x":1490,"y":120,"wires":[["26222108.5dc95e"]]},{"id":"26222108.5dc95e","type":"function","z":"51c21e98.03293","name":"Set global outbound","func":"global.set(\"outbound\",msg.payload.outbound);\nglobal.set(\"inbound\",msg.payload.inbound);\nreturn msg;","outputs":1,"noerr":0,"x":1740,"y":120,"wires":[[]]},{"id":"84ee9b70.456d78","type":"function","z":"51c21e98.03293","name":"Set url outbound","func":"msg.url = global.get(\"outbound\");\n//msg.url = \"http://10.116.41.70:5050/agv-web/v1.0/outbound\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":1300,"wires":[["399df613.78fdaa"]]},{"id":"86fe2848.de8898","type":"inject","z":"51c21e98.03293","name":"Post Inbound","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"$env('Post_Inbound')","payloadType":"jsonata","x":1240,"y":180,"wires":[["ad9a1191.6a4d7"]]},{"id":"ffae19fb.7da9c8","type":"inject","z":"51c21e98.03293","name":"Post Products","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"$env('Post_Products')","payloadType":"jsonata","x":1240,"y":240,"wires":[["8ae6cf4b.4c3aa"]]},{"id":"a30eafb5.1a367","type":"inject","z":"51c21e98.03293","name":"Put Products","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"$env('Put_Products')","payloadType":"jsonata","x":1230,"y":300,"wires":[["2fb7e612.669eba"]]},{"id":"e7068977.651bf8","type":"inject","z":"51c21e98.03293","name":"Get Products","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"$env('Get_Products')","payloadType":"jsonata","x":1230,"y":360,"wires":[["cc3182d2.f5c0d"]]},{"id":"8217598c.bca388","type":"inject","z":"51c21e98.03293","name":"Delete Products","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"$env('Delete_Products')","payloadType":"jsonata","x":1240,"y":420,"wires":[["305bbc2.0458244"]]},{"id":"ad9a1191.6a4d7","type":"json","z":"51c21e98.03293","name":"Parser json","property":"payload","action":"obj","pretty":false,"x":1490,"y":180,"wires":[["fee39c63.b0a23"]]},{"id":"8ae6cf4b.4c3aa","type":"json","z":"51c21e98.03293","name":"Parser json","property":"payload","action":"obj","pretty":false,"x":1490,"y":240,"wires":[["473b5d76.72ccd4"]]},{"id":"2fb7e612.669eba","type":"json","z":"51c21e98.03293","name":"Parser json","property":"payload","action":"obj","pretty":false,"x":1490,"y":300,"wires":[["917cca51.b732a8"]]},{"id":"cc3182d2.f5c0d","type":"json","z":"51c21e98.03293","name":"Parser json","property":"payload","action":"obj","pretty":false,"x":1490,"y":360,"wires":[["d827fe1c.e7dc7"]]},{"id":"305bbc2.0458244","type":"json","z":"51c21e98.03293","name":"Parser json","property":"payload","action":"obj","pretty":false,"x":1490,"y":420,"wires":[["c0130f12.d02c7"]]},{"id":"fee39c63.b0a23","type":"function","z":"51c21e98.03293","name":"Set global inbound","func":"global.set(\"inbound\",msg.payload.inbound);\nglobal.set(\"inbound_result\",msg.payload.inbound_result);\nreturn msg;","outputs":1,"noerr":0,"x":1730,"y":180,"wires":[[]]},{"id":"473b5d76.72ccd4","type":"function","z":"51c21e98.03293","name":"Set global post products","func":"global.set(\"post_products\",msg.payload.post_products);\nglobal.set(\"post_products_query\",msg.payload.post_products_query);\nreturn msg;","outputs":1,"noerr":0,"x":1750,"y":240,"wires":[[]]},{"id":"917cca51.b732a8","type":"function","z":"51c21e98.03293","name":"Set global put products","func":"global.set(\"put_products\",msg.payload.put_products);\nreturn msg;","outputs":1,"noerr":0,"x":1750,"y":300,"wires":[[]]},{"id":"d827fe1c.e7dc7","type":"function","z":"51c21e98.03293","name":"Set global get products","func":"global.set(\"get_products\",msg.payload.get_products);\nreturn msg;","outputs":1,"noerr":0,"x":1750,"y":360,"wires":[[]]},{"id":"c0130f12.d02c7","type":"function","z":"51c21e98.03293","name":"Set global delete products","func":"global.set(\"delete_products\",msg.payload.delete_products);\nreturn msg;","outputs":1,"noerr":0,"x":1750,"y":420,"wires":[[]]},{"id":"3c0c838.e4a957c","type":"http request","z":"51c21e98.03293","name":"HTTP Client: Send Stowing Order List (inbound)","method":"POST","ret":"obj","paytoqs":"query","url":"","tls":"","persist":true,"proxy":"","authType":"","x":580,"y":1020,"wires":[["b97ce44b.70c948","6f550b19.ab0e44","6ef7736b.7ff33c"]]},{"id":"c64d260b.76b458","type":"inject","z":"51c21e98.03293","name":"Input stowing order list","repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"data\":[{\"key-no\":\"KEY000000000002\",\"job-no\":\"J290001\",\"unit-uketuke-no\":\"UU8A0MYY4378859\",\"gyomu-code\":\"1\",\"gyomu-name\":\"出荷\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":\"1\",\"jan-code\":\"4946452029816\",\"quantity\":1,\"unit-sequence-no\":1,\"unit-name\":\"標準梱包\",\"hso-uketuke-no\":\"HS8A0MYY4945063\",\"rte\":\"B005\",\"rte-name\":\"大阪 Ｂ朝 005\",\"gosya-no\":\"002\",\"coop-code\":\"00680\",\"coop-name\":\"共同配車\",\"niuke-adsr-code\":\"27123\",\"okurijo-no\":\"82120671\"},{\"key-no\":\"KEY000000000003\",\"job-no\":\"J290002\",\"unit-uketuke-no\":\"UU8A0MYY4378860\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":1,\"unit-sequence-no\":2,\"unit-name\":\"SX-J\",\"yso-no\":\"G2698\",\"alert-message\":\"※数量注意※\"},{\"key-no\":\"KEY000000000004\",\"job-no\":\"J290001\",\"unit-uketuke-no\":\"UU8A0MYY4378859\",\"gyomu-code\":\"1\",\"gyomu-name\":\"出荷\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":\"1\",\"jan-code\":\"4946452029816\",\"quantity\":1,\"unit-sequence-no\":1,\"unit-name\":\"標準梱包\",\"hso-uketuke-no\":\"HS8A0MYY4945063\",\"rte\":\"B005\",\"rte-name\":\"大阪 Ｂ朝 005\",\"gosya-no\":\"002\",\"coop-code\":\"00680\",\"coop-name\":\"共同配車\",\"niuke-adsr-code\":\"27123\",\"okurijo-no\":\"82120671\"},{\"key-no\":\"KEY000000000005\",\"job-no\":\"J290002\",\"unit-uketuke-no\":\"UU8A0MYY4378860\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":1,\"unit-sequence-no\":2,\"unit-name\":\"SX-J\",\"yso-no\":\"G2698\",\"alert-message\":\"※数量注意※\"},{\"key-no\":\"KEY000000000006\",\"job-no\":\"J290001\",\"unit-uketuke-no\":\"UU8A0MYY4378859\",\"gyomu-code\":\"1\",\"gyomu-name\":\"出荷\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":\"1\",\"jan-code\":\"4946452029816\",\"quantity\":1,\"unit-sequence-no\":1,\"unit-name\":\"標準梱包\",\"hso-uketuke-no\":\"HS8A0MYY4945063\",\"rte\":\"B005\",\"rte-name\":\"大阪 Ｂ朝 005\",\"gosya-no\":\"002\",\"coop-code\":\"00680\",\"coop-name\":\"共同配車\",\"niuke-adsr-code\":\"27123\",\"okurijo-no\":\"82120671\"},{\"key-no\":\"KEY000000000007\",\"job-no\":\"J290002\",\"unit-uketuke-no\":\"UU8A0MYY4378860\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":1,\"unit-sequence-no\":2,\"unit-name\":\"SX-J\",\"yso-no\":\"G2698\",\"alert-message\":\"※数量注意※\"},{\"key-no\":\"KEY000000000008\",\"job-no\":\"J290001\",\"unit-uketuke-no\":\"UU8A0MYY4378859\",\"gyomu-code\":\"1\",\"gyomu-name\":\"出荷\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":\"1\",\"jan-code\":\"4946452029816\",\"quantity\":1,\"unit-sequence-no\":1,\"unit-name\":\"標準梱包\",\"hso-uketuke-no\":\"HS8A0MYY4945063\",\"rte\":\"B005\",\"rte-name\":\"大阪 Ｂ朝 005\",\"gosya-no\":\"002\",\"coop-code\":\"00680\",\"coop-name\":\"共同配車\",\"niuke-adsr-code\":\"27123\",\"okurijo-no\":\"82120671\"},{\"key-no\":\"KEY000000000009\",\"job-no\":\"J290002\",\"unit-uketuke-no\":\"UU8A0MYY4378860\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":1,\"unit-sequence-no\":2,\"unit-name\":\"SX-J\",\"yso-no\":\"G2698\",\"alert-message\":\"※数量注意※\"},{\"key-no\":\"KEY0000000000010\",\"job-no\":\"J290001\",\"unit-uketuke-no\":\"UU8A0MYY4378859\",\"gyomu-code\":\"1\",\"gyomu-name\":\"出荷\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":\"1\",\"jan-code\":\"4946452029816\",\"quantity\":1,\"unit-sequence-no\":1,\"unit-name\":\"標準梱包\",\"hso-uketuke-no\":\"HS8A0MYY4945063\",\"rte\":\"B005\",\"rte-name\":\"大阪 Ｂ朝 005\",\"gosya-no\":\"002\",\"coop-code\":\"00680\",\"coop-name\":\"共同配車\",\"niuke-adsr-code\":\"27123\",\"okurijo-no\":\"82120671\"},{\"key-no\":\"KEY0000000000011\",\"job-no\":\"J290002\",\"unit-uketuke-no\":\"UU8A0MYY4378860\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":1,\"unit-sequence-no\":2,\"unit-name\":\"SX-J\",\"yso-no\":\"G2698\",\"alert-message\":\"※数量注意※\"},{\"key-no\":\"KEY0000000000012\",\"job-no\":\"J290001\",\"unit-uketuke-no\":\"UU8A0MYY4378859\",\"gyomu-code\":\"1\",\"gyomu-name\":\"出荷\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":\"1\",\"jan-code\":\"4946452029816\",\"quantity\":1,\"unit-sequence-no\":1,\"unit-name\":\"標準梱包\",\"hso-uketuke-no\":\"HS8A0MYY4945063\",\"rte\":\"B005\",\"rte-name\":\"大阪 Ｂ朝 005\",\"gosya-no\":\"002\",\"coop-code\":\"00680\",\"coop-name\":\"共同配車\",\"niuke-adsr-code\":\"27123\",\"okurijo-no\":\"82120671\"},{\"key-no\":\"KEY0000000000013\",\"job-no\":\"J290002\",\"unit-uketuke-no\":\"UU8A0MYY4378860\",\"unit-id\":0,\"nns-soko-code\":\"001\",\"koza\":1,\"unit-sequence-no\":2,\"unit-name\":\"SX-J\",\"yso-no\":\"G2698\",\"alert-message\":\"※数量注意※\"}]}","payloadType":"json","x":200,"y":1020,"wires":[["3c0c838.e4a957c"]]},{"id":"5aa4af3e.f7a33","type":"comment","z":"51c21e98.03293","name":"CLIENT: STOWING ORDER LIST","info":"","x":540,"y":980,"wires":[]},{"id":"b97ce44b.70c948","type":"function","z":"51c21e98.03293","name":"Handle Stowing Response Data","func":"/******************************************************************************\n * @brief   Node handle result to show data on logView\n * @return  The list result data\n * @author  DuyTM\n * @date    2020/08/04  Create\n ******************************************************************************/\nnode.warn({\"data\":msg.payload.data[0][\"sequence-no\"]});\nvar list_Result = [];\nif(!global.get(\"list_Result\")){\n    global.set(\"list_Result\",list_Result);\n}\nelse{\n    list_Result = global.get(\"list_Result\");\n}\n\n\n/******************************************************************************\n * @brief   Get real time \n * @return  The time data\n * @author  DuyTM\n * @date    2020/08/27  Create\n ******************************************************************************/\nvar currentdate = new Date();\nvar timeStemp = currentdate.getDay() + \"/\" + currentdate.getMonth() + \"/\" + currentdate.getFullYear() + \" \" +\ncurrentdate.getHours() + \":\" + currentdate.getMinutes() + \":\" + currentdate.getSeconds();\n\n\n/******************************************************************************\n * @brief   Handle response data when received from API server\n * @return  The handled response data\n * @author  DuyTM\n * @date    2020/08/27  Create\n ******************************************************************************/\nvar responseData = msg.payload.data;\nif((msg.payload) ===\"\"){\n    list_Result.push(timeStemp + `Received Data: empty`);\n}else{\n   if(!(responseData[0][\"sequence-no\"])){\n   for(var key in responseData){\n    if (responseData.hasOwnProperty(key)) {\n         list_Result.push(\n             {\"time\": timeStemp.toString(),\n             \"key-no\": responseData[key][\"key-no\"].toString(),\n             \"sequence-no\": \"\",\n             \"result\": \"Response ok\"\n             });\n            }\n         }\n    } \n}\n\n/******************************************************************************\n * @brief   Update result status when received \n * @return  The handled response data\n * @author  DuyTM\n * @date    2020/08/27  Create\n ******************************************************************************/\n// if((msg.payload.data[0][\"sequence-no\"])){\n//     var keyValue = msg.payload.data[0][\"key-no\"];\n//     var listKeyId= [] ;\n//     for(var item in list_Result)\n//     {\n//         if(list_Result[item][\"key-no\"] == keyValue){\n//             listKeyId.push(item);\n//         }\n//     }\n//     var newKey = Math.max.apply(Math, listKeyId);\n//     list_Result[newKey][\"result\"] = \"Picking completed\";\n//     list_Result[newKey][\"sequence-no\"] =  msg.payload.data[0][\"sequence-no\"];\n//     list_Result[newKey][\"time\"] = timeStemp.toString();\n\n//     //node.warn({\"key\":keyValue}); \n// }\n\n//node.warn({\"key\":list_Result[item][\"key-no\"]}); \n\nglobal.set(\"list_Result\",list_Result);\nmsg.payload = list_Result;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":990,"y":960,"wires":[["ed01286e.59ac68"]]},{"id":"6f550b19.ab0e44","type":"link out","z":"51c21e98.03293","name":"Send stowing exception","links":["417fddb1.a12f14"],"x":970,"y":1020,"wires":[],"l":true},{"id":"b4d560c6.44f3d","type":"link in","z":"51c21e98.03293","name":"","links":["ec647814.b8d118"],"x":95,"y":1080,"wires":[["33b92d61.6ab612"]]},{"id":"6ef7736b.7ff33c","type":"link out","z":"51c21e98.03293","name":"","links":["802f5c8f.d0a01"],"x":835,"y":1080,"wires":[]},{"id":"ed01286e.59ac68","type":"link out","z":"51c21e98.03293","name":"Send data log view","links":["82008362.af56a"],"x":1290,"y":960,"wires":[],"l":true},{"id":"33b92d61.6ab612","type":"function","z":"51c21e98.03293","name":"Set url inbound","func":"msg.url = global.get(\"inbound\");\n\n//msg.url = \"http://10.116.41.70:5050/agv-web/v1.0/inbound\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":260,"y":1080,"wires":[["3c0c838.e4a957c"]]},{"id":"5010b91e.0195c8","type":"http in","z":"51c21e98.03293","name":"","url":"/send-stowing-order","method":"post","upload":true,"swaggerDoc":"","x":170,"y":1900,"wires":[["42b3e3de.7eb7ec"]]},{"id":"fc43b93f.d7f548","type":"comment","z":"51c21e98.03293","name":"Insert stowing file","info":"","x":141,"y":1860,"wires":[]},{"id":"42b3e3de.7eb7ec","type":"function","z":"51c21e98.03293","name":"Check Stowing Order List","func":"/******************************************************************************\n * @brief   Node add file type parameter \n * @return  The data file of picking order list\n * @author  DuyTM\n * @date    2020/08/04  Create\n ******************************************************************************/\nmsg.fileType = \"Stowing\";\nreturn msg;","outputs":1,"noerr":0,"x":438,"y":1900,"wires":[["93b980a0.6adc1"]]},{"id":"a4857235.466a","type":"json","z":"51c21e98.03293","name":"parser_json_stowinglist","property":"payload","action":"obj","pretty":false,"x":1350,"y":1600,"wires":[["40c1b93c.5e7398"]]},{"id":"ec647814.b8d118","type":"link out","z":"51c21e98.03293","name":"Send stowing order list","links":["498d0a43.a99864","b4d560c6.44f3d"],"x":1940,"y":1580,"wires":[],"l":true},{"id":"3cb216e9.69beea","type":"http in","z":"51c21e98.03293","name":"Server: Stowing Result","url":"/v1.0/inbound-result","method":"post","upload":false,"swaggerDoc":"","x":160,"y":280,"wires":[["11c260c9.dc92cf","65eae4c.0f8011c"]]},{"id":"d1870002.d0863","type":"http response","z":"51c21e98.03293","name":"Response","statusCode":"","headers":{},"x":960,"y":280,"wires":[]},{"id":"5932ef68.b5eb6","type":"comment","z":"51c21e98.03293","name":"SERVER: stowing result","info":"","x":170,"y":240,"wires":[]},{"id":"f08236f0.7eb968","type":"function","z":"51c21e98.03293","name":"Function response","func":"/******************************************************************************\n * @brief   Node return picking result\n * @return  the picking result value\n * @author  DuyTM\n * @date    2020/08/04  Create\n ******************************************************************************/\nnode.warn({\"data outbound result\":msg.payload});\nvar isRunning = flow.get(\"running\");\n\nvar res_msg = {};\n\nif (isRunning)\n{\n    msg.statusCode = 200;\n    var response = {\"result\": \"ok\"};\n    msg.payload = response;\n\n} else {\n    msg.statusCode = 503;\n    var response = {};\n    msg.payload = undefined;\n}\nreturn msg;","outputs":1,"noerr":0,"x":730,"y":280,"wires":[["d1870002.d0863"]]},{"id":"85374659.8a5ef8","type":"link out","z":"51c21e98.03293","name":"","links":["82008362.af56a"],"x":655,"y":320,"wires":[]},{"id":"11c260c9.dc92cf","type":"function","z":"51c21e98.03293","name":"Function Update Stowing Complete","func":"/******************************************************************************\n * @brief   Update result status when received \n * @return  The handled response data\n * @author  DuyTM\n * @date    2020/08/27  Create\n ******************************************************************************/\nnode.warn({\"data-test\":msg.payload.data});\n\nif(!global.get(\"list_Result\")){\n    var list_Result = [];\n    global.set(\"list_Result\",list_Result);\n}\nelse{\n    list_Result = global.get(\"list_Result\");\n}\n\n/******************************************************************************\n * @brief   Get real time \n * @return  The time data\n * @author  DuyTM\n * @date    2020/08/27  Create\n ******************************************************************************/\nvar currentdate = new Date();\nvar timeStemp = currentdate.getDay() + \"/\" + currentdate.getMonth() + \"/\" + currentdate.getFullYear() + \" \" +\ncurrentdate.getHours() + \":\" + currentdate.getMinutes() + \":\" + currentdate.getSeconds();\n\n\n/******************************************************************************\n * @brief   Update result status when received \n * @return  The handled response data\n * @author  DuyTM\n * @date    2020/08/27  Create\n ******************************************************************************/\nif((msg.payload)){\n    var keyValue = msg.payload.data[0][\"key-no\"];\n    var listKeyId= [] ;\n    if(list_Result.length >0 ){\n        for(var item in list_Result)\n        {\n            if(list_Result[item][\"key-no\"] == keyValue){\n                listKeyId.push(item);\n            }\n        }\n        node.warn({\"listKeyId\":listKeyId});\n        if(listKeyId.length >0){\n            var newKey = Math.max.apply(Math, listKeyId);\n            node.warn({\"index-key\":newKey});\n            list_Result[newKey][\"result\"] = \"Stowing completed\";\n            list_Result[newKey][\"sequence-no\"] =  msg.payload.data[0][\"sequence-no\"];\n            list_Result[newKey][\"time\"] = timeStemp.toString();\n        }else{\n            list_Result.push(\n             {\"time\": timeStemp.toString(),\n             \"key-no\": msg.payload.data[0][\"key-no\"],\n             \"sequence-no\": msg.payload.data[0][\"sequence-no\"],\n            //  \"tray-id\": responseData[key][\"hkat-shiji-no\"].toString(),\n             \"result\": \"Stowing completed\"\n        });\n        }\n    }\n   else{\n        node.warn({\"testData\":msg.payload.data});\n    //   for(var i in msg.payload.data ){\n        \n    //     list_Result.push(\n    //          {\"time\": timeStemp.toString(),\n    //          \"key-no\": i[\"key-no\"],\n    //          \"sequence-no\": i[\"sequence-no\"],\n    //         //  \"tray-id\": responseData[key][\"hkat-shiji-no\"].toString(),\n    //          \"result\": \"Stowing completed\"\n    //     });\n    //   }\n    \n    list_Result.push(\n         {\"time\": timeStemp.toString(),\n         \"key-no\": msg.payload.data[0][\"key-no\"],\n         \"sequence-no\": msg.payload.data[0][\"sequence-no\"],\n        //  \"tray-id\": responseData[key][\"hkat-shiji-no\"].toString(),\n         \"result\": \"Stowing completed\"\n    });\n    }\n    \n}\n\n//  \"tray-id\": responseData[key][\"unit_uketuke_no\"].toString(),\n//node.warn({\"key\":list_Result[item][\"key-no\"]}); \nglobal.set(\"list_Result\",list_Result);\n\nmsg.payload = global.get(\"list_Result\");\n\nnode.warn({\"data-list\":msg.payload});\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":460,"y":280,"wires":[["f08236f0.7eb968","85374659.8a5ef8","d4ba7a80.c97258"]]},{"id":"d4ba7a80.c97258","type":"debug","z":"51c21e98.03293","name":"Data inbound","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":720,"y":240,"wires":[]},{"id":"5b7fbb3c.b40834","type":"http response","z":"51c21e98.03293","name":"","statusCode":"","headers":{},"x":630,"y":3800,"wires":[]},{"id":"c085f69e.c05ba8","type":"function","z":"51c21e98.03293","name":"Handle ","func":"msg.payload = {\n\t\"data\":[\n\t\t{\n\t\t\t\"key-no\": \"KEY000000000001\",\n\t\t\t\"result\": \"ok\"\n\t\t}\n\t]\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":400,"y":3800,"wires":[["5b7fbb3c.b40834"]]},{"id":"a5b0d67c.effb48","type":"http in","z":"51c21e98.03293","name":"Inbound server","url":"/agv-web/v1.0/inbound","method":"post","upload":true,"swaggerDoc":"","x":128,"y":3800,"wires":[["c085f69e.c05ba8"]]},{"id":"76957a27.ca3b64","type":"comment","z":"51c21e98.03293","name":"SET URL SETTING FILE INTO GLOBAL","info":"","x":1296,"y":80,"wires":[]},{"id":"3b8421d2.0843de","type":"inject","z":"51c21e98.03293","name":"Inbound object","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"{\"data\":[{\"key-no\":\"KEY000001000005\",\"sequence-no\":1,\"zk-kanri\":\"20075\",\"scan-barcode\":\"01040428095794681020075\",\"jiseki-quantity\":100,\"user-code\":\"12345\"}]}","payloadType":"json","x":160,"y":3940,"wires":[["da0ee92e.6519c8"]]},{"id":"da0ee92e.6519c8","type":"http request","z":"51c21e98.03293","name":"Inbound result","method":"POST","ret":"txt","paytoqs":"ignore","url":"http://localhost:1880/v1.0/inbound-result","tls":"","persist":true,"proxy":"","authType":"","x":364,"y":3940,"wires":[["cc8a165a.34d288"]]},{"id":"cc8a165a.34d288","type":"debug","z":"51c21e98.03293","name":"Result Inbound","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","x":584,"y":3940,"wires":[]},{"id":"d9290d9f.82ca2","type":"ui_button","z":"51c21e98.03293","name":"Order List","group":"fb4fee1c.baa0a","order":0,"width":"3","height":"1","passthru":false,"label":"Orders list","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"WMS0806_Table_Products\"],\"show\":[\"WMS0806_Table_Order_List\"],\"enabled\":[]}}","payloadType":"json","topic":"order_list","x":1240,"y":3120,"wires":[["f0bcd183.ae19f","242cfe05.271da2"]]},{"id":"e85aaffc.0b23","type":"ui_button","z":"51c21e98.03293","name":"Products List","group":"fb4fee1c.baa0a","order":0,"width":"3","height":"1","passthru":false,"label":"Products list","tooltip":"","color":"","bgcolor":"","icon":"","payload":"{\"group\":{\"hide\":[\"WMS0806_Table_Order_List\"],\"show\":[\"WMS0806_Table_Products\"],\"enabled\":[]}}","payloadType":"json","topic":"product_list","x":1250,"y":3340,"wires":[["f0bcd183.ae19f","242cfe05.271da2"]]},{"id":"f0bcd183.ae19f","type":"ui_ui_control","z":"51c21e98.03293","name":"UI control show table","x":1580,"y":3220,"wires":[[]]},{"id":"2ad9b065.54aaf","type":"ui_table","z":"51c21e98.03293","group":"eac8d8a2.3a7828","name":"Table Products","order":2,"width":"35","height":"4","columns":[{"field":"time","title":"Time","width":"15%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"jan-code","title":"Jan-code","width":"25%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"result","title":"Result","width":"15 %","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"errorCode","title":"Error code","width":"30%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"error-message","title":"Error message","width":"15%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":0,"cts":false,"x":1320,"y":2120,"wires":[]},{"id":"d21ca411.2134e8","type":"inject","z":"51c21e98.03293","name":"Init table log","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"{\"group\":{\"hide\":[\"WMS0806_Table_Products\"],\"show\":[\"WMS0806_Table_Order_List\"]}}","payloadType":"json","x":1210,"y":3040,"wires":[["f0bcd183.ae19f"]]},{"id":"b17b1e93.cb724","type":"comment","z":"51c21e98.03293","name":"Clear log table","info":"","x":250,"y":2098,"wires":[]},{"id":"b9b431b5.edc12","type":"ui_button","z":"51c21e98.03293","name":"Clear product table","group":"eac8d8a2.3a7828","order":3,"width":"3","height":1,"passthru":true,"label":"Clear Log Table","tooltip":"","color":"","bgcolor":"","icon":"","payload":"Do you want to delete data ?","payloadType":"str","topic":"Clear product table","x":270,"y":2138,"wires":[["2877122c.32855e"]]},{"id":"4c58fa89.e34ac4","type":"inject","z":"51c21e98.03293","name":"Init order list button","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":990,"y":3140,"wires":[["d9290d9f.82ca2"]]},{"id":"4f13e9f7.6fe768","type":"inject","z":"51c21e98.03293","name":"Init product list button","repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","x":1020,"y":3340,"wires":[["e85aaffc.0b23"]]},{"id":"242cfe05.271da2","type":"function","z":"51c21e98.03293","name":"Enable/Disable button","func":"if (msg.topic === \"order_list\") {\n    flow.set(\"running\", true);\n} else if (msg.topic === \"product_list\") {\n    flow.set(\"running\", false);\n} else {\n    node.warn(\"Wrong payload message\");\n}\n\nlet enableMsg = {};\nenableMsg.enabled = !flow.get(\"running\");\nenableMsg.payload = '';\n\nlet disableMsg = {};\ndisableMsg.enabled = flow.get(\"running\");\ndisableMsg.payload = '';\n\nreturn [enableMsg, disableMsg];","outputs":2,"noerr":0,"x":1240,"y":3220,"wires":[["d9290d9f.82ca2"],["e85aaffc.0b23"]]},{"id":"4ab07c43.d40bc4","type":"debug","z":"51c21e98.03293","name":"file name","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":1620,"y":2580,"wires":[]},{"id":"e9f9c70e.e0ea58","type":"catch","z":"51c21e98.03293","name":"Catch data file invalid","scope":["ddf2d7df.bf6108","241cc28.850403e","a4857235.466a"],"uncaught":false,"x":160,"y":2880,"wires":[["c8ee8ad7.85d178"]]},{"id":"c8ee8ad7.85d178","type":"function","z":"51c21e98.03293","name":"Throw exception data invalid","func":"if(msg.error){\n    msg.payload = \"data_invalid\";\n}else{\n    \n    // node.warn({\"error\":\"Not error\"});\n}\n// msg.payload = msg.schemaErrorarray;\nreturn msg;","outputs":1,"noerr":0,"x":440,"y":2880,"wires":[["64a9459f.875dec"]]},{"id":"36f1c630.9644ca","type":"inject","z":"51c21e98.03293","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"stop","payloadType":"str","x":150,"y":3240,"wires":[["fb8f036a.ea69e"]]},{"id":"90994edd.7c60f","type":"file in","z":"51c21e98.03293","name":"Read file from file path","filename":"","format":"utf8","chunk":false,"sendError":false,"encoding":"none","x":1240,"y":1920,"wires":[["5a3e5e2a.fef91"]]},{"id":"df8bacf3.e7627","type":"function","z":"51c21e98.03293","name":"Function file name","func":"//msg.filename = msg.payload.file;\nnode.warn({\"dataFile\":msg});\n\n//msg.filename = \"F:\\\\Download\\\\New folder\\\\OrderPicking.json\";\n\nmsg.filename = String(msg.payload.file);\nreturn msg;","outputs":1,"noerr":0,"x":990,"y":1920,"wires":[["90994edd.7c60f"]]},{"id":"5a3e5e2a.fef91","type":"function","z":"51c21e98.03293","name":"Function check file","func":"if(msg.payload !== \"\"){\n    if(msg.fileType == \"Product\"){\n         return [msg,,,];\n    }\n    else if(msg.fileType == \"Picking\"){\n         return [,msg,,];\n    }\n    else if(msg.fileType == \"Stowing\"){\n         return [,,msg,];\n    }\n}else{\n    return [,,,msg];\n}\n","outputs":4,"noerr":0,"initialize":"","finalize":"","x":1490,"y":1920,"wires":[["7d494f7a.75809"],["500deede.11182"],["edfff981.889d28"],["1fd19095.c9ef6f"]]},{"id":"8153520a.4c70e","type":"catch","z":"51c21e98.03293","name":"Catch wrong file path","scope":["90994edd.7c60f"],"uncaught":false,"x":160,"y":2940,"wires":[["5c5d1f0f.04a05"]]},{"id":"5c5d1f0f.04a05","type":"function","z":"51c21e98.03293","name":"Throw exception wrong file path","func":"node.warn({\"datatest\":msg.payload});\nif(msg.error){\n    msg.payload = \"wrong_file_path\";\n}else{\n    \n    // node.warn({\"error\":\"Not error\"});\n}\n// msg.payload = msg.schemaErrorarray;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":2940,"wires":[["64a9459f.875dec"]]},{"id":"40c1b93c.5e7398","type":"function","z":"51c21e98.03293","name":"Throw exception no data in file","func":"\nif(!msg.payload.data[0]){\n    node.warn({\"dddddd\":\"ddddd\"});\n    throw \"empty_file_content\";\n    return [msg,];\n}else{\n    if(msg.fileType == \"Product\"){\n        return [,msg,,];\n    }else if(msg.fileType == \"Picking\"){\n        return [,,msg,];\n    }else if(msg.fileType == \"Stowing\"){\n        return [,,,msg];\n    }else{\n        //do_something\n    }\n   \n}\n\n","outputs":4,"noerr":0,"initialize":"","finalize":"","x":1670,"y":1520,"wires":[[],["518c0c96.1c4574"],["277736b.ba4b8ca"],["ec647814.b8d118"]]},{"id":"c208a1bd.660b","type":"catch","z":"51c21e98.03293","name":"Catch no data in file","scope":["40c1b93c.5e7398"],"uncaught":false,"x":150,"y":3000,"wires":[["9e286a3a.243f68"]]},{"id":"9e286a3a.243f68","type":"function","z":"51c21e98.03293","name":"Throw exception no data in file","func":"/******************************************************************************\n * @brief   Node throw exception when choose empty file\n * @return  The exception\n * @author  DuyTM\n * @date    2020/08/04  Create\n ******************************************************************************/\nmsg.payload = \"no_data_item\";\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":450,"y":3000,"wires":[["64a9459f.875dec"]]},{"id":"5a977e0e.149ff","type":"function","z":"51c21e98.03293","name":"Handle Product Response Data","func":"\nnode.warn({\"data\":msg.payload.data[0][\"sequence-no\"]});\nvar list_Product_Result = [];\nif(!global.get(\"list_Product_Result\")){\n    global.set(\"list_Product_Result\",list_Product_Result);\n}\nelse{\n    list_Product_Result = global.get(\"list_Product_Result\");\n}\nlist_Product_Result = JSON.parse(JSON.stringify(list_Product_Result));\n\nvar currentdate = new Date();\nvar timeStemp = currentdate.getDay() + \"/\" + currentdate.getMonth() + \"/\" + currentdate.getFullYear() + \" \" +\ncurrentdate.getHours() + \":\" + currentdate.getMinutes() + \":\" + currentdate.getSeconds();\n\nvar responseData = msg.payload.data;\n\nif((msg.payload) ===\"\"){\n    list_Product_Result.push(timeStemp + `Received Data: empty`);\n}else{\n   if((responseData[0][\"jan-code\"])){\n   for(var key in responseData){\n    if (responseData.hasOwnProperty(key)) {\n         list_Product_Result.push(\n             {\"time\": timeStemp.toString(),\n             \"jan-code\": responseData[key][\"jan-code\"].toString(),\n             \"result\": responseData[key][\"result\"],\n             \"errorCode\": responseData[key][\"errorCode\"],\n             \"error-message\": responseData[key][\"error-message\"]\n             });\n            }\n         }\n    }else{\n        throw \"data_invalid\";\n        return msg;\n    } \n}\n\nglobal.set(\"list_Product_Result\",list_Product_Result);\nmsg.payload = list_Product_Result;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1150,"y":660,"wires":[["634ded33.9f93f4"]]},{"id":"86556e86.4ddc8","type":"ui_toast","z":"51c21e98.03293","position":"dialog","displayTime":"3","highlight":"","sendall":true,"outputs":1,"ok":"OK","cancel":"Cancel","raw":false,"topic":"","name":"Confirm clear data","x":650,"y":2320,"wires":[["f1bda25b.0dfb8"]]},{"id":"f1bda25b.0dfb8","type":"function","z":"51c21e98.03293","name":"Filter msg and clear data","func":"//only accept OK msg's\nif (msg.payload == 'OK') {\n    if (msg.topic == \"Clear product table\"){\n        msg.payload = [];\n        global.set(\"list_Product_Result\",[]);\n        return [msg,,,];\n    }else if(msg.topic == \"Clear log table\"){\n        msg.payload = [];\n        global.set(\"list_Result\",[]);\n        return [,msg,,];\n        \n    }else if(msg.topic == \"Clear log view\"){\n        msg.payload = [];\n        global.set(\"list_Ex_Result\",[]);\n        return [,,msg,];    \n    }else if(msg.topic == \"Clear log all view\"){\n        msg.payload = [];\n        global.set(\"listAllResult\",[]);\n        return [,,,msg];\n    }\n}\nreturn null;","outputs":4,"noerr":0,"initialize":"","finalize":"","x":830,"y":2250,"wires":[["2ad9b065.54aaf"],["7572b251.41857c"],["caa93e24.ba00a"],["3eee87dd.039b58"]]},{"id":"b7142fa.27fa8d","type":"link in","z":"51c21e98.03293","name":"","links":["3bb2aa21.3d3086","634ded33.9f93f4"],"x":1195,"y":2080,"wires":[["2ad9b065.54aaf"]]},{"id":"634ded33.9f93f4","type":"link out","z":"51c21e98.03293","name":"","links":["b7142fa.27fa8d"],"x":1375,"y":660,"wires":[]},{"id":"4591905c.14859","type":"link in","z":"51c21e98.03293","name":"","links":["a3153895.5e43d8"],"x":1175,"y":2360,"wires":[["3eee87dd.039b58"]]},{"id":"784be2bd.b6cd6c","type":"link in","z":"51c21e98.03293","name":"","links":["4b163c2b.139444"],"x":95,"y":2260,"wires":[["3502911e.4015ee","b9b431b5.edc12","b2d402d0.a3655","17415d4c.633f43"]]},{"id":"2877122c.32855e","type":"function","z":"51c21e98.03293","name":"Check click","func":"if(msg.typeClick == 'start_stop'){\n    return [msg,];\n}\nreturn [,msg];","outputs":2,"noerr":0,"initialize":"","finalize":"","x":510,"y":2260,"wires":[["f1bda25b.0dfb8"],["86556e86.4ddc8"]]},{"id":"3910a8d3.1fcff8","type":"link in","z":"51c21e98.03293","name":"","links":["4b163c2b.139444"],"x":1115,"y":3080,"wires":[["d9290d9f.82ca2"]]},{"id":"1ac4f818.2bcfa8","type":"link in","z":"51c21e98.03293","name":"","links":["4b163c2b.139444"],"x":1135,"y":3400,"wires":[["e85aaffc.0b23"]]},{"id":"65eae4c.0f8011c","type":"debug","z":"51c21e98.03293","name":"Inbound Result","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","x":400,"y":240,"wires":[]},{"id":"75e3acd3.7e05d4","type":"link out","z":"51c21e98.03293","name":"","links":["83bd03e0.7cb47"],"x":915,"y":1780,"wires":[]},{"id":"83bd03e0.7cb47","type":"link in","z":"51c21e98.03293","name":"","links":["75e3acd3.7e05d4","edfff981.889d28"],"x":1175,"y":1600,"wires":[["a4857235.466a"]]},{"id":"44317765.9b1538","type":"link out","z":"51c21e98.03293","name":"","links":["92e0b6ab.466338"],"x":915,"y":1680,"wires":[]},{"id":"92e0b6ab.466338","type":"link in","z":"51c21e98.03293","name":"","links":["44317765.9b1538"],"x":1615,"y":2040,"wires":[["1fd19095.c9ef6f"]]},{"id":"e0709e6d.61f93","type":"link out","z":"51c21e98.03293","name":"","links":["356d7a90.c568f6"],"x":915,"y":1580,"wires":[]},{"id":"356d7a90.c568f6","type":"link in","z":"51c21e98.03293","name":"","links":["e0709e6d.61f93","7d494f7a.75809"],"x":1175,"y":1460,"wires":[["ddf2d7df.bf6108"]]},{"id":"824466af.318d28","type":"link out","z":"51c21e98.03293","name":"","links":["43f42dea.76e0c4"],"x":915,"y":1640,"wires":[]},{"id":"43f42dea.76e0c4","type":"link in","z":"51c21e98.03293","name":"","links":["824466af.318d28","500deede.11182"],"x":1175,"y":1520,"wires":[["241cc28.850403e"]]},{"id":"7d494f7a.75809","type":"link out","z":"51c21e98.03293","name":"","links":["356d7a90.c568f6"],"x":1695,"y":1800,"wires":[]},{"id":"500deede.11182","type":"link out","z":"51c21e98.03293","name":"","links":["43f42dea.76e0c4"],"x":1695,"y":1880,"wires":[]},{"id":"edfff981.889d28","type":"link out","z":"51c21e98.03293","name":"","links":["83bd03e0.7cb47"],"x":1695,"y":1940,"wires":[]},{"id":"ecee0ca2.4b9c6","type":"comment","z":"51c21e98.03293","name":"Table products","info":"","x":1320,"y":2080,"wires":[]},{"id":"c57a9b89.116198","type":"comment","z":"51c21e98.03293","name":"Table order view","info":"","x":1320,"y":2190,"wires":[]},{"id":"d5d48ff8.aa43c","type":"comment","z":"51c21e98.03293","name":"Exception view","info":"","x":1320,"y":2280,"wires":[]},{"id":"bb196b57.b3d518","type":"comment","z":"51c21e98.03293","name":"Mockup server","info":"","x":140,"y":3900,"wires":[]},{"id":"66697c11.e2f664","type":"comment","z":"51c21e98.03293","name":"Start/ Stop WMS","info":"","x":180,"y":3140,"wires":[]},{"id":"46627736.ddbb28","type":"comment","z":"51c21e98.03293","name":"Multiple tab","info":"","x":970,"y":3100,"wires":[]},{"id":"364b382d.49faf8","type":"comment","z":"51c21e98.03293","name":"Call url to send data","info":"","x":690,"y":1600,"wires":[]},{"id":"6bb39dbf.93b7f4","type":"function","z":"76082a9f.b8c304","name":"Add Row DAS 1","func":"var table_list = [];\nvar item_code = msg.payload;\nvar item_table = {};\n\nvar d = new Date();\nlocaltime = d.toLocaleTimeString('en-US', { hour12: false });\n\nitem_table[\"das1_col_time\"] = localtime;\nitem_table[\"das1_col_log\"] = String(msg.payload);\ntable_list.push(item_table);\nmsg.payload= {\n    command:\"addRow\",\n    arguments: table_list,\n    returnPromise: true\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":200,"wires":[["57ab5123.86aff"]]},{"id":"dc0060bb.7435","type":"ui_button","z":"76082a9f.b8c304","name":"","group":"c14fa1e.38aa36","order":4,"width":4,"height":1,"passthru":false,"label":"Clear DAS Log","tooltip":"clear all table data","color":"","bgcolor":"","icon":"","payload":"true","payloadType":"bool","topic":"","x":280,"y":280,"wires":[["1ac47f5b.d4eee1"]]},{"id":"1ac47f5b.d4eee1","type":"function","z":"76082a9f.b8c304","name":"clearData","func":"\nmsg.payload={\n    command:\"clearData\",\n    arguments: [],\n    returnPromise: true\n}\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":260,"wires":[["57ab5123.86aff"]],"info":"# clear data\n\nunfortunately this command (currently) do not send a promise back! So we have to pass it directly to the table handler"},{"id":"57ab5123.86aff","type":"ui_table","z":"76082a9f.b8c304","group":"ff5cab0a.813058","name":"Das1 Log Table","order":1,"width":"35","height":5,"columns":[{"field":"das1_col_no","title":"No","width":"10%","align":"left","formatter":"rownum","formatterParams":{"target":"_blank"}},{"field":"das1_col_time","title":"Time","width":"30%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"das1_col_log","title":"DAS 1 Log","width":"60%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":1,"cts":true,"x":880,"y":240,"wires":[[]],"icon":"font-awesome/fa-th"},{"id":"72b9e080.3b176","type":"function","z":"76082a9f.b8c304","name":"Split message","func":"CommonFunction = flow.get(\"commonFunctionsDas\");\nlet listTrayDb = flow.get('listTrayDb');\nlet request = new Object();\nlet systemStatus = flow.get('systemStatus');\nmsg.payload = msg.payload.toString();\nnode.warn(msg.payload);\nrequest.dasid= CommonFunction.FilterString(msg.payload.substr(5,3));\nrequest.command = CommonFunction.FilterString(msg.payload.substr(8,12));\nrequest.par1= CommonFunction.FilterString(msg.payload.substr(20,16));\nrequest.par2= CommonFunction.FilterString(msg.payload.substr(36,16));\n\nfor(let i = 0; i < listTrayDb.length; i++) {\n    if(listTrayDb[i][0] === Number(request.par2)) {\n        request.par2 = listTrayDb[i][2];\n        msg.locationId = listTrayDb[i][1];\n        break;\n    }\n}\nnode.warn(request.par2);\nrequest.par3 = CommonFunction.FilterString(msg.payload.substr(52,16));\nnode.warn(msg.payload.substr(53,16));\nnode.warn(request.par3);\nmsg.payload=request;\ndelete msg.confirm;\nif(systemStatus == 1){\n    return msg;\n}\nelse return;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1760,"y":1280,"wires":[["32879c2d.070634","17d1363.b2184ca"]]},{"id":"5622a8e7.09f3a8","type":"link in","z":"76082a9f.b8c304","name":"","links":["85df9024.90fb9","921898a2.4a1278","286bf842.491e58","f5238884.9dc098","a6768e9b.3c84d","6ea98042.0e8f4"],"x":215,"y":1160,"wires":[["5d5d9424.2fbfec"]]},{"id":"32879c2d.070634","type":"switch","z":"76082a9f.b8c304","name":"split command","property":"payload.command","propertyType":"msg","rules":[{"t":"eq","v":"CHANGE_LED","vt":"str"},{"t":"eq","v":"SET_LOCATION","vt":"str"},{"t":"eq","v":"SET_TRAYID","vt":"str"}],"checkall":"false","repair":false,"outputs":3,"x":2000,"y":1260,"wires":[["82a31dcc.89939","490e0a40.be5e44"],["edd8446a.955738"],["69eb30bc.45995"]]},{"id":"82a31dcc.89939","type":"function","z":"76082a9f.b8c304","name":"Set LED's Color","func":"let color = msg.payload.par3;\nlet flowVar = msg.payload.par2 + '_LED';\nflow.set(flowVar, color);\nnode.warn(flowVar);\n\n\n// if(msg.payload.dasid == '1'){       \n    \n    \n//     if(msg.payload.par2 == 'rack11')        flow.set(\"das1_color11\", color);\n//     else if(msg.payload.par2 == 'C1')   flow.set(\"das1_color12\", color);\n//     else if(msg.payload.par2 == 'rack13')   flow.set(\"das1_color13\", color);\n//     else if(msg.payload.par2 == 'rack14')   flow.set(\"das1_color14\", color);\n//     else if(msg.payload.par2 == 'rack21')   flow.set(\"das1_color21\", color);\n//     else if(msg.payload.par2 == 'rack22')   flow.set(\"das1_color22\", color);\n//     else if(msg.payload.par2 == 'rack23')   flow.set(\"das1_color23\", color);\n//     else if(msg.payload.par2 == 'rack24')   flow.set(\"das1_color24\", color);\n//     else if(msg.payload.par2 == 'rack31')   flow.set(\"das1_color31\", color);\n//     else if(msg.payload.par2 == 'rack32')   flow.set(\"das1_color32\", color);\n//     else if(msg.payload.par2 == 'rack33')   flow.set(\"das1_color33\", color);\n//     else if(msg.payload.par2 == 'rack34')   flow.set(\"das1_color34\", color);\n// }               \n\n// else if(msg.payload.dasid == '2'){\n//     if(msg.payload.par2 == 'rack11')        flow.set(\"das2_color11\", color);\n//     else if(msg.payload.par2 == 'rack12')   flow.set(\"das2_color12\", color);\n//     else if(msg.payload.par2 == 'rack13')   flow.set(\"das2_color13\", color);\n//     else if(msg.payload.par2 == 'rack14')   flow.set(\"das2_color14\", color);\n//     else if(msg.payload.par2 == 'rack21')   flow.set(\"das2_color21\", color);\n//     else if(msg.payload.par2 == 'rack22')   flow.set(\"das2_color22\", color);\n//     else if(msg.payload.par2 == 'rack23')   flow.set(\"das2_color23\", color);\n//     else if(msg.payload.par2 == 'rack24')   flow.set(\"das2_color24\", color);\n//     else if(msg.payload.par2 == 'rack31')   flow.set(\"das2_color31\", color);\n//     else if(msg.payload.par2 == 'rack32')   flow.set(\"das2_color32\", color);\n//     else if(msg.payload.par2 == 'rack33')   flow.set(\"das2_color33\", color);\n//     else if(msg.payload.par2 == 'rack34')   flow.set(\"das2_color34\", color);\n// }\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2260,"y":1220,"wires":[["17d1363.b2184ca"]]},{"id":"17d1363.b2184ca","type":"link out","z":"76082a9f.b8c304","name":"","links":["58e44010.fe604","181ac63e.62a5aa"],"x":2475,"y":1260,"wires":[]},{"id":"d9e4acb4.9be33","type":"comment","z":"76082a9f.b8c304","name":"DAS system","info":"","x":270,"y":420,"wires":[]},{"id":"edd8446a.955738","type":"function","z":"76082a9f.b8c304","name":"Set Tray Location","func":"let location = msg.payload.par3;\n\nif(msg.payload.dasid == '1'){               \n    if(msg.payload.par2 ==      'rack11')   flow.set(\"das1_location11\", location);\n    else if(msg.payload.par2 == 'rack12')   flow.set(\"das1_location12\", location);\n    else if(msg.payload.par2 == 'rack13')   flow.set(\"das1_location13\", location);\n    else if(msg.payload.par2 == 'rack14')   flow.set(\"das1_location14\", location);\n    else if(msg.payload.par2 == 'rack21')   flow.set(\"das1_location21\", location);\n    else if(msg.payload.par2 == 'rack22')   flow.set(\"das1_location22\", location);\n    else if(msg.payload.par2 == 'rack23')   flow.set(\"das1_location23\", location);\n    else if(msg.payload.par2 == 'rack24')   flow.set(\"das1_location24\", location);\n    else if(msg.payload.par2 == 'rack31')   flow.set(\"das1_location31\", location);\n    else if(msg.payload.par2 == 'rack32')   flow.set(\"das1_location32\", location);\n    else if(msg.payload.par2 == 'rack33')   flow.set(\"das1_location33\", location);\n    else if(msg.payload.par2 == 'rack34')   flow.set(\"das1_location34\", location);\n}               \n\nelse if(msg.payload.dasid == '2'){\n    if(msg.payload.par2 == 'rack11')        flow.set(\"das2_location11\", location);\n    else if(msg.payload.par2 == 'rack12')   flow.set(\"das2_location12\", location);\n    else if(msg.payload.par2 == 'rack13')   flow.set(\"das2_location13\", location);\n    else if(msg.payload.par2 == 'rack14')   flow.set(\"das2_location14\", location);\n    else if(msg.payload.par2 == 'rack21')   flow.set(\"das2_location21\", location);\n    else if(msg.payload.par2 == 'rack22')   flow.set(\"das2_location22\", location);\n    else if(msg.payload.par2 == 'rack23')   flow.set(\"das2_location23\", location);\n    else if(msg.payload.par2 == 'rack24')   flow.set(\"das2_location24\", location);\n    else if(msg.payload.par2 == 'rack31')   flow.set(\"das2_location31\", location);\n    else if(msg.payload.par2 == 'rack32')   flow.set(\"das2_location32\", location);\n    else if(msg.payload.par2 == 'rack33')   flow.set(\"das2_location33\", location);\n    else if(msg.payload.par2 == 'rack34')   flow.set(\"das2_location34\", location);\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":2270,"y":1260,"wires":[["17d1363.b2184ca"]]},{"id":"69eb30bc.45995","type":"function","z":"76082a9f.b8c304","name":"Set Tray ID","func":"let trayid = msg.payload.par3;\n\nif(msg.payload.dasid == '1'){               \n    if(msg.payload.par2 == 'rack11')        flow.set(\"das1_trayid11\", trayid);\n    else if(msg.payload.par2 == 'rack12')   flow.set(\"das1_trayid12\", trayid);\n    else if(msg.payload.par2 == 'rack13')   flow.set(\"das1_trayid13\", trayid);\n    else if(msg.payload.par2 == 'rack14')   flow.set(\"das1_trayid14\", trayid);\n    else if(msg.payload.par2 == 'rack21')   flow.set(\"das1_trayid21\", trayid);\n    else if(msg.payload.par2 == 'rack22')   flow.set(\"das1_trayid22\", trayid);\n    else if(msg.payload.par2 == 'rack23')   flow.set(\"das1_trayid23\", trayid);\n    else if(msg.payload.par2 == 'rack24')   flow.set(\"das1_trayid24\", trayid);\n    else if(msg.payload.par2 == 'rack31')   flow.set(\"das1_trayid31\", trayid);\n    else if(msg.payload.par2 == 'rack32')   flow.set(\"das1_trayid32\", trayid);\n    else if(msg.payload.par2 == 'rack33')   flow.set(\"das1_trayid33\", trayid);\n    else if(msg.payload.par2 == 'rack34')   flow.set(\"das1_trayid34\", trayid);\n}               \n\nelse if(msg.payload.dasid == '2'){\n    if(msg.payload.par2 == 'rack11')        flow.set(\"das2_trayid11\", trayid);\n    else if(msg.payload.par2 == 'rack12')   flow.set(\"das2_trayid12\", trayid);\n    else if(msg.payload.par2 == 'rack13')   flow.set(\"das2_trayid13\", trayid);\n    else if(msg.payload.par2 == 'rack14')   flow.set(\"das2_trayid14\", trayid);\n    else if(msg.payload.par2 == 'rack21')   flow.set(\"das2_trayid21\", trayid);\n    else if(msg.payload.par2 == 'rack22')   flow.set(\"das2_trayid22\", trayid);\n    else if(msg.payload.par2 == 'rack23')   flow.set(\"das2_trayid23\", trayid);\n    else if(msg.payload.par2 == 'rack24')   flow.set(\"das2_trayid24\", trayid);\n    else if(msg.payload.par2 == 'rack31')   flow.set(\"das2_trayid31\", trayid);\n    else if(msg.payload.par2 == 'rack32')   flow.set(\"das2_trayid32\", trayid);\n    else if(msg.payload.par2 == 'rack33')   flow.set(\"das2_trayid33\", trayid);\n    else if(msg.payload.par2 == 'rack34')   flow.set(\"das2_trayid34\", trayid);\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":2250,"y":1300,"wires":[["17d1363.b2184ca"]]},{"id":"7c0f71f0.fc7ed","type":"link out","z":"76082a9f.b8c304","name":"","links":[],"x":795,"y":540,"wires":[]},{"id":"b6ca0946.a5bbb8","type":"function","z":"76082a9f.b8c304","name":"Pack switch command","func":"// CommonFunction = global.get(\"CommonFunction\");\ndelete(msg.event);\ndelete(msg.topic);\ndelete(msg.elementId);\ndelete(msg.selector);\nlet commonFunctionsDas = flow.get('commonFunctionsDas');\nlet systemStatus = flow.get('systemStatus');\nlet listTrayDb = flow.get('listTrayDb');\nlet command = msg.payload;\nif(systemStatus === 0){\n    msg.topic = \"kill\";\n    msg.payload = \"kill\";\n    return msg;\n}\nif(msg.topic === 'login' && systemStatus === 1){\n    msg.topic = \"login\";\n    return msg;\n}\nlet tray_id = command.substr(5, 2);\nmsg.tray_id = tray_id;\nlet flowVar = 'das';\nfor(let i = 0; i < listTrayDb.length; i++) {\n    if(listTrayDb[i][2] === tray_id) {\n        msg.tray_id = String(listTrayDb[i][1]);\n        msg.payload = String(listTrayDb[i][0]);\n        //msg.payload = commonFunctionsDas.CreateMessageCommand(String(listTrayDb[i][3]),8) + commonFunctionsDas.CreateMessageCommand(String(listTrayDb[i][0]),8);\n        break;\n    }\n}\nif(systemStatus == 1){\n    return msg;\n}\nelse return;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":1260,"wires":[["34d224eb.4a7f6c","51d58cf1.2b82a4"]]},{"id":"602e6756.76c6e8","type":"link out","z":"76082a9f.b8c304","name":"Connect and disconnect \\n to Server","links":["58e44010.fe604"],"x":1330,"y":1060,"wires":[],"l":true},{"id":"923efc0.86b1908","type":"link out","z":"76082a9f.b8c304","name":"","links":["1bcc2eff.5daad1","d19d707d.7611d"],"x":1515,"y":1220,"wires":[]},{"id":"490e0a40.be5e44","type":"function","z":"76082a9f.b8c304","name":"Logging change LED DAS 1","func":"let recieve_command = msg.payload;\nmsg.payload = recieve_command.command + ' - DAS ID: ' + recieve_command.dasid + ' - ' + msg.locationId + ' - ' + recieve_command.par3;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2300,"y":1180,"wires":[["8e3a692.93e3298"]]},{"id":"8e3a692.93e3298","type":"link out","z":"76082a9f.b8c304","name":"","links":["1bcc2eff.5daad1","d19d707d.7611d"],"x":2475,"y":1180,"wires":[]},{"id":"34d224eb.4a7f6c","type":"function","z":"76082a9f.b8c304","name":"Logging confirm LED DAS 1","func":"if(msg.payload === 'kill' || msg.payload === 'login') return;\nmsg.payload = 'Confirm ' + String(msg.tray_id);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1360,"y":1220,"wires":[["923efc0.86b1908"]]},{"id":"546848d1.5f4128","type":"switch","z":"76082a9f.b8c304","name":"Check Start","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"start","vt":"str"},{"t":"eq","v":"stop","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":630,"y":1080,"wires":[["b30f35a7.b7c468"],["6f7b6f10.c9488"]]},{"id":"b30f35a7.b7c468","type":"change","z":"76082a9f.b8c304","name":"","rules":[{"t":"set","p":"systemStatus","pt":"flow","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":1060,"wires":[["d6bb1f9c.104ce","8ad653cb.1a5c4"]]},{"id":"6f7b6f10.c9488","type":"change","z":"76082a9f.b8c304","name":"","rules":[{"t":"set","p":"systemStatus","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":1100,"wires":[["a27774fc.640958","d6bb1f9c.104ce"]]},{"id":"a27774fc.640958","type":"link out","z":"76082a9f.b8c304","name":"Clear Log table ","links":["b93fe2e8.adff7"],"x":1080,"y":1100,"wires":[],"l":true},{"id":"b93fe2e8.adff7","type":"link in","z":"76082a9f.b8c304","name":"Clear Log tables","links":["a27774fc.640958"],"x":280,"y":240,"wires":[["1ac47f5b.d4eee1"]],"l":true},{"id":"d6bb1f9c.104ce","type":"function","z":"76082a9f.b8c304","name":"Clear msg ","func":"msg = {};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1070,"y":1060,"wires":[["602e6756.76c6e8","8ad653cb.1a5c4"]]},{"id":"8ad653cb.1a5c4","type":"function","z":"76082a9f.b8c304","name":"send msg to \\n connect or kill socket","func":"let systemStatus = flow.get('systemStatus');\nif(systemStatus != 1){\n    msg.topic = \"kill\";\n    return msg;\n}\nelse if(systemStatus == 1){\n    msg.topic = \"login\";\n    return msg;\n}\ndelete(msg.payload);\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":1200,"wires":[["b6ca0946.a5bbb8"]]},{"id":"4f00e427.8c0bdc","type":"function","z":"76082a9f.b8c304","name":"check confirm","func":"if(msg.topic === 'confirm'){\n    return msg;\n} else return;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":1260,"wires":[["b6ca0946.a5bbb8"]]},{"id":"1f91389.5d941c7","type":"catch","z":"76082a9f.b8c304","name":"Catch DAS1 connection fail","scope":["694b6b32.8507d4"],"uncaught":false,"x":310,"y":140,"wires":[["22ab86d9.82008a"]]},{"id":"22ab86d9.82008a","type":"function","z":"76082a9f.b8c304","name":"Create connection fail message","func":"msg.payload = 'DAS: Connection Fail to Server';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":140,"wires":[["6bb39dbf.93b7f4"]]},{"id":"5f3898f9.74ff78","type":"inject","z":"76082a9f.b8c304","name":"Read config file IP server","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"","topic":"","payload":"$env('DAS_Server_ip')","payloadType":"jsonata","x":330,"y":580,"wires":[["4968466a.ad64d8"]]},{"id":"4968466a.ad64d8","type":"function","z":"76082a9f.b8c304","name":"Save config file IP server","func":"flow.set('dasServerIp', msg.payload);\nreturn ;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":580,"wires":[[]]},{"id":"880f4d3d.3721d","type":"inject","z":"76082a9f.b8c304","name":"Read config file IP server","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"","topic":"","payload":"$env('DAS1_port')","payloadType":"jsonata","x":330,"y":620,"wires":[["c9dc398.6a6c4c8"]]},{"id":"c9dc398.6a6c4c8","type":"function","z":"76082a9f.b8c304","name":"Save config file das1 port","func":"flow.set('das1Port', msg.payload);\nreturn ;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":620,"wires":[[]]},{"id":"34a58454.df2f7c","type":"inject","z":"76082a9f.b8c304","name":"Read config file IP server","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"","topic":"","payload":"$env('DAS2_port')","payloadType":"jsonata","x":330,"y":660,"wires":[["1d4eb04b.d0888"]]},{"id":"1d4eb04b.d0888","type":"function","z":"76082a9f.b8c304","name":"Save config file das2 port","func":"flow.set('das2Port', msg.payload);\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":660,"wires":[[]]},{"id":"51d58cf1.2b82a4","type":"function","z":"76082a9f.b8c304","name":"set ip and port","func":"// msg.host = flow.get('dasServerIp');\n// msg.port = Number(flow.get('das1Port'));\nmsg.host = '10.116.42.123';\nmsg.port = 40001;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1320,"y":1280,"wires":[["694b6b32.8507d4","2cbbc1d5.9c24de"]]},{"id":"5d5d9424.2fbfec","type":"ui_svg_graphics","z":"76082a9f.b8c304","group":"9f807f6.5666e8","order":4,"width":"35","height":"17","svgString":"<style>\nbody{\n    background-color: gray;\n}\n.grid-container {\n  display: grid;\n  grid-gap: 5px 5px;\n  grid-template-columns: auto auto auto auto;\n  background-color: #a6a6a6;\n  padding: 5px;\n}\n\n.grid-item {\n  background-color: #333333;\n  border: 1px solid white;\n  padding: 5px;\n  height: 150px;\n  width: 200px;\n  font-size: 20px;\n  text-align: center;\n}\n\n/* Create three equal columns that floats next to each other */\n.column {\n  float: left;\n  width: 48%;\n  padding: 15px;\n  padding-bottom: 5px;\n}\n\n/* Clear floats after the columns */\n.row:after {\n  content: \"\";\n  display: table;\n  clear: both;\n}\n\n/* Responsive layout - makes the three columns stack on top of each other instead of next to each other */\n@media screen and (max-width:800px) {\n  .column {\n    width: 100%;\n  }\n}\n.layout-title {\n\tdisplay: grid;\n\tgrid-template-columns: auto auto auto;\n\tgrid-column-gap: auto;\n}\n.d-flex {\n\tdisplay: flex;\n\tjustify-content: left;\n\talign-items: left;\n}\n.pading-title{\n\tpadding: 5px 5px;\n\twidth: 120px;\n\theight: 25px;\n}\n.label-radius {\n\tborder-radius: 7px;\n\twidth: 100%;\n\theight: 100%;\n\tcolor: #bfbfbf;\n\tfont-weight: 700;\n\tbackground-color: #333333;\n\ttext-align: left;\n}\n.pading-5{\n\tpadding: 0px 5px;\n}\n.label-circle{\n\tborder-radius: 50%;\n\twidth: 12px;\n\theight: 12px;\n\tpadding: 12px 12px;          \n}\n.navBut{\n    height: 40px; \n    width: 100px; \n    margin-top: 0px; \n    margin-right: 10px; \n    border-radius: 7px; \n    cursor: pointer;\n    color: white;\n}\n\n</style>\n<svg x=\"0\" y=\"0\" height=\"900\" width=\"1875\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n</svg>","clickableShapes":[{"targetId":"#StartButton","action":"click","payload":"start","payloadType":"str","topic":"start"},{"targetId":"#StopButton","action":"click","payload":"stop","payloadType":"str","topic":"stop"}],"smilAnimations":[],"bindings":[{"selector":"","bindSource":"","bindType":"text","attribute":""}],"showCoordinates":false,"autoFormatAfterEdit":false,"showBrowserErrors":false,"outputField":"payload","editorUrl":"//drawsvg.org/drawsvg.html","directory":"","panning":"disabled","zooming":"disabled","panOnlyWhenZoomed":false,"doubleClickZoomEnabled":false,"mouseWheelZoomEnabled":false,"name":"","x":380,"y":1160,"wires":[["252d76d5.8877da","4f00e427.8c0bdc","546848d1.5f4128"]]},{"id":"75ba6ef2.ef267","type":"function","z":"76082a9f.b8c304","name":"global template","func":"flow.set('global_template_das', msg.payload);\nreturn ;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":380,"wires":[[]]},{"id":"2f6a320f.ec4f2e","type":"template","z":"76082a9f.b8c304","name":"","field":"payload","fieldType":"msg","format":"json","syntax":"mustache","template":"{\n    \"Line\": {\n        \"command\": \"add_element\",\n        \"elementType\": \"line\",\n        \"elementId\": \"\",\n        \"elementAttributes\": {\n            \"x1\": \"\",\n            \"y1\": \"\",\n            \"x2\": \"\",\n            \"y2\": \"\"\n        },\n        \"elementStyleAttributes\": {\n            \"fill\": \"none\",\n            \"stroke\": \"\",\n            \"stroke-width\": \"\"\n        }\n    },\n    \"Remove\": {\n        \"command\": \"remove_element\",\n        \"selector\": \"\"\n    },\n    \"Round\": {\n        \"command\": \"add_element\",\n        \"elementType\": \"circle\",\n        \"elementId\": \"\",\n        \"elementAttributes\": {\n            \"cx\": \"\",\n            \"cy\": \"\",\n            \"r\": \"\"\n        },\n        \"elementStyleAttributes\": {\n            \"fill\": \"black\",\n            \"stroke\": \"black\",\n            \"stroke-width\": \"1px\"\n        }\n    },\n    \"Square\": {\n        \"command\": \"add_element\",\n        \"elementType\": \"rect\",\n        \"elementId\": \"\",\n        \"elementAttributes\": {\n            \"x\": \"\",\n            \"y\": \"\",\n            \"width\": \"\",\n            \"height\": \"\"\n        },\n        \"elementStyleAttributes\": {\n            \"fill\": \"none\",\n            \"stroke\": \"black\",\n            \"stroke-width\": \"0.1px\"\n        }\n    },\n    \"AGV\": [\n        {\n            \"command\": \"add_element\",\n            \"elementType\": \"circle\",\n            \"elementId\": \"\",\n            \"elementAttributes\": {\n                \"cx\": \"\",\n                \"cy\": \"\",\n                \"r\": \"\"\n            },\n            \"elementStyleAttributes\": {\n                \"fill\": \"none\",\n                \"stroke\": \"blue\",\n                \"stroke-width\": \"0.5px\"\n            },\n            \"textContent\": \"1234\"\n        },\n        {\n            \"command\": \"add_element\",\n            \"elementType\": \"rect\",\n            \"elementId\": \"\",\n            \"elementAttributes\": {\n                \"x\": \"\",\n                \"y\": \"\",\n                \"width\": \"\",\n                \"height\": \"\"\n            },\n            \"elementStyleAttributes\": {\n                \"fill\": \"none\",\n                \"stroke\": \"blue\",\n                \"stroke-width\": \"2px\"\n            }\n        },\n        {\n            \"command\": \"add_element\",\n            \"elementType\": \"line\",\n            \"elementId\": \"\",\n            \"elementAttributes\": {\n                \"x1\": \"\",\n                \"y1\": \"\",\n                \"x2\": \"\",\n                \"y2\": \"\"\n            },\n            \"elementStyleAttributes\": {\n                \"fill\": \"none\",\n                \"stroke\": \"black\",\n                \"stroke-width\": \"2px\"\n            }\n        },\n        {\n            \"command\": \"add_element\",\n            \"elementType\": \"text\",\n            \"elementId\": \"\",\n            \"elementAttributes\": {\n                \"x\": \"\",\n                \"y\": \"\"\n            },\n            \"elementStyleAttributes\": {\n                \"fill\": \"none\",\n                \"stroke\": \"black\",\n                \"stroke-width\": \"1px\"\n            },\n            \"textContent\": \"\"\n        }\n    ],\n    \"Text\": {\n        \"command\": \"add_element\",\n        \"elementType\": \"text\",\n        \"elementId\": \"\",\n        \"elementAttributes\": {\n            \"x\": \"\",\n            \"y\": \"\"\n        },\n        \"elementStyleAttributes\": {\n            \"fill\": \"white\",\n            \"font-size\": \"\"\n        },\n        \"textContent\": \"\"\n    },\n    \"ForeignObject\": {\n        \"command\": \"add_element\",\n        \"elementType\": \"foreignObject\",\n        \"elementId\": \"\",\n        \"elementAttributes\": {\n            \"x\": \"\",\n            \"y\": \"\",\n            \"width\": \"\",\n            \"height\": \"\"\n        },\n        \"textContent\": \"\"\n    },\n    \"Event\": {\n        \"command\": \"add_event\",\n        \"event\": \"click\",\n        \"selector\": \"\",\n        \"payload\": \"\",\n        \"topic\": \"\"\n    },\n     \"UpdateText\": {\n      \"command\": \"update_text\",\n      \"selector\": \"\",\n      \"textContent\": \"\"\n    },\n    \"UpdateLed\": {\n        \"command\": \"update_attribute\",\n        \"selector\": \"\",\n        \"attributeName\": \"style\",\n        \"attributeValue\": \"\"\n    },\n    \"UpdateButton\": {\n        \"command\": \"update_attribute\",\n        \"selector\": \"\",\n        \"attributeName\": \"style\",\n        \"attributeValue\": \"\"\n    },\n    \"UpdateTrayID\": {\n        \"command\": \"update_attribute\",\n        \"selector\": \"\",\n        \"attributeName\": \"placeholder\",\n        \"attributeValue\": \"\"\n    }\n}","output":"json","x":600,"y":380,"wires":[["75ba6ef2.ef267"]]},{"id":"79fbcbb.97fa834","type":"inject","z":"76082a9f.b8c304","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.05","topic":"","payload":"","payloadType":"date","x":290,"y":340,"wires":[["2f6a320f.ec4f2e","9beacf66.a2c08","d4914c91.f4515","fde8662f.2d83f8","c1c6b4ac.59a708"]]},{"id":"9beacf66.a2c08","type":"function","z":"76082a9f.b8c304","name":"Common functions","func":"let json = flow.get('global_template_das');\nlet width = flow.get('width');\nlet height = flow.get('height');\nlet commonFunctionsDas = {};\n\ncommonFunctionsDas.createSquare = function createMsgSquare(id, x, y, width, height, color, stroke, stroke_width){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.Square));\n    createMsg.elementId = String(id);\n    createMsg.elementAttributes.x = x;\n    createMsg.elementAttributes.y = y;\n    createMsg.elementAttributes.width = width;\n    createMsg.elementAttributes.height = height;\n    createMsg.elementStyleAttributes.fill = String(color);\n    createMsg.elementStyleAttributes.stroke = String(stroke);\n    createMsg.elementStyleAttributes[\"stroke-width\"] = String(stroke_width);\n    return createMsg;\n}\ncommonFunctionsDas.createRound = function createRound(id, x, y, r, color, stroke, stroke_width){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.Round));\n    //createMsg = json.Round;\n    createMsg.elementId = String(id);\n    createMsg.elementAttributes.cx = x;\n    createMsg.elementAttributes.cy = y;\n    createMsg.elementAttributes.r = r;\n    createMsg.elementStyleAttributes.fill = String(color);\n    createMsg.elementStyleAttributes.stroke = String(stroke);\n    createMsg.elementStyleAttributes[\"stroke-width\"] = String(stroke_width);\n    return createMsg;\n}\n\ncommonFunctionsDas.createLine = function createLine(id, x1, y1, x2, y2, color, stroke_width){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.Line));\n    createMsg.elementId = String(id);\n    createMsg.elementAttributes.x1 = x1;\n    createMsg.elementAttributes.y1 = y1;\n    createMsg.elementAttributes.x2 = x2;\n    createMsg.elementAttributes.y2 = y2;\n    createMsg.elementStyleAttributes.stroke = String(color);\n     createMsg.elementStyleAttributes[\"stroke-width\"] = String(stroke_width);\n    return createMsg;\n}\n\ncommonFunctionsDas.createText = function createText(id, x, y, color,front_size, content){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.Text));\n    createMsg.elementId = String(id);\n    createMsg.elementAttributes.x = x;\n    createMsg.elementAttributes.y = y;\n    createMsg.elementStyleAttributes.fill = String(color);\n    createMsg.elementStyleAttributes[\"font-size\"] = front_size;\n    createMsg.textContent = String(content);\n    return createMsg;\n}\n\ncommonFunctionsDas.createForeignObject = function createForeignObject(id, x, y, width, height, content){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.ForeignObject));\n    createMsg.elementId = String(id);\n    createMsg.elementAttributes.x = x;\n    createMsg.elementAttributes.y = y;\n    createMsg.elementAttributes.width = width;\n    createMsg.elementAttributes.height = height;\n    createMsg.textContent = String(content);\n    return createMsg;\n}\n\ncommonFunctionsDas.createEvent = function createEvent(selector, payload, topic){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.Event));\n    createMsg.selector = selector;\n    createMsg.payload = payload;\n    createMsg.topic = topic;\n    return createMsg;\n}\n\ncommonFunctionsDas.updateText = function updateText(selector, content){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.UpdateText));\n    createMsg.selector = selector;\n    createMsg.textContent = content;\n    return createMsg;\n}\n\ncommonFunctionsDas.updateLed = function updateLed(selector, color){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.UpdateLed));\n    createMsg.selector = selector;\n    createMsg.attributeValue = \"fill:\" + color + \"; stroke:none; stroke-width:0px;\";\n    return createMsg;\n}\n\ncommonFunctionsDas.updateButton = function updateButton(selector, color){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.UpdateButton));\n    createMsg.selector = selector;\n    createMsg.attributeValue = \"background-color:\" + color + \";\";\n    return createMsg;\n}\n\ncommonFunctionsDas.remove = function remove(selector){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.Remove));\n    createMsg.selector = selector;\n    return createMsg;\n}\n\ncommonFunctionsDas.FilterString = function FilterString(strMessage){\n    let result= \"\";\n    for(let i = 0; i < strMessage.length; i++){\n        if(strMessage[i] === '-'){\n           continue;\n        }\n        else result += strMessage[i];\n    }\n    return result;\n}\n\ncommonFunctionsDas.CreateMessageCommand = function CreateMessageCommand(strMessage, messageLength){//sua ten thanh CreateMessageCommand\n    let result= String(strMessage);\n    for(let i = strMessage.length; i < messageLength; i++){\n        result += '-';\n    }\n    return result;\n}\n\ncommonFunctionsDas.updateTrayID = function updateTrayID(selector, id){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.UpdateTrayID));\n    createMsg.selector = selector;\n    createMsg.attributeValue = id;\n    return createMsg;\n}\n\n// \"UpdateTrayID\": {\n//         \"command\": \"update_attribute\",\n//         \"selector\": \"\",\n//         \"attributeName\": \"placeholder\",\n//         \"attributeValue\": \"\"\n//     }\n\nflow.set('commonFunctionsDas', commonFunctionsDas);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":630,"y":420,"wires":[[]]},{"id":"d4914c91.f4515","type":"change","z":"76082a9f.b8c304","name":"set display size","rules":[{"t":"set","p":"width","pt":"flow","to":"1875","tot":"num"},{"t":"set","p":"height","pt":"flow","to":"850","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":340,"wires":[[]]},{"id":"252d76d5.8877da","type":"debug","z":"76082a9f.b8c304","name":"FloorPlan","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":640,"y":1160,"wires":[]},{"id":"694b6b32.8507d4","type":"tcp request TSDV","z":"76082a9f.b8c304","server":"","port":"","out":"sit","splitc":" ","name":"","x":1530,"y":1280,"wires":[["72b9e080.3b176"]]},{"id":"1cc19ea2.328931","type":"inject","z":"76082a9f.b8c304","name":"Set database properties","props":[{"p":"payload"},{"p":"host","v":"$env('DAS_db_host')","vt":"jsonata"},{"p":"port","v":"$env('DAS_db_port')","vt":"jsonata"},{"p":"user","v":"$env('DAS_db_user')","vt":"jsonata"},{"p":"password","v":"$env('DAS_db_password')","vt":"jsonata"},{"p":"database","v":"$env('DAS_db_database')","vt":"jsonata"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.05","topic":"","payload":"","payloadType":"date","x":250,"y":800,"wires":[["f6ee4f6.b8e85b","515d073f.82ecc8"]]},{"id":"f6ee4f6.b8e85b","type":"function","z":"76082a9f.b8c304","name":"Create Query \\n command","func":"let dasNo = flow.get('dasNo');\nquery = 'SELECT id,location_id,digit,das_id FROM das_locations WHERE das_id=' +  dasNo + ';';\nmsg.topic = query; \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":800,"wires":[["9983948a.358928"]]},{"id":"e51341ed.93519","type":"function","z":"76082a9f.b8c304","name":"Update flow variables","func":"let result = msg.payload;\nlet listTray = [];\nfor(let i = 0; i < result.length; i++) {\n    listTray.push([result[i].id, result[i].location_id, result[i].digit.replace(/-/g,''), result[i].das_id]);\n}\nflow.set('listTrayDb', listTray);\nreturn;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":860,"y":800,"wires":[[]]},{"id":"fde8662f.2d83f8","type":"change","z":"76082a9f.b8c304","name":"set das no","rules":[{"t":"set","p":"dasNo","pt":"flow","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":300,"wires":[[]]},{"id":"83188338.4438e","type":"inject","z":"76082a9f.b8c304","name":"DAS Config Type","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"{\"THUNDER\":{\"type\":\"THUNDER\",\"description\":\"\",\"width\":0,\"height\":0,\"depth\":0,\"layouts\":[{\"dx\":0,\"dy\":-1,\"cells\":[{\"type\":\"SMALL\",\"digit\":\"A-1\",\"color\":\"#DB4437\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"A-2\",\"color\":\"#DB4437\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"A-3\",\"color\":\"#DB4437\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"B-1\",\"color\":\"#4285F4\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"B-2\",\"color\":\"#4285F4\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"C-1\",\"color\":\"#0F9D58\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"C-2\",\"color\":\"#0F9D58\",\"width\":0,\"height\":0,\"depth\":0}],\"grid\":\"'C-1 C-1 C-2 C-2''A-1 B-1 B-2 B-2''A-1 A-2 A-2 A-3'\"}]}}","payloadType":"json","x":310,"y":500,"wires":[["26ee84b1.15cf5c"]]},{"id":"26ee84b1.15cf5c","type":"function","z":"76082a9f.b8c304","name":"DAS config layout file (DAS type)","func":"//msg.payload = {\"THUNDER\":{\"type\":\"THUNDER\",\"description\":\"\",\"width\":0,\"height\":0,\"depth\":0,\"layouts\":[{\"dx\":0,\"dy\":-1,\"cells\":[{\"type\":\"SMALL\",\"digit\":\"A-1\",\"color\":\"#DB4437\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"A-2\",\"color\":\"#DB4437\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"A-3\",\"color\":\"#DB4437\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"B-1\",\"color\":\"#4285F4\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"B-2\",\"color\":\"#4285F4\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"C-1\",\"color\":\"#0F9D58\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"C-2\",\"color\":\"#0F9D58\",\"width\":0,\"height\":0,\"depth\":0}],\"grid\":\"'C-1 C-1 C-2 C-2''A-1 B-1 B-2 B-2''A-1 A-2 A-2 A-3'\"}]}};\nflow.set('dasType', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":500,"wires":[[]]},{"id":"da9e2efe.f658e","type":"inject","z":"76082a9f.b8c304","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":270,"y":1380,"wires":[["8a51e4ec.b80f68"]]},{"id":"8a51e4ec.b80f68","type":"function","z":"76082a9f.b8c304","name":"process layout","func":"let dasType = flow.get('dasType');    \nlet dasTypeName = flow.get('dasTypeName'); \nlet grid = dasType[dasTypeName].layouts[0].grid;\nlet gridArr = [];\nlet dasHeight = flow.get('height');\nlet dasWidth = flow.get('width');\nfor(let i = 0; i < grid.length; i++) {\n    if(grid[i] === \"'\"  && grid[i + 1] === \"'\") {\n        let subString = grid.substr(0, i);\n        gridArr.push(subString);\n    }\n}\ngridArr.push(grid);\nfor(let i = 0; i < gridArr.length; i++) {\n        gridArr[i] = gridArr[i].replace(/'/g,'');\n        gridArr[i] = gridArr[i].replace(/-/g,'');\n}\nfor(let i = gridArr.length - 1; i >= 1; i--) {\n    gridArr[i] = gridArr[i].substr(gridArr[i - 1].length, gridArr[i].length - gridArr[i - 1].length);\n}\n\n// convert string arr to 2 dimensional grid arr\nfor(let i = 0; i < gridArr.length; i++) {\n    gridArr[i] = gridArr[i].split(\" \");\n}\n\nlet width = gridArr[1].length;\nlet height = gridArr.length;\n\n// check if visted grid\nfunction checkVisted(grid, arr) {\n    if(arr.length === 0) return false;\n    for(let i = 0; i < arr.length; i++) {\n            if(grid === arr[i]) return true;\n    }\n    return false;\n}\n\n\nlet mergedGrid = [];\nlet visted = [];\nfor(let i = 0; i < gridArr.length; i++) {\n    let maxX = 0;\n    let maxY = 0;\n    for (let j = 0; j < gridArr[i].length; j++) {\n        if(checkVisted(gridArr[i][j], visted)) continue;\n        else {\n            for(let m = 0; m < gridArr[i].length; m++) {\n                if(gridArr[i][m] == gridArr[i][j]) maxX = m - j + 1;\n            }\n            for(let n = 0; n < gridArr.length; n++) {\n                if(gridArr[n][j] == gridArr[i][j]) maxY = n - i + 1;\n            }\n            visted.push(gridArr[i][j]);\n            mergedGrid.push([gridArr[i][j], maxX, maxY, j, i])\n        }\n    }\n}\nmsg.topic = visted;\nmsg.payload = mergedGrid;\n\nlet builder = [];\nfor(let i = 0; i < height; i++){\n    for(let m = 0; m < mergedGrid.length; m++) {\n        if(mergedGrid[m][4] == i) {\n            builder.push([ (mergedGrid[m][3] / width) * dasWidth, (mergedGrid[m][4] / height) * dasHeight, (mergedGrid[m][1] / width) * 100, (mergedGrid[m][2] / height) * 100,  mergedGrid[m][0]]);\n        }\n    }\n}\nflow.set('listTray', builder);\nmsg.builder = builder;\nflow.set('arrBuilder', builder);\ndelete(msg.topic);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":1380,"wires":[["dd914f66.8bb91"]]},{"id":"58e44010.fe604","type":"link in","z":"76082a9f.b8c304","name":"","links":["17d1363.b2184ca","602e6756.76c6e8"],"x":295,"y":1340,"wires":[["8a51e4ec.b80f68"]]},{"id":"6769fb6c.5103b4","type":"ui_ui_control","z":"76082a9f.b8c304","name":"Reload event","events":"all","x":250,"y":1460,"wires":[["9cc266d.7939698","e84df6bc.d63f58"]]},{"id":"9cc266d.7939698","type":"delay","z":"76082a9f.b8c304","name":"Wait stable","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":250,"y":1420,"wires":[["8a51e4ec.b80f68"]]},{"id":"dd914f66.8bb91","type":"function","z":"76082a9f.b8c304","name":"Test custom layout","func":"let commonFunctionsDas = flow.get('commonFunctionsDas');\n\n// list tray read from Db\nlet listTrayDb = flow.get('listTrayDb');\nlet displayHeight = flow.get('height');\nlet displayWidth = flow.get('width');\n\n// list tray made from config file\nlet listTray =  flow.get('listTray');\nlet builder = flow.get('arrBuilder');\n\n// tray layput coefficients\nconst ledXCoeff = 0.9;\nconst ledYCoeff = 0.15;\nconst ledRCoeff = 0.1;\nconst locationXCoeff = 0.1;\nconst locationYCoeff = 0.18;\nconst locationFontCoeff = 0.13;\nconst trayXCoeff = 0.1;\nconst trayYCoeff = 0.4;\nconst trayIdWidthCoeff = 0.8;\nconst trayIdHeightCoeff = 0.2;\nconst confirmXCoeff = 0.1;\nconst confirmYCoeff = 0.4;\nconst confirmWidthCoeff = 0.8;\nconst confirmHeightCoeff = 0.2;\n\nlet systemStatus = flow.get('systemStatus');\nlet drawMsg = [];\nlet navBar = \"<div class='d-flex pading-title' style='padding: 0px; width: \" + displayWidth +\"px; height: 40px; font-size: 25px;'><button id='StartButton' style='background-color: #097479;' class='border-buton navBut'>Start</button><button id='StopButton' style='background-color: #097479;' class='border-buton navBut'>Stop</button><label class='label-radius d-flex' style='justify-content: center; width:85%;'>DAS 1</label></div>\";\ndrawMsg.push(commonFunctionsDas.createForeignObject(\"Tray_navBar\", 0, 0, displayWidth, displayHeight, navBar));\n\nif(systemStatus === 0) {\n    drawMsg.push(commonFunctionsDas.remove('#StartButton'));\n    drawMsg.push(commonFunctionsDas.remove('#StopButton'));\n    drawMsg.push(commonFunctionsDas.remove('[id^=Tray]'));\n    drawMsg.push(commonFunctionsDas.createForeignObject(\"Tray_navBar\", 0, 0, displayWidth, displayHeight, navBar));\n    drawMsg.push(commonFunctionsDas.updateButton('#StartButton', '#097479'));\n    drawMsg.push(commonFunctionsDas.updateButton('#StopButton', 'gray'));\n    msg.payload = drawMsg;\n    return msg;\n}\n\ndrawMsg.push(commonFunctionsDas.updateButton('#StartButton', 'gray'));\ndrawMsg.push(commonFunctionsDas.updateButton('#StopButton', 'red'));\n\nfor(let i = 0; i < listTray.length; i++) {\n    let id = listTray[i][4];\n    let x = listTray[i][0];\n    let y = listTray[i][1] + 45;\n    let trayWidth = ( listTray[i][2] / 100 )* displayWidth;\n    let trayHeight = ( listTray[i][3] /100 ) * displayHeight;\n    let ledX = x + ledXCoeff * trayWidth;\n    let ledY = y + ledYCoeff * trayHeight;\n    let ledR = 0;\n    let locationFont = 0;\n    let locationX = x + locationXCoeff * trayWidth;\n    let locationY = y + locationYCoeff * trayHeight;\n    let trayIdWidth = trayIdWidthCoeff * trayWidth;\n    let trayIdHeight = trayIdHeightCoeff * trayHeight;\n    if(trayWidth * 0.8 > trayHeight) {\n        ledR = trayHeight * ledRCoeff ;\n        locationFont = trayHeight * locationFontCoeff;\n    } else {\n        ledR = trayWidth * ledRCoeff * 0.6;\n        locationFont = trayWidth * locationFontCoeff * 0.6;\n    }\n    let contentTrayId = \"<Label class='f-weight font-label form-control'><input id='tray_\" + id + \"_id' type='text' placeholder='\" + flow.get('tray_' + id + '_id')+ \"' style='font-weight: bold; width: \" + String(trayIdWidth) + \"px; height: \" + String(trayIdHeight) + \"px; text-align: center; font-size: 15px;'></Label>\";\n    let contentConfrim = \"<button id='Tray_btn_\" + id + \"' class='border-buton buton' style='color: white; background-color:#097479; width: \" + String(trayIdWidth + 8) + \"px; height: \" + String(trayIdHeight + 8) + \"px;border-radius: 7px;'>Confirm</button>\";\n    drawMsg.push(commonFunctionsDas.createSquare('Tray_' + String(i), x, y, trayWidth, trayHeight, '#333333', 'lightgray', '3px'));\n    drawMsg.push(commonFunctionsDas.createRound(\"Tray_\" + id + \"_LED\", ledX, ledY, ledR, flow.get(id + '_LED'), 'none', '0px'));\n    drawMsg.push(commonFunctionsDas.createText(\"Tray_\" + id + \"_LocationID\", locationX, locationY, '#d9d9d9', locationFont, 'Location ' + String(i)));\n    drawMsg.push(commonFunctionsDas.createForeignObject(\"Tray_\" + String(i) + \"_TrayId\", x + 0.1 * trayWidth, y + 0.4 * trayHeight, trayWidth, trayHeight, contentTrayId));\n    drawMsg.push(commonFunctionsDas.createForeignObject(\"Tray_\" + String(i) + \"_Confirm\", x + 0.1 * trayWidth, y + 0.7 * trayHeight, trayWidth, trayHeight, contentConfrim));\n    drawMsg.push(commonFunctionsDas.createEvent('#Tray_btn_' + id, \"Tray_\" + id + \"_Confirm\", \"confirm\"));  \n}\n\n// update LocationID\nfunction search(string) {\n    for(let i = 0; i < listTrayDb.length; i++) {\n        if(listTrayDb[i][2] === string) return i;\n    }\n}\n\nfor(let i = 0; i < builder.length; i++) {\n    drawMsg.push(commonFunctionsDas.updateText('#Tray_' + builder[i][4] + '_LocationID', listTrayDb[search(builder[i][4])][1]));\n}\n// update LED\nfor(let i = 0; i < builder.length; i++) {\n    drawMsg.push(commonFunctionsDas.updateLed('#Tray_' + builder[i][4] + '_LED', flow.get(builder[i][4] + '_LED')));\n}\n\nmsg.payload = drawMsg;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":1380,"wires":[["a6768e9b.3c84d"]]},{"id":"3696c9c6.60fed6","type":"comment","z":"76082a9f.b8c304","name":"Get DAS informations from DB","info":"","x":330,"y":740,"wires":[]},{"id":"a6768e9b.3c84d","type":"link out","z":"76082a9f.b8c304","name":"","links":["5622a8e7.09f3a8"],"x":815,"y":1380,"wires":[]},{"id":"973c6810.2191a8","type":"inject","z":"76082a9f.b8c304","name":"Reset System Status","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.2","topic":"","payload":"","payloadType":"str","x":320,"y":540,"wires":[["590b2cd1.2a9a54"]]},{"id":"590b2cd1.2a9a54","type":"change","z":"76082a9f.b8c304","name":"Rest System Status ","rules":[{"t":"set","p":"systemStatus","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":540,"wires":[["7c0f71f0.fc7ed"]]},{"id":"515d073f.82ecc8","type":"function","z":"76082a9f.b8c304","name":"Create Query \\n command","func":"let dasNo = flow.get('dasNo');\nquery = 'SELECT name FROM asset_configs WHERE id=' +  dasNo + ';';\nmsg.topic = query; \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":880,"wires":[["7816f118.f9eb9"]]},{"id":"a5728d5a.a3d28","type":"function","z":"76082a9f.b8c304","name":"Update flow variables","func":"flow.set('dasTypeName', msg.payload[0].name);\nreturn;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":880,"y":880,"wires":[[]]},{"id":"7816f118.f9eb9","type":"mysqlTSDV","z":"76082a9f.b8c304","mydb":"5ed7d551.872e1c","name":"DAS type","x":660,"y":880,"wires":[["a5728d5a.a3d28"]]},{"id":"9983948a.358928","type":"mysqlTSDV","z":"76082a9f.b8c304","mydb":"5ed7d551.872e1c","name":"DAS layout","x":670,"y":800,"wires":[["e51341ed.93519"]]},{"id":"2f917f9c.d9444","type":"inject","z":"76082a9f.b8c304","name":"Get das info from db","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":240,"y":880,"wires":[["f6ee4f6.b8e85b","515d073f.82ecc8"]]},{"id":"e84df6bc.d63f58","type":"link out","z":"76082a9f.b8c304","name":"","links":["d2d75ce5.a07c1","c1fdf818.b0eb88","497672cc.cc104c"],"x":375,"y":1460,"wires":[]},{"id":"6939855e.61a5cc","type":"inject","z":"76082a9f.b8c304","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"$env('DAS_barcode')","payloadType":"jsonata","x":230,"y":1660,"wires":[["23f0ab38.b72134"]]},{"id":"d124faa0.d06ec8","type":"jimp-image","z":"76082a9f.b8c304","name":"","data":"payload","dataType":"msg","ret":"img","parameter1":"416","parameter1Type":"num","parameter2":"585","parameter2Type":"num","parameter3":"400","parameter3Type":"num","parameter4":"60","parameter4Type":"num","parameter5":"","parameter5Type":"msg","parameter6":"","parameter6Type":"msg","parameter7":"","parameter7Type":"msg","parameter8":"","parameter8Type":"msg","sendProperty":"payload","sendPropertyType":"msg","parameterCount":4,"jimpFunction":"crop","selectedJimpFunction":{"name":"crop","fn":"crop","description":"crop to the given region","parameters":[{"name":"x","type":"num","required":true,"hint":"the x coordinate to crop form"},{"name":"y","type":"num","required":true,"hint":"the y coordinate to crop form"},{"name":"w","type":"num","required":true,"hint":"the width of the crop region"},{"name":"h","type":"num","required":true,"hint":"the height of the crop region"}]},"x":620,"y":1660,"wires":[["1cfc1e7.36025e2","eef11199.ade39"]]},{"id":"23f0ab38.b72134","type":"jimp-image","z":"76082a9f.b8c304","name":"","data":"payload","dataType":"msg","ret":"img","parameter1":"850","parameter1Type":"num","parameter2":"850","parameter2Type":"num","parameter3":"RESIZE_NEAREST_NEIGHBOR","parameter3Type":"resizeMode","parameter4":"50","parameter4Type":"num","parameter5":"","parameter5Type":"msg","parameter6":"","parameter6Type":"msg","parameter7":"","parameter7Type":"msg","parameter8":"","parameter8Type":"msg","sendProperty":"payload","sendPropertyType":"msg","parameterCount":3,"jimpFunction":"resize","selectedJimpFunction":{"name":"resize","fn":"resize","description":"resize the image. One of the w or h parameters can be set to automatic (\"Jimp.AUTO\" or -1).","parameters":[{"name":"w","type":"num|auto","required":true,"hint":"the width to resize the image to (or \"Jimp.AUTO\" or -1)"},{"name":"h","type":"num|auto","required":true,"hint":"the height to resize the image to (or \"Jimp.AUTO\" or -1)"},{"name":"mode","type":"resizeMode","required":false,"hint":"a scaling method (e.g. Jimp.RESIZE_BEZIER)"}]},"x":450,"y":1660,"wires":[["d124faa0.d06ec8"]]},{"id":"1cfc1e7.36025e2","type":"Barcode Decoder","z":"76082a9f.b8c304","name":"","data":"payload","dataType":"msg","tryharder":"true","tryharderType":"bool","QR_CODE":true,"DATA_MATRIX":true,"PDF_417":true,"EAN_8":true,"EAN_13":true,"CODE_39":true,"CODE_128":true,"ITF":true,"RSS_14":true,"x":800,"y":1640,"wires":[["4fd1d78f.646038"]]},{"id":"eef11199.ade39","type":"image viewer","z":"76082a9f.b8c304","name":"","width":"500","data":"payload","dataType":"msg","x":770,"y":1680,"wires":[[]]},{"id":"d19d707d.7611d","type":"link in","z":"76082a9f.b8c304","name":"Update Log tables","links":["8e3a692.93e3298","923efc0.86b1908"],"x":290,"y":200,"wires":[["6bb39dbf.93b7f4"]],"l":true},{"id":"2345b439.304efc","type":"inject","z":"76082a9f.b8c304","name":"Read config file barcode folder","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"$env('DAS_barcode')","payloadType":"jsonata","x":350,"y":700,"wires":[["ee815e38.c544d"]]},{"id":"ee815e38.c544d","type":"function","z":"76082a9f.b8c304","name":"Save config file das2 port","func":"flow.set('barcodeFolder', msg.payload);\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":700,"wires":[[]]},{"id":"c1fdf818.b0eb88","type":"link in","z":"76082a9f.b8c304","name":"","links":["e84df6bc.d63f58"],"x":315,"y":840,"wires":[["515d073f.82ecc8","f6ee4f6.b8e85b"]]},{"id":"497672cc.cc104c","type":"link in","z":"76082a9f.b8c304","name":"","links":["e84df6bc.d63f58"],"x":335,"y":380,"wires":[["fde8662f.2d83f8","d4914c91.f4515","2f6a320f.ec4f2e","9beacf66.a2c08"]]},{"id":"4fd1d78f.646038","type":"function","z":"76082a9f.b8c304","name":"update trayid","func":"let commonFunctionsDas = flow.get('commonFunctionsDas');\nlet drawMsg = [];\ndrawMsg.push(commonFunctionsDas.updateTrayID('#tray_' + msg.trayId + '_id', msg.payload.text));\nflow.set('tray_' + msg.trayId + '_id',msg.payload.text)\nmsg.payload = drawMsg;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":1600,"wires":[["6ea98042.0e8f4"]]},{"id":"181ac63e.62a5aa","type":"link in","z":"76082a9f.b8c304","name":"","links":["17d1363.b2184ca"],"x":155,"y":1560,"wires":[["8fd18fb0.a59a3"]]},{"id":"8fd18fb0.a59a3","type":"function","z":"76082a9f.b8c304","name":"update tray id","func":"let command = msg.payload;\nif(command.par3 === 'green') {\n    msg.trayId = command.par2.substr(0,2);\n    msg.payload = flow.get('barcodeFolder');\n    return [msg,];  \n} else {\n    let commonFunctionsDas = flow.get('commonFunctionsDas');\n    let drawMsg = [];\n    drawMsg.push(commonFunctionsDas.updateTrayID('#tray_' + command.par2.substr(0,2) + '_id', \" \"));\n    flow.set('tray_' + command.par2.substr(0,2) + '_id', \" \")\n    msg.payload = drawMsg;\n    return [,msg];\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":270,"y":1560,"wires":[["23f0ab38.b72134"],["6ea98042.0e8f4"]]},{"id":"c1c6b4ac.59a708","type":"function","z":"76082a9f.b8c304","name":"Reset Tray","func":"let arrBuilder = flow.get('arrBuilder');\nfor(let i = 0; i < arrBuilder.length; i++) {\n    flow.set('tray_' + arrBuilder[i][4] + '_id', \" \");\n}\nlet listTray = flow.get('listTrayDb');\n\nfor (let i = 0; i < listTray.length; i++){\n    flow.set(listTray[i][2] + \"_LED\",\"gray\");\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":460,"wires":[[]]},{"id":"6ea98042.0e8f4","type":"link out","z":"76082a9f.b8c304","name":"","links":["5622a8e7.09f3a8"],"x":865,"y":1560,"wires":[]},{"id":"579d3f8f.abbf5","type":"function","z":"76082a9f.b8c304","name":"","func":"msg = {\"topic\":\"confirm\",\"elementId\":\"Tray_btn_C1\",\"selector\":\"#Tray_btn_C1\",\"event\":{\"type\":\"click\",\"svgX\":390.74609375,\"svgY\":285.78125,\"pageX\":656,\"pageY\":360,\"screenX\":525,\"screenY\":391,\"clientX\":656,\"clientY\":360,\"bbox\":[287.40313720703125,305.5,893.8031616210938,253.77500915527344]},\"payload\":\"Tray_C1_Confirm\",\"socketid\":\"wlqZ9F4lIL7Lfzx0AAAK\",\"_msgid\":\"317baad5.43b4c6\"};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1030,"y":1420,"wires":[["4f00e427.8c0bdc"]]},{"id":"2aca1fb0.54f85","type":"inject","z":"76082a9f.b8c304","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":860,"y":1420,"wires":[["579d3f8f.abbf5"]]},{"id":"2cbbc1d5.9c24de","type":"debug","z":"76082a9f.b8c304","name":"","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":1530,"y":1340,"wires":[]},{"id":"8a832fda.408cf","type":"function","z":"33010803.e6c778","name":"Add Row DAS 1","func":"var table_list = [];\nvar item_code = msg.payload;\nvar item_table = {};\n\nvar d = new Date();\nlocaltime = d.toLocaleTimeString('en-US', { hour12: false });\n\nitem_table[\"das1_col_time\"] = localtime;\nitem_table[\"das1_col_log\"] = String(msg.payload);\ntable_list.push(item_table);\nmsg.payload= {\n    command:\"addRow\",\n    arguments: table_list,\n    returnPromise: true\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":620,"y":200,"wires":[["7b7ff6b7.b4e7f8"]]},{"id":"6564907d.58255","type":"ui_button","z":"33010803.e6c778","name":"","group":"fc6b6fc0.4ccf3","order":4,"width":4,"height":1,"passthru":false,"label":"Clear DAS Log","tooltip":"clear all table data","color":"","bgcolor":"","icon":"","payload":"true","payloadType":"bool","topic":"","x":280,"y":280,"wires":[["45834555.8396ec"]]},{"id":"45834555.8396ec","type":"function","z":"33010803.e6c778","name":"clearData","func":"\nmsg.payload={\n    command:\"clearData\",\n    arguments: [],\n    returnPromise: true\n}\nreturn msg;","outputs":1,"noerr":0,"x":600,"y":260,"wires":[["7b7ff6b7.b4e7f8"]],"info":"# clear data\n\nunfortunately this command (currently) do not send a promise back! So we have to pass it directly to the table handler"},{"id":"7b7ff6b7.b4e7f8","type":"ui_table","z":"33010803.e6c778","group":"b50986f5.1203e8","name":"Das1 Log Table","order":1,"width":"35","height":5,"columns":[{"field":"das1_col_no","title":"No","width":"10%","align":"left","formatter":"rownum","formatterParams":{"target":"_blank"}},{"field":"das1_col_time","title":"Time","width":"30%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}},{"field":"das1_col_log","title":"DAS 1 Log","width":"60%","align":"left","formatter":"plaintext","formatterParams":{"target":"_blank"}}],"outputs":1,"cts":true,"x":860,"y":260,"wires":[[]],"icon":"font-awesome/fa-th"},{"id":"94dcc70.5974038","type":"function","z":"33010803.e6c778","name":"Split message","func":"CommonFunction = flow.get(\"commonFunctionsDas\");\nlet listTrayDb = flow.get('listTrayDb');\nlet request = new Object();\nlet systemStatus = flow.get('systemStatus');\nmsg.payload = msg.payload.toString();\nnode.warn(msg.payload);\nrequest.dasid= CommonFunction.FilterString(msg.payload.substr(5,3));\nrequest.command = CommonFunction.FilterString(msg.payload.substr(8,12));\nrequest.par1= CommonFunction.FilterString(msg.payload.substr(20,16));\nrequest.par2= CommonFunction.FilterString(msg.payload.substr(36,16));\n\nfor(let i = 0; i < listTrayDb.length; i++) {\n    if(listTrayDb[i][0] === Number(request.par2)) {\n        request.par2 = listTrayDb[i][2];\n        msg.locationId = listTrayDb[i][1];\n        break;\n    }\n}\nnode.warn(request.par2);\nrequest.par3 = CommonFunction.FilterString(msg.payload.substr(52,16));\nnode.warn(msg.payload.substr(53,16));\nnode.warn(request.par3);\nmsg.payload=request;\ndelete msg.confirm;\nif(systemStatus == 1){\n    return msg;\n}\nelse return;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1780,"y":1260,"wires":[["109a0549.edfbbb","ce615417.869598"]]},{"id":"bda8d99f.780bd8","type":"link in","z":"33010803.e6c778","name":"","links":["85df9024.90fb9","921898a2.4a1278","286bf842.491e58","f5238884.9dc098","326b736f.9208fc","7dcd1aa9.de3134"],"x":215,"y":1160,"wires":[["dfb2d324.5568f"]]},{"id":"109a0549.edfbbb","type":"switch","z":"33010803.e6c778","name":"split command","property":"payload.command","propertyType":"msg","rules":[{"t":"eq","v":"CHANGE_LED","vt":"str"},{"t":"eq","v":"SET_LOCATION","vt":"str"},{"t":"eq","v":"SET_TRAYID","vt":"str"}],"checkall":"false","repair":false,"outputs":3,"x":2000,"y":1260,"wires":[["d55148f0.f23428","7e73d0aa.48ab2"],["5f1ccc1f.f42624"],["8f6f7c9d.c0137"]]},{"id":"d55148f0.f23428","type":"function","z":"33010803.e6c778","name":"Set LED's Color","func":"let color = msg.payload.par3;\nlet flowVar = msg.payload.par2 + '_LED';\nflow.set(flowVar, color);\nnode.warn(flowVar);\n\n\n// if(msg.payload.dasid == '1'){       \n    \n    \n//     if(msg.payload.par2 == 'rack11')        flow.set(\"das1_color11\", color);\n//     else if(msg.payload.par2 == 'C1')   flow.set(\"das1_color12\", color);\n//     else if(msg.payload.par2 == 'rack13')   flow.set(\"das1_color13\", color);\n//     else if(msg.payload.par2 == 'rack14')   flow.set(\"das1_color14\", color);\n//     else if(msg.payload.par2 == 'rack21')   flow.set(\"das1_color21\", color);\n//     else if(msg.payload.par2 == 'rack22')   flow.set(\"das1_color22\", color);\n//     else if(msg.payload.par2 == 'rack23')   flow.set(\"das1_color23\", color);\n//     else if(msg.payload.par2 == 'rack24')   flow.set(\"das1_color24\", color);\n//     else if(msg.payload.par2 == 'rack31')   flow.set(\"das1_color31\", color);\n//     else if(msg.payload.par2 == 'rack32')   flow.set(\"das1_color32\", color);\n//     else if(msg.payload.par2 == 'rack33')   flow.set(\"das1_color33\", color);\n//     else if(msg.payload.par2 == 'rack34')   flow.set(\"das1_color34\", color);\n// }               \n\n// else if(msg.payload.dasid == '2'){\n//     if(msg.payload.par2 == 'rack11')        flow.set(\"das2_color11\", color);\n//     else if(msg.payload.par2 == 'rack12')   flow.set(\"das2_color12\", color);\n//     else if(msg.payload.par2 == 'rack13')   flow.set(\"das2_color13\", color);\n//     else if(msg.payload.par2 == 'rack14')   flow.set(\"das2_color14\", color);\n//     else if(msg.payload.par2 == 'rack21')   flow.set(\"das2_color21\", color);\n//     else if(msg.payload.par2 == 'rack22')   flow.set(\"das2_color22\", color);\n//     else if(msg.payload.par2 == 'rack23')   flow.set(\"das2_color23\", color);\n//     else if(msg.payload.par2 == 'rack24')   flow.set(\"das2_color24\", color);\n//     else if(msg.payload.par2 == 'rack31')   flow.set(\"das2_color31\", color);\n//     else if(msg.payload.par2 == 'rack32')   flow.set(\"das2_color32\", color);\n//     else if(msg.payload.par2 == 'rack33')   flow.set(\"das2_color33\", color);\n//     else if(msg.payload.par2 == 'rack34')   flow.set(\"das2_color34\", color);\n// }\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2260,"y":1220,"wires":[["ce615417.869598"]]},{"id":"ce615417.869598","type":"link out","z":"33010803.e6c778","name":"","links":["714397ba.4efa88","567e62d5.f80fac"],"x":2475,"y":1260,"wires":[]},{"id":"9ed4110c.292c7","type":"comment","z":"33010803.e6c778","name":"DAS system","info":"","x":270,"y":420,"wires":[]},{"id":"5f1ccc1f.f42624","type":"function","z":"33010803.e6c778","name":"Set Tray Location","func":"let location = msg.payload.par3;\n\nif(msg.payload.dasid == '1'){               \n    if(msg.payload.par2 ==      'rack11')   flow.set(\"das1_location11\", location);\n    else if(msg.payload.par2 == 'rack12')   flow.set(\"das1_location12\", location);\n    else if(msg.payload.par2 == 'rack13')   flow.set(\"das1_location13\", location);\n    else if(msg.payload.par2 == 'rack14')   flow.set(\"das1_location14\", location);\n    else if(msg.payload.par2 == 'rack21')   flow.set(\"das1_location21\", location);\n    else if(msg.payload.par2 == 'rack22')   flow.set(\"das1_location22\", location);\n    else if(msg.payload.par2 == 'rack23')   flow.set(\"das1_location23\", location);\n    else if(msg.payload.par2 == 'rack24')   flow.set(\"das1_location24\", location);\n    else if(msg.payload.par2 == 'rack31')   flow.set(\"das1_location31\", location);\n    else if(msg.payload.par2 == 'rack32')   flow.set(\"das1_location32\", location);\n    else if(msg.payload.par2 == 'rack33')   flow.set(\"das1_location33\", location);\n    else if(msg.payload.par2 == 'rack34')   flow.set(\"das1_location34\", location);\n}               \n\nelse if(msg.payload.dasid == '2'){\n    if(msg.payload.par2 == 'rack11')        flow.set(\"das2_location11\", location);\n    else if(msg.payload.par2 == 'rack12')   flow.set(\"das2_location12\", location);\n    else if(msg.payload.par2 == 'rack13')   flow.set(\"das2_location13\", location);\n    else if(msg.payload.par2 == 'rack14')   flow.set(\"das2_location14\", location);\n    else if(msg.payload.par2 == 'rack21')   flow.set(\"das2_location21\", location);\n    else if(msg.payload.par2 == 'rack22')   flow.set(\"das2_location22\", location);\n    else if(msg.payload.par2 == 'rack23')   flow.set(\"das2_location23\", location);\n    else if(msg.payload.par2 == 'rack24')   flow.set(\"das2_location24\", location);\n    else if(msg.payload.par2 == 'rack31')   flow.set(\"das2_location31\", location);\n    else if(msg.payload.par2 == 'rack32')   flow.set(\"das2_location32\", location);\n    else if(msg.payload.par2 == 'rack33')   flow.set(\"das2_location33\", location);\n    else if(msg.payload.par2 == 'rack34')   flow.set(\"das2_location34\", location);\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":2270,"y":1260,"wires":[["ce615417.869598"]]},{"id":"8f6f7c9d.c0137","type":"function","z":"33010803.e6c778","name":"Set Tray ID","func":"let trayid = msg.payload.par3;\n\nif(msg.payload.dasid == '1'){               \n    if(msg.payload.par2 == 'rack11')        flow.set(\"das1_trayid11\", trayid);\n    else if(msg.payload.par2 == 'rack12')   flow.set(\"das1_trayid12\", trayid);\n    else if(msg.payload.par2 == 'rack13')   flow.set(\"das1_trayid13\", trayid);\n    else if(msg.payload.par2 == 'rack14')   flow.set(\"das1_trayid14\", trayid);\n    else if(msg.payload.par2 == 'rack21')   flow.set(\"das1_trayid21\", trayid);\n    else if(msg.payload.par2 == 'rack22')   flow.set(\"das1_trayid22\", trayid);\n    else if(msg.payload.par2 == 'rack23')   flow.set(\"das1_trayid23\", trayid);\n    else if(msg.payload.par2 == 'rack24')   flow.set(\"das1_trayid24\", trayid);\n    else if(msg.payload.par2 == 'rack31')   flow.set(\"das1_trayid31\", trayid);\n    else if(msg.payload.par2 == 'rack32')   flow.set(\"das1_trayid32\", trayid);\n    else if(msg.payload.par2 == 'rack33')   flow.set(\"das1_trayid33\", trayid);\n    else if(msg.payload.par2 == 'rack34')   flow.set(\"das1_trayid34\", trayid);\n}               \n\nelse if(msg.payload.dasid == '2'){\n    if(msg.payload.par2 == 'rack11')        flow.set(\"das2_trayid11\", trayid);\n    else if(msg.payload.par2 == 'rack12')   flow.set(\"das2_trayid12\", trayid);\n    else if(msg.payload.par2 == 'rack13')   flow.set(\"das2_trayid13\", trayid);\n    else if(msg.payload.par2 == 'rack14')   flow.set(\"das2_trayid14\", trayid);\n    else if(msg.payload.par2 == 'rack21')   flow.set(\"das2_trayid21\", trayid);\n    else if(msg.payload.par2 == 'rack22')   flow.set(\"das2_trayid22\", trayid);\n    else if(msg.payload.par2 == 'rack23')   flow.set(\"das2_trayid23\", trayid);\n    else if(msg.payload.par2 == 'rack24')   flow.set(\"das2_trayid24\", trayid);\n    else if(msg.payload.par2 == 'rack31')   flow.set(\"das2_trayid31\", trayid);\n    else if(msg.payload.par2 == 'rack32')   flow.set(\"das2_trayid32\", trayid);\n    else if(msg.payload.par2 == 'rack33')   flow.set(\"das2_trayid33\", trayid);\n    else if(msg.payload.par2 == 'rack34')   flow.set(\"das2_trayid34\", trayid);\n}\n\nreturn msg;","outputs":1,"noerr":0,"x":2250,"y":1300,"wires":[["ce615417.869598"]]},{"id":"52987106.84bac","type":"link out","z":"33010803.e6c778","name":"","links":[],"x":795,"y":540,"wires":[]},{"id":"f45bd853.651a68","type":"function","z":"33010803.e6c778","name":"Pack switch command","func":"// CommonFunction = global.get(\"CommonFunction\");\ndelete(msg.event);\ndelete(msg.topic);\ndelete(msg.elementId);\ndelete(msg.selector);\nlet commonFunctionsDas = flow.get('commonFunctionsDas');\nlet systemStatus = flow.get('systemStatus');\nlet listTrayDb = flow.get('listTrayDb');\nlet command = msg.payload;\nif(systemStatus === 0){\n    msg.topic = \"kill\";\n    msg.payload = \"kill\";\n    return msg;\n}\nif(msg.topic === 'login' && systemStatus === 1){\n    msg.topic = \"login\";\n    return msg;\n}\nlet tray_id = command.substr(5, 2);\nmsg.tray_id = tray_id;\nlet flowVar = 'das';\nfor(let i = 0; i < listTrayDb.length; i++) {\n    if(listTrayDb[i][2] === tray_id) {\n        msg.tray_id = String(listTrayDb[i][1]);\n        msg.payload = String(listTrayDb[i][0]);\n        //msg.payload = commonFunctionsDas.CreateMessageCommand(String(listTrayDb[i][3]),8) + commonFunctionsDas.CreateMessageCommand(String(listTrayDb[i][0]),8);\n        break;\n    }\n}\nif(systemStatus == 1){\n    return msg;\n}\nelse return;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":1260,"wires":[["1b5b1d19.cf16f3","8936a7a4.6ec818"]]},{"id":"36eb5121.1a6afe","type":"link out","z":"33010803.e6c778","name":"Connect and disconnect \\n to Server","links":["714397ba.4efa88"],"x":1330,"y":1060,"wires":[],"l":true},{"id":"1c7b1bbe.7b6c14","type":"link out","z":"33010803.e6c778","name":"","links":["1bcc2eff.5daad1","bd13f6c1.f9c438"],"x":1515,"y":1220,"wires":[]},{"id":"7e73d0aa.48ab2","type":"function","z":"33010803.e6c778","name":"Logging change LED DAS 1","func":"let recieve_command = msg.payload;\nmsg.payload = recieve_command.command + ' - DAS ID: ' + recieve_command.dasid + ' - ' + msg.locationId + ' - ' + recieve_command.par3;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":2300,"y":1180,"wires":[["e95dbf16.c12c7"]]},{"id":"e95dbf16.c12c7","type":"link out","z":"33010803.e6c778","name":"","links":["1bcc2eff.5daad1","bd13f6c1.f9c438"],"x":2475,"y":1180,"wires":[]},{"id":"1b5b1d19.cf16f3","type":"function","z":"33010803.e6c778","name":"Logging confirm LED DAS 1","func":"if(msg.payload === 'kill' || msg.payload === 'login') return;\nmsg.payload = 'Confirm ' + String(msg.tray_id);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1360,"y":1220,"wires":[["1c7b1bbe.7b6c14"]]},{"id":"d0ee4646.004c48","type":"switch","z":"33010803.e6c778","name":"Check Start","property":"topic","propertyType":"msg","rules":[{"t":"eq","v":"start","vt":"str"},{"t":"eq","v":"stop","vt":"str"}],"checkall":"true","repair":false,"outputs":2,"x":630,"y":1080,"wires":[["a7a3fed8.85dcd"],["dbd06559.5ffc28"]]},{"id":"a7a3fed8.85dcd","type":"change","z":"33010803.e6c778","name":"","rules":[{"t":"set","p":"systemStatus","pt":"flow","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":1060,"wires":[["cc47f3b8.e9595","2988439b.04034c"]]},{"id":"dbd06559.5ffc28","type":"change","z":"33010803.e6c778","name":"","rules":[{"t":"set","p":"systemStatus","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":840,"y":1100,"wires":[["38c42c8a.364dd4","cc47f3b8.e9595"]]},{"id":"38c42c8a.364dd4","type":"link out","z":"33010803.e6c778","name":"Clear Log table ","links":["28d90798.71a678"],"x":1080,"y":1100,"wires":[],"l":true},{"id":"28d90798.71a678","type":"link in","z":"33010803.e6c778","name":"Clear Log tables","links":["38c42c8a.364dd4"],"x":280,"y":240,"wires":[["45834555.8396ec"]],"l":true},{"id":"cc47f3b8.e9595","type":"function","z":"33010803.e6c778","name":"Clear msg ","func":"msg = {};\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1070,"y":1060,"wires":[["36eb5121.1a6afe","2988439b.04034c"]]},{"id":"2988439b.04034c","type":"function","z":"33010803.e6c778","name":"send msg to \\n connect or kill socket","func":"let systemStatus = flow.get('systemStatus');\nif(systemStatus != 1){\n    msg.topic = \"kill\";\n    return msg;\n}\nelse if(systemStatus == 1){\n    msg.topic = \"login\";\n    return msg;\n}\ndelete(msg.payload);\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1080,"y":1200,"wires":[["f45bd853.651a68"]]},{"id":"ed50ec11.510cc","type":"function","z":"33010803.e6c778","name":"check confirm","func":"if(msg.topic === 'confirm'){\n    return msg;\n} else return;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":640,"y":1260,"wires":[["f45bd853.651a68"]]},{"id":"e4410c41.4f422","type":"catch","z":"33010803.e6c778","name":"Catch DAS1 connection fail","scope":["e672a30e.879a4"],"uncaught":false,"x":310,"y":140,"wires":[["21935251.e3da0e"]]},{"id":"21935251.e3da0e","type":"function","z":"33010803.e6c778","name":"Create connection fail message","func":"msg.payload = 'DAS: Connection Fail to Server';\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":140,"wires":[["8a832fda.408cf"]]},{"id":"27101dc6.5d3242","type":"inject","z":"33010803.e6c778","name":"Read config file IP server","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"","topic":"","payload":"$env('DAS_Server_ip')","payloadType":"jsonata","x":330,"y":580,"wires":[["ead32fd8.b5f2d"]]},{"id":"ead32fd8.b5f2d","type":"function","z":"33010803.e6c778","name":"Save config file IP server","func":"flow.set('dasServerIp', msg.payload);\nreturn ;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":580,"wires":[[]]},{"id":"8c540283.a2588","type":"inject","z":"33010803.e6c778","name":"Read config file IP server","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"","topic":"","payload":"$env('DAS1_port')","payloadType":"jsonata","x":330,"y":620,"wires":[["911aa5ef.aa5cf8"]]},{"id":"911aa5ef.aa5cf8","type":"function","z":"33010803.e6c778","name":"Save config file das1 port","func":"flow.set('das1Port', msg.payload);\nreturn ;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":620,"wires":[[]]},{"id":"9c53ab02.9db228","type":"inject","z":"33010803.e6c778","name":"Read config file IP server","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"","topic":"","payload":"$env('DAS2_port')","payloadType":"jsonata","x":330,"y":660,"wires":[["c49edf93.eb111"]]},{"id":"c49edf93.eb111","type":"function","z":"33010803.e6c778","name":"Save config file das2 port","func":"flow.set('das2Port', msg.payload);\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":660,"wires":[[]]},{"id":"8936a7a4.6ec818","type":"function","z":"33010803.e6c778","name":"set ip and port","func":"// msg.host = flow.get('dasServerIp');\n// msg.port = Number(flow.get('das1Port'));\nmsg.host = '10.116.42.123'\nmsg.port = 40001;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":1300,"y":1280,"wires":[["e672a30e.879a4"]]},{"id":"dfb2d324.5568f","type":"ui_svg_graphics","z":"33010803.e6c778","group":"13ea8cb5.fc97a3","order":4,"width":"35","height":"17","svgString":"<style>\nbody{\n    background-color: gray;\n}\n.grid-container {\n  display: grid;\n  grid-gap: 5px 5px;\n  grid-template-columns: auto auto auto auto;\n  background-color: #a6a6a6;\n  padding: 5px;\n}\n\n.grid-item {\n  background-color: #333333;\n  border: 1px solid white;\n  padding: 5px;\n  height: 150px;\n  width: 200px;\n  font-size: 20px;\n  text-align: center;\n}\n\n/* Create three equal columns that floats next to each other */\n.column {\n  float: left;\n  width: 48%;\n  padding: 15px;\n  padding-bottom: 5px;\n}\n\n/* Clear floats after the columns */\n.row:after {\n  content: \"\";\n  display: table;\n  clear: both;\n}\n\n/* Responsive layout - makes the three columns stack on top of each other instead of next to each other */\n@media screen and (max-width:800px) {\n  .column {\n    width: 100%;\n  }\n}\n.layout-title {\n\tdisplay: grid;\n\tgrid-template-columns: auto auto auto;\n\tgrid-column-gap: auto;\n}\n.d-flex {\n\tdisplay: flex;\n\tjustify-content: left;\n\talign-items: left;\n}\n.pading-title{\n\tpadding: 5px 5px;\n\twidth: 120px;\n\theight: 25px;\n}\n.label-radius {\n\tborder-radius: 7px;\n\twidth: 100%;\n\theight: 100%;\n\tcolor: #bfbfbf;\n\tfont-weight: 700;\n\tbackground-color: #333333;\n\ttext-align: left;\n}\n.pading-5{\n\tpadding: 0px 5px;\n}\n.label-circle{\n\tborder-radius: 50%;\n\twidth: 12px;\n\theight: 12px;\n\tpadding: 12px 12px;          \n}\n.navBut{\n    height: 40px; \n    width: 100px; \n    margin-top: 0px; \n    margin-right: 10px; \n    border-radius: 7px; \n    cursor: pointer;\n    color: white;\n}\n\n</style>\n<svg x=\"0\" y=\"0\" height=\"900\" width=\"1875\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:svg=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\">\n</svg>","clickableShapes":[{"targetId":"#StartButton","action":"click","payload":"start","payloadType":"str","topic":"start"},{"targetId":"#StopButton","action":"click","payload":"stop","payloadType":"str","topic":"stop"}],"smilAnimations":[],"bindings":[{"selector":"","bindSource":"","bindType":"text","attribute":""}],"showCoordinates":false,"autoFormatAfterEdit":false,"showBrowserErrors":false,"outputField":"payload","editorUrl":"//drawsvg.org/drawsvg.html","directory":"","panning":"disabled","zooming":"disabled","panOnlyWhenZoomed":false,"doubleClickZoomEnabled":false,"mouseWheelZoomEnabled":false,"name":"","x":380,"y":1160,"wires":[["bae6c9ae.c77d48","ed50ec11.510cc","d0ee4646.004c48"]]},{"id":"9e01cb91.6d26f8","type":"function","z":"33010803.e6c778","name":"global template","func":"flow.set('global_template_das', msg.payload);\nreturn ;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":380,"wires":[[]]},{"id":"79fc8a71.2567e4","type":"template","z":"33010803.e6c778","name":"","field":"payload","fieldType":"msg","format":"json","syntax":"mustache","template":"{\n    \"Line\": {\n        \"command\": \"add_element\",\n        \"elementType\": \"line\",\n        \"elementId\": \"\",\n        \"elementAttributes\": {\n            \"x1\": \"\",\n            \"y1\": \"\",\n            \"x2\": \"\",\n            \"y2\": \"\"\n        },\n        \"elementStyleAttributes\": {\n            \"fill\": \"none\",\n            \"stroke\": \"\",\n            \"stroke-width\": \"\"\n        }\n    },\n    \"Remove\": {\n        \"command\": \"remove_element\",\n        \"selector\": \"\"\n    },\n    \"Round\": {\n        \"command\": \"add_element\",\n        \"elementType\": \"circle\",\n        \"elementId\": \"\",\n        \"elementAttributes\": {\n            \"cx\": \"\",\n            \"cy\": \"\",\n            \"r\": \"\"\n        },\n        \"elementStyleAttributes\": {\n            \"fill\": \"black\",\n            \"stroke\": \"black\",\n            \"stroke-width\": \"1px\"\n        }\n    },\n    \"Square\": {\n        \"command\": \"add_element\",\n        \"elementType\": \"rect\",\n        \"elementId\": \"\",\n        \"elementAttributes\": {\n            \"x\": \"\",\n            \"y\": \"\",\n            \"width\": \"\",\n            \"height\": \"\"\n        },\n        \"elementStyleAttributes\": {\n            \"fill\": \"none\",\n            \"stroke\": \"black\",\n            \"stroke-width\": \"0.1px\"\n        }\n    },\n    \"AGV\": [\n        {\n            \"command\": \"add_element\",\n            \"elementType\": \"circle\",\n            \"elementId\": \"\",\n            \"elementAttributes\": {\n                \"cx\": \"\",\n                \"cy\": \"\",\n                \"r\": \"\"\n            },\n            \"elementStyleAttributes\": {\n                \"fill\": \"none\",\n                \"stroke\": \"blue\",\n                \"stroke-width\": \"0.5px\"\n            },\n            \"textContent\": \"1234\"\n        },\n        {\n            \"command\": \"add_element\",\n            \"elementType\": \"rect\",\n            \"elementId\": \"\",\n            \"elementAttributes\": {\n                \"x\": \"\",\n                \"y\": \"\",\n                \"width\": \"\",\n                \"height\": \"\"\n            },\n            \"elementStyleAttributes\": {\n                \"fill\": \"none\",\n                \"stroke\": \"blue\",\n                \"stroke-width\": \"2px\"\n            }\n        },\n        {\n            \"command\": \"add_element\",\n            \"elementType\": \"line\",\n            \"elementId\": \"\",\n            \"elementAttributes\": {\n                \"x1\": \"\",\n                \"y1\": \"\",\n                \"x2\": \"\",\n                \"y2\": \"\"\n            },\n            \"elementStyleAttributes\": {\n                \"fill\": \"none\",\n                \"stroke\": \"black\",\n                \"stroke-width\": \"2px\"\n            }\n        },\n        {\n            \"command\": \"add_element\",\n            \"elementType\": \"text\",\n            \"elementId\": \"\",\n            \"elementAttributes\": {\n                \"x\": \"\",\n                \"y\": \"\"\n            },\n            \"elementStyleAttributes\": {\n                \"fill\": \"none\",\n                \"stroke\": \"black\",\n                \"stroke-width\": \"1px\"\n            },\n            \"textContent\": \"\"\n        }\n    ],\n    \"Text\": {\n        \"command\": \"add_element\",\n        \"elementType\": \"text\",\n        \"elementId\": \"\",\n        \"elementAttributes\": {\n            \"x\": \"\",\n            \"y\": \"\"\n        },\n        \"elementStyleAttributes\": {\n            \"fill\": \"white\",\n            \"font-size\": \"\"\n        },\n        \"textContent\": \"\"\n    },\n    \"ForeignObject\": {\n        \"command\": \"add_element\",\n        \"elementType\": \"foreignObject\",\n        \"elementId\": \"\",\n        \"elementAttributes\": {\n            \"x\": \"\",\n            \"y\": \"\",\n            \"width\": \"\",\n            \"height\": \"\"\n        },\n        \"textContent\": \"\"\n    },\n    \"Event\": {\n        \"command\": \"add_event\",\n        \"event\": \"click\",\n        \"selector\": \"\",\n        \"payload\": \"\",\n        \"topic\": \"\"\n    },\n     \"UpdateText\": {\n      \"command\": \"update_text\",\n      \"selector\": \"\",\n      \"textContent\": \"\"\n    },\n    \"UpdateLed\": {\n        \"command\": \"update_attribute\",\n        \"selector\": \"\",\n        \"attributeName\": \"style\",\n        \"attributeValue\": \"\"\n    },\n    \"UpdateButton\": {\n        \"command\": \"update_attribute\",\n        \"selector\": \"\",\n        \"attributeName\": \"style\",\n        \"attributeValue\": \"\"\n    },\n    \"UpdateTrayID\": {\n        \"command\": \"update_attribute\",\n        \"selector\": \"\",\n        \"attributeName\": \"placeholder\",\n        \"attributeValue\": \"\"\n    }\n}","output":"json","x":600,"y":380,"wires":[["9e01cb91.6d26f8"]]},{"id":"425bc54c.0b92cc","type":"inject","z":"33010803.e6c778","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.05","topic":"","payload":"","payloadType":"date","x":290,"y":340,"wires":[["79fc8a71.2567e4","b604911b.91833","dba35c60.1d40b","d2875606.d48fc8","cb0c7afe.728748"]]},{"id":"b604911b.91833","type":"function","z":"33010803.e6c778","name":"Common functions","func":"let json = flow.get('global_template_das');\nlet width = flow.get('width');\nlet height = flow.get('height');\nlet commonFunctionsDas = {};\n\ncommonFunctionsDas.createSquare = function createMsgSquare(id, x, y, width, height, color, stroke, stroke_width){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.Square));\n    createMsg.elementId = String(id);\n    createMsg.elementAttributes.x = x;\n    createMsg.elementAttributes.y = y;\n    createMsg.elementAttributes.width = width;\n    createMsg.elementAttributes.height = height;\n    createMsg.elementStyleAttributes.fill = String(color);\n    createMsg.elementStyleAttributes.stroke = String(stroke);\n    createMsg.elementStyleAttributes[\"stroke-width\"] = String(stroke_width);\n    return createMsg;\n}\ncommonFunctionsDas.createRound = function createRound(id, x, y, r, color, stroke, stroke_width){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.Round));\n    //createMsg = json.Round;\n    createMsg.elementId = String(id);\n    createMsg.elementAttributes.cx = x;\n    createMsg.elementAttributes.cy = y;\n    createMsg.elementAttributes.r = r;\n    createMsg.elementStyleAttributes.fill = String(color);\n    createMsg.elementStyleAttributes.stroke = String(stroke);\n    createMsg.elementStyleAttributes[\"stroke-width\"] = String(stroke_width);\n    return createMsg;\n}\n\ncommonFunctionsDas.createLine = function createLine(id, x1, y1, x2, y2, color, stroke_width){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.Line));\n    createMsg.elementId = String(id);\n    createMsg.elementAttributes.x1 = x1;\n    createMsg.elementAttributes.y1 = y1;\n    createMsg.elementAttributes.x2 = x2;\n    createMsg.elementAttributes.y2 = y2;\n    createMsg.elementStyleAttributes.stroke = String(color);\n     createMsg.elementStyleAttributes[\"stroke-width\"] = String(stroke_width);\n    return createMsg;\n}\n\ncommonFunctionsDas.createText = function createText(id, x, y, color,front_size, content){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.Text));\n    createMsg.elementId = String(id);\n    createMsg.elementAttributes.x = x;\n    createMsg.elementAttributes.y = y;\n    createMsg.elementStyleAttributes.fill = String(color);\n    createMsg.elementStyleAttributes[\"font-size\"] = front_size;\n    createMsg.textContent = String(content);\n    return createMsg;\n}\n\ncommonFunctionsDas.createForeignObject = function createForeignObject(id, x, y, width, height, content){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.ForeignObject));\n    createMsg.elementId = String(id);\n    createMsg.elementAttributes.x = x;\n    createMsg.elementAttributes.y = y;\n    createMsg.elementAttributes.width = width;\n    createMsg.elementAttributes.height = height;\n    createMsg.textContent = String(content);\n    return createMsg;\n}\n\ncommonFunctionsDas.createEvent = function createEvent(selector, payload, topic){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.Event));\n    createMsg.selector = selector;\n    createMsg.payload = payload;\n    createMsg.topic = topic;\n    return createMsg;\n}\n\ncommonFunctionsDas.updateText = function updateText(selector, content){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.UpdateText));\n    createMsg.selector = selector;\n    createMsg.textContent = content;\n    return createMsg;\n}\n\ncommonFunctionsDas.updateLed = function updateLed(selector, color){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.UpdateLed));\n    createMsg.selector = selector;\n    createMsg.attributeValue = \"fill:\" + color + \"; stroke:none; stroke-width:0px;\";\n    return createMsg;\n}\n\ncommonFunctionsDas.updateButton = function updateButton(selector, color){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.UpdateButton));\n    createMsg.selector = selector;\n    createMsg.attributeValue = \"background-color:\" + color + \";\";\n    return createMsg;\n}\n\ncommonFunctionsDas.remove = function remove(selector){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.Remove));\n    createMsg.selector = selector;\n    return createMsg;\n}\n\ncommonFunctionsDas.FilterString = function FilterString(strMessage){\n    let result= \"\";\n    for(let i = 0; i < strMessage.length; i++){\n        if(strMessage[i] === '-'){\n           continue;\n        }\n        else result += strMessage[i];\n    }\n    return result;\n}\n\ncommonFunctionsDas.CreateMessageCommand = function CreateMessageCommand(strMessage, messageLength){//sua ten thanh CreateMessageCommand\n    let result= String(strMessage);\n    for(let i = strMessage.length; i < messageLength; i++){\n        result += '-';\n    }\n    return result;\n}\n\ncommonFunctionsDas.updateTrayID = function updateTrayID(selector, id){\n    let createMsg = {};\n    createMsg = JSON.parse(JSON.stringify(json.UpdateTrayID));\n    createMsg.selector = selector;\n    createMsg.attributeValue = id;\n    return createMsg;\n}\n\n// \"UpdateTrayID\": {\n//         \"command\": \"update_attribute\",\n//         \"selector\": \"\",\n//         \"attributeName\": \"placeholder\",\n//         \"attributeValue\": \"\"\n//     }\n\nflow.set('commonFunctionsDas', commonFunctionsDas);\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":630,"y":420,"wires":[[]]},{"id":"dba35c60.1d40b","type":"change","z":"33010803.e6c778","name":"set display size","rules":[{"t":"set","p":"width","pt":"flow","to":"1875","tot":"num"},{"t":"set","p":"height","pt":"flow","to":"850","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":340,"wires":[[]]},{"id":"bae6c9ae.c77d48","type":"debug","z":"33010803.e6c778","name":"FloorPlan","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"true","targetType":"full","statusVal":"","statusType":"auto","x":640,"y":1160,"wires":[]},{"id":"e672a30e.879a4","type":"tcp request TSDV","z":"33010803.e6c778","server":"","port":"","out":"sit","splitc":" ","name":"","x":1550,"y":1280,"wires":[["94dcc70.5974038"]]},{"id":"51a5101b.11048","type":"inject","z":"33010803.e6c778","name":"Set database properties","props":[{"p":"payload"},{"p":"host","v":"$env('DAS_db_host')","vt":"jsonata"},{"p":"port","v":"$env('DAS_db_port')","vt":"jsonata"},{"p":"user","v":"$env('DAS_db_user')","vt":"jsonata"},{"p":"password","v":"$env('DAS_db_password')","vt":"jsonata"},{"p":"database","v":"$env('DAS_db_database')","vt":"jsonata"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.05","topic":"","payload":"","payloadType":"date","x":250,"y":800,"wires":[["7b276ee0.45009","2ad106c4.273a8a"]]},{"id":"7b276ee0.45009","type":"function","z":"33010803.e6c778","name":"Create Query \\n command","func":"let dasNo = flow.get('dasNo');\nquery = 'SELECT id,location_id,digit,das_id FROM das_locations WHERE das_id=' +  dasNo + ';';\nmsg.topic = query; \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":800,"wires":[["4f60be11.bb957"]]},{"id":"aaf3db8d.640ce8","type":"function","z":"33010803.e6c778","name":"Update flow variables","func":"let result = msg.payload;\nlet listTray = [];\nfor(let i = 0; i < result.length; i++) {\n    listTray.push([result[i].id, result[i].location_id, result[i].digit.replace(/-/g,''), result[i].das_id]);\n}\nflow.set('listTrayDb', listTray);\nreturn;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":860,"y":800,"wires":[[]]},{"id":"d2875606.d48fc8","type":"change","z":"33010803.e6c778","name":"set das no","rules":[{"t":"set","p":"dasNo","pt":"flow","to":"1","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":610,"y":300,"wires":[[]]},{"id":"8818b1e1.4fe81","type":"inject","z":"33010803.e6c778","name":"DAS Config Type","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"{\"THUNDER\":{\"type\":\"THUNDER\",\"description\":\"\",\"width\":0,\"height\":0,\"depth\":0,\"layouts\":[{\"dx\":0,\"dy\":-1,\"cells\":[{\"type\":\"SMALL\",\"digit\":\"A-1\",\"color\":\"#DB4437\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"A-2\",\"color\":\"#DB4437\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"A-3\",\"color\":\"#DB4437\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"B-1\",\"color\":\"#4285F4\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"B-2\",\"color\":\"#4285F4\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"C-1\",\"color\":\"#0F9D58\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"C-2\",\"color\":\"#0F9D58\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"D-1\",\"color\":\"#a8328f\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"D-2\",\"color\":\"#a8328f\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"D-3\",\"color\":\"#a8328f\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"D-4\",\"color\":\"#a8328f\",\"width\":0,\"height\":0,\"depth\":0}],\"grid\":\"'D-1 D-2 D-3 D-4''C-1 C-1 C-2 C-2''A-1 B-1 B-2 B-2''A-1 A-2 A-2 A-3'\"}]},\"RAINBOW\":{\"type\":\"RAINBOW\",\"description\":\"\",\"width\":0,\"height\":0,\"depth\":0,\"layouts\":[{\"dx\":0,\"dy\":-1,\"cells\":[{\"type\":\"SMALL\",\"digit\":\"A-1\",\"color\":\"#DB4437\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"A-2\",\"color\":\"#DB4437\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"A-3\",\"color\":\"#DB4437\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"A-4\",\"color\":\"#DB4437\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"A-5\",\"color\":\"#DB4437\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"B-1\",\"color\":\"#4285F4\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"B-2\",\"color\":\"#4285F4\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"B-3\",\"color\":\"#4285F4\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"B-4\",\"color\":\"#4285F4\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"B-5\",\"color\":\"#4285F4\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"C-1\",\"color\":\"#0F9D58\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"C-2\",\"color\":\"#0F9D58\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"C-3\",\"color\":\"#0F9D58\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"C-4\",\"color\":\"#0F9D58\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"C-5\",\"color\":\"#0F9D58\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"D-1\",\"color\":\"#a8328f\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"D-2\",\"color\":\"#a8328f\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"D-3\",\"color\":\"#a8328f\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"D-4\",\"color\":\"#a8328f\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"D-5\",\"color\":\"#a8328f\",\"width\":0,\"height\":0,\"depth\":0}],\"grid\":\"'D-1 D-2 D-3 D-4 D-5''C-1 C-2 C-3 C-4 C-5''B-1 B-2 B-3 B-4 B-5''A-1 A-2 A-3 A-4 A-5'\"}]}}","payloadType":"json","x":310,"y":500,"wires":[["8a4a35a2.21b418"]]},{"id":"8a4a35a2.21b418","type":"function","z":"33010803.e6c778","name":"DAS config layout file (DAS type)","func":"//msg.payload = {\"THUNDER\":{\"type\":\"THUNDER\",\"description\":\"\",\"width\":0,\"height\":0,\"depth\":0,\"layouts\":[{\"dx\":0,\"dy\":-1,\"cells\":[{\"type\":\"SMALL\",\"digit\":\"A-1\",\"color\":\"#DB4437\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"A-2\",\"color\":\"#DB4437\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"A-3\",\"color\":\"#DB4437\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"B-1\",\"color\":\"#4285F4\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"B-2\",\"color\":\"#4285F4\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"C-1\",\"color\":\"#0F9D58\",\"width\":0,\"height\":0,\"depth\":0},{\"type\":\"SMALL\",\"digit\":\"C-2\",\"color\":\"#0F9D58\",\"width\":0,\"height\":0,\"depth\":0}],\"grid\":\"'C-1 C-1 C-2 C-2''A-1 B-1 B-2 B-2''A-1 A-2 A-2 A-3'\"}]}};\nflow.set('dasType', msg.payload);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":680,"y":500,"wires":[[]]},{"id":"ebc6e1a.cf1a32","type":"inject","z":"33010803.e6c778","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":270,"y":1380,"wires":[["a31fb050.30336"]]},{"id":"a31fb050.30336","type":"function","z":"33010803.e6c778","name":"process layout","func":"let dasType = flow.get('dasType');    \nlet dasTypeName = flow.get('dasTypeName'); \nlet grid = dasType[dasTypeName].layouts[0].grid;\nlet gridArr = [];\nlet dasHeight = flow.get('height');\nlet dasWidth = flow.get('width');\nfor(let i = 0; i < grid.length; i++) {\n    if(grid[i] === \"'\"  && grid[i + 1] === \"'\") {\n        let subString = grid.substr(0, i);\n        gridArr.push(subString);\n    }\n}\ngridArr.push(grid);\nfor(let i = 0; i < gridArr.length; i++) {\n        gridArr[i] = gridArr[i].replace(/'/g,'');\n        gridArr[i] = gridArr[i].replace(/-/g,'');\n}\nfor(let i = gridArr.length - 1; i >= 1; i--) {\n    gridArr[i] = gridArr[i].substr(gridArr[i - 1].length, gridArr[i].length - gridArr[i - 1].length);\n}\n\n// convert string arr to 2 dimensional grid arr\nfor(let i = 0; i < gridArr.length; i++) {\n    gridArr[i] = gridArr[i].split(\" \");\n}\n\nlet width = gridArr[1].length;\nlet height = gridArr.length;\n\n// check if visted grid\nfunction checkVisted(grid, arr) {\n    if(arr.length === 0) return false;\n    for(let i = 0; i < arr.length; i++) {\n            if(grid === arr[i]) return true;\n    }\n    return false;\n}\n\n\nlet mergedGrid = [];\nlet visted = [];\nfor(let i = 0; i < gridArr.length; i++) {\n    let maxX = 0;\n    let maxY = 0;\n    for (let j = 0; j < gridArr[i].length; j++) {\n        if(checkVisted(gridArr[i][j], visted)) continue;\n        else {\n            for(let m = 0; m < gridArr[i].length; m++) {\n                if(gridArr[i][m] == gridArr[i][j]) maxX = m - j + 1;\n            }\n            for(let n = 0; n < gridArr.length; n++) {\n                if(gridArr[n][j] == gridArr[i][j]) maxY = n - i + 1;\n            }\n            visted.push(gridArr[i][j]);\n            mergedGrid.push([gridArr[i][j], maxX, maxY, j, i])\n        }\n    }\n}\nmsg.topic = visted;\nmsg.payload = mergedGrid;\n\nlet builder = [];\nfor(let i = 0; i < height; i++){\n    for(let m = 0; m < mergedGrid.length; m++) {\n        if(mergedGrid[m][4] == i) {\n            builder.push([ (mergedGrid[m][3] / width) * dasWidth, (mergedGrid[m][4] / height) * dasHeight, (mergedGrid[m][1] / width) * 100, (mergedGrid[m][2] / height) * 100,  mergedGrid[m][0]]);\n        }\n    }\n}\nflow.set('listTray', builder);\nmsg.builder = builder;\nflow.set('arrBuilder', builder);\ndelete(msg.topic);\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":480,"y":1380,"wires":[["78d5b16a.30e17"]]},{"id":"714397ba.4efa88","type":"link in","z":"33010803.e6c778","name":"","links":["ce615417.869598","36eb5121.1a6afe"],"x":295,"y":1340,"wires":[["a31fb050.30336"]]},{"id":"b8abbb4.a260248","type":"ui_ui_control","z":"33010803.e6c778","name":"Reload event","events":"all","x":250,"y":1460,"wires":[["c78bb77a.bdc068","4036082.cd2c1f8"]]},{"id":"c78bb77a.bdc068","type":"delay","z":"33010803.e6c778","name":"Wait stable","pauseType":"delay","timeout":"300","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"x":250,"y":1420,"wires":[["a31fb050.30336"]]},{"id":"78d5b16a.30e17","type":"function","z":"33010803.e6c778","name":"Test custom layout","func":"let commonFunctionsDas = flow.get('commonFunctionsDas');\n\n// list tray read from Db\nlet listTrayDb = flow.get('listTrayDb');\nlet displayHeight = flow.get('height');\nlet displayWidth = flow.get('width');\n\n// list tray made from config file\nlet listTray =  flow.get('listTray');\nlet builder = flow.get('arrBuilder');\n\n// tray layput coefficients\nconst ledXCoeff = 0.9;\nconst ledYCoeff = 0.15;\nconst ledRCoeff = 0.1;\nconst locationXCoeff = 0.1;\nconst locationYCoeff = 0.18;\nconst locationFontCoeff = 0.13;\nconst trayXCoeff = 0.1;\nconst trayYCoeff = 0.4;\nconst trayIdWidthCoeff = 0.8;\nconst trayIdHeightCoeff = 0.2;\nconst confirmXCoeff = 0.1;\nconst confirmYCoeff = 0.4;\nconst confirmWidthCoeff = 0.8;\nconst confirmHeightCoeff = 0.2;\n\nlet systemStatus = flow.get('systemStatus');\nlet drawMsg = [];\nlet navBar = \"<div class='d-flex pading-title' style='padding: 0px; width: \" + displayWidth +\"px; height: 40px; font-size: 25px;'><button id='StartButton' style='background-color: #097479;' class='border-buton navBut'>Start</button><button id='StopButton' style='background-color: #097479;' class='border-buton navBut'>Stop</button><label class='label-radius d-flex' style='justify-content: center; width:85%;'>DAS 1</label></div>\";\ndrawMsg.push(commonFunctionsDas.createForeignObject(\"Tray_navBar\", 0, 0, displayWidth, displayHeight, navBar));\n\nif(systemStatus === 0) {\n    drawMsg.push(commonFunctionsDas.remove('#StartButton'));\n    drawMsg.push(commonFunctionsDas.remove('#StopButton'));\n    drawMsg.push(commonFunctionsDas.remove('[id^=Tray]'));\n    drawMsg.push(commonFunctionsDas.createForeignObject(\"Tray_navBar\", 0, 0, displayWidth, displayHeight, navBar));\n    drawMsg.push(commonFunctionsDas.updateButton('#StartButton', '#097479'));\n    drawMsg.push(commonFunctionsDas.updateButton('#StopButton', 'gray'));\n    msg.payload = drawMsg;\n    return msg;\n}\n\ndrawMsg.push(commonFunctionsDas.updateButton('#StartButton', 'gray'));\ndrawMsg.push(commonFunctionsDas.updateButton('#StopButton', 'red'));\n\nfor(let i = 0; i < listTray.length; i++) {\n    let id = listTray[i][4];\n    let x = listTray[i][0];\n    let y = listTray[i][1] + 45;\n    let trayWidth = ( listTray[i][2] / 100 )* displayWidth;\n    let trayHeight = ( listTray[i][3] /100 ) * displayHeight;\n    let ledX = x + ledXCoeff * trayWidth;\n    let ledY = y + ledYCoeff * trayHeight;\n    let ledR = 0;\n    let locationFont = 0;\n    let locationX = x + locationXCoeff * trayWidth;\n    let locationY = y + locationYCoeff * trayHeight;\n    let trayIdWidth = trayIdWidthCoeff * trayWidth;\n    let trayIdHeight = trayIdHeightCoeff * trayHeight;\n    if(trayWidth * 0.8 > trayHeight) {\n        ledR = trayHeight * ledRCoeff ;\n        locationFont = trayHeight * locationFontCoeff;\n    } else {\n        ledR = trayWidth * ledRCoeff * 0.6;\n        locationFont = trayWidth * locationFontCoeff * 0.6;\n    }\n    let contentTrayId = \"<Label class='f-weight font-label form-control'><input id='tray_\" + id + \"_id' type='text' placeholder='\" + flow.get('tray_' + id + '_id')+ \"' style='font-weight: bold; width: \" + String(trayIdWidth) + \"px; height: \" + String(trayIdHeight) + \"px; text-align: center; font-size: 15px;'></Label>\";\n    let contentConfrim = \"<button id='Tray_btn_\" + id + \"' class='border-buton buton' style='color: white; background-color:#097479; width: \" + String(trayIdWidth + 8) + \"px; height: \" + String(trayIdHeight + 8) + \"px;border-radius: 7px;'>Confirm</button>\";\n    drawMsg.push(commonFunctionsDas.createSquare('Tray_' + String(i), x, y, trayWidth, trayHeight, '#333333', 'lightgray', '3px'));\n    drawMsg.push(commonFunctionsDas.createRound(\"Tray_\" + id + \"_LED\", ledX, ledY, ledR, flow.get(id + '_LED'), 'none', '0px'));\n    drawMsg.push(commonFunctionsDas.createText(\"Tray_\" + id + \"_LocationID\", locationX, locationY, '#d9d9d9', locationFont, 'Location ' + String(i)));\n    drawMsg.push(commonFunctionsDas.createForeignObject(\"Tray_\" + String(i) + \"_TrayId\", x + 0.1 * trayWidth, y + 0.4 * trayHeight, trayWidth, trayHeight, contentTrayId));\n    drawMsg.push(commonFunctionsDas.createForeignObject(\"Tray_\" + String(i) + \"_Confirm\", x + 0.1 * trayWidth, y + 0.7 * trayHeight, trayWidth, trayHeight, contentConfrim));\n    drawMsg.push(commonFunctionsDas.createEvent('#Tray_btn_' + id, \"Tray_\" + id + \"_Confirm\", \"confirm\"));  \n}\n\n// update LocationID\nfunction search(string) {\n    for(let i = 0; i < listTrayDb.length; i++) {\n        if(listTrayDb[i][2] === string) return i;\n    }\n}\n\nfor(let i = 0; i < builder.length; i++) {\n    drawMsg.push(commonFunctionsDas.updateText('#Tray_' + builder[i][4] + '_LocationID', listTrayDb[search(builder[i][4])][1]));\n}\n// update LED\nfor(let i = 0; i < builder.length; i++) {\n    drawMsg.push(commonFunctionsDas.updateLed('#Tray_' + builder[i][4] + '_LED', flow.get(builder[i][4] + '_LED')));\n}\n\nmsg.payload = drawMsg;\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":670,"y":1380,"wires":[["326b736f.9208fc"]]},{"id":"fddcba85.07e988","type":"comment","z":"33010803.e6c778","name":"Get DAS informations from DB","info":"","x":330,"y":740,"wires":[]},{"id":"326b736f.9208fc","type":"link out","z":"33010803.e6c778","name":"","links":["bda8d99f.780bd8"],"x":815,"y":1380,"wires":[]},{"id":"f9d6566c.ca1a48","type":"inject","z":"33010803.e6c778","name":"Reset System Status","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.2","topic":"","payload":"","payloadType":"str","x":320,"y":540,"wires":[["b2ae70f2.73b1b"]]},{"id":"b2ae70f2.73b1b","type":"change","z":"33010803.e6c778","name":"Rest System Status ","rules":[{"t":"set","p":"systemStatus","pt":"flow","to":"0","tot":"num"}],"action":"","property":"","from":"","to":"","reg":false,"x":630,"y":540,"wires":[["52987106.84bac"]]},{"id":"2ad106c4.273a8a","type":"function","z":"33010803.e6c778","name":"Create Query \\n command","func":"let dasNo = flow.get('dasNo');\nquery = 'SELECT name FROM asset_configs WHERE id=' +  dasNo + ';';\nmsg.topic = query; \nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":490,"y":880,"wires":[["d4d088da.94a928"]]},{"id":"93356e17.0172b","type":"function","z":"33010803.e6c778","name":"Update flow variables","func":"flow.set('dasTypeName', msg.payload[0].name);\nreturn;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","x":860,"y":880,"wires":[[]]},{"id":"d4d088da.94a928","type":"mysqlTSDV","z":"33010803.e6c778","mydb":"b7dfc222.c1566","name":"DAS type","x":660,"y":880,"wires":[["93356e17.0172b"]]},{"id":"4f60be11.bb957","type":"mysqlTSDV","z":"33010803.e6c778","mydb":"b7dfc222.c1566","name":"DAS layout","x":670,"y":800,"wires":[["aaf3db8d.640ce8"]]},{"id":"b8b6b21.6a94d5","type":"inject","z":"33010803.e6c778","name":"Get das info from db","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":240,"y":880,"wires":[["7b276ee0.45009","2ad106c4.273a8a"]]},{"id":"4036082.cd2c1f8","type":"link out","z":"33010803.e6c778","name":"","links":["d2d75ce5.a07c1","63a58c09.4ce4d4","7524051c.80319c"],"x":375,"y":1460,"wires":[]},{"id":"525b3ebc.540a7","type":"inject","z":"33010803.e6c778","name":"","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"$env('DAS_barcode')","payloadType":"jsonata","x":230,"y":1660,"wires":[["94f7b05a.9fd2f"]]},{"id":"ebb6b77b.f1ce38","type":"jimp-image","z":"33010803.e6c778","name":"","data":"payload","dataType":"msg","ret":"img","parameter1":"416","parameter1Type":"num","parameter2":"585","parameter2Type":"num","parameter3":"400","parameter3Type":"num","parameter4":"60","parameter4Type":"num","parameter5":"","parameter5Type":"msg","parameter6":"","parameter6Type":"msg","parameter7":"","parameter7Type":"msg","parameter8":"","parameter8Type":"msg","sendProperty":"payload","sendPropertyType":"msg","parameterCount":4,"jimpFunction":"crop","selectedJimpFunction":{"name":"crop","fn":"crop","description":"crop to the given region","parameters":[{"name":"x","type":"num","required":true,"hint":"the x coordinate to crop form"},{"name":"y","type":"num","required":true,"hint":"the y coordinate to crop form"},{"name":"w","type":"num","required":true,"hint":"the width of the crop region"},{"name":"h","type":"num","required":true,"hint":"the height of the crop region"}]},"x":620,"y":1660,"wires":[["367f4093.46712","ebb7b492.927268"]]},{"id":"94f7b05a.9fd2f","type":"jimp-image","z":"33010803.e6c778","name":"","data":"payload","dataType":"msg","ret":"img","parameter1":"850","parameter1Type":"num","parameter2":"850","parameter2Type":"num","parameter3":"RESIZE_NEAREST_NEIGHBOR","parameter3Type":"resizeMode","parameter4":"50","parameter4Type":"num","parameter5":"","parameter5Type":"msg","parameter6":"","parameter6Type":"msg","parameter7":"","parameter7Type":"msg","parameter8":"","parameter8Type":"msg","sendProperty":"payload","sendPropertyType":"msg","parameterCount":3,"jimpFunction":"resize","selectedJimpFunction":{"name":"resize","fn":"resize","description":"resize the image. One of the w or h parameters can be set to automatic (\"Jimp.AUTO\" or -1).","parameters":[{"name":"w","type":"num|auto","required":true,"hint":"the width to resize the image to (or \"Jimp.AUTO\" or -1)"},{"name":"h","type":"num|auto","required":true,"hint":"the height to resize the image to (or \"Jimp.AUTO\" or -1)"},{"name":"mode","type":"resizeMode","required":false,"hint":"a scaling method (e.g. Jimp.RESIZE_BEZIER)"}]},"x":450,"y":1660,"wires":[["ebb6b77b.f1ce38"]]},{"id":"367f4093.46712","type":"Barcode Decoder","z":"33010803.e6c778","name":"","data":"payload","dataType":"msg","tryharder":"true","tryharderType":"bool","QR_CODE":true,"DATA_MATRIX":true,"PDF_417":true,"EAN_8":true,"EAN_13":true,"CODE_39":true,"CODE_128":true,"ITF":true,"RSS_14":true,"x":800,"y":1640,"wires":[["49fd3ebf.af7ca"]]},{"id":"ebb7b492.927268","type":"image viewer","z":"33010803.e6c778","name":"","width":"500","data":"payload","dataType":"msg","x":770,"y":1680,"wires":[[]]},{"id":"bd13f6c1.f9c438","type":"link in","z":"33010803.e6c778","name":"Update Log tables","links":["e95dbf16.c12c7","1c7b1bbe.7b6c14"],"x":290,"y":200,"wires":[["8a832fda.408cf"]],"l":true},{"id":"fc86a554.491248","type":"inject","z":"33010803.e6c778","name":"Read config file barcode folder","props":[{"p":"payload"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"$env('DAS_barcode')","payloadType":"jsonata","x":350,"y":700,"wires":[["9b7b5fb6.40de4"]]},{"id":"9b7b5fb6.40de4","type":"function","z":"33010803.e6c778","name":"Save config file das2 port","func":"flow.set('barcodeFolder', msg.payload);\nreturn;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":650,"y":700,"wires":[[]]},{"id":"63a58c09.4ce4d4","type":"link in","z":"33010803.e6c778","name":"","links":["4036082.cd2c1f8"],"x":315,"y":840,"wires":[["2ad106c4.273a8a","7b276ee0.45009"]]},{"id":"7524051c.80319c","type":"link in","z":"33010803.e6c778","name":"","links":["4036082.cd2c1f8"],"x":335,"y":380,"wires":[["d2875606.d48fc8","dba35c60.1d40b","79fc8a71.2567e4","b604911b.91833"]]},{"id":"49fd3ebf.af7ca","type":"function","z":"33010803.e6c778","name":"update trayid","func":"let commonFunctionsDas = flow.get('commonFunctionsDas');\nlet drawMsg = [];\ndrawMsg.push(commonFunctionsDas.updateTrayID('#tray_' + msg.trayId + '_id', msg.payload.text));\nflow.set('tray_' + msg.trayId + '_id',msg.payload.text)\nmsg.payload = drawMsg;\n\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":800,"y":1600,"wires":[["7dcd1aa9.de3134"]]},{"id":"567e62d5.f80fac","type":"link in","z":"33010803.e6c778","name":"","links":["ce615417.869598"],"x":155,"y":1560,"wires":[["e26c8bfb.fd43f8"]]},{"id":"e26c8bfb.fd43f8","type":"function","z":"33010803.e6c778","name":"update tray id","func":"let command = msg.payload;\nif(command.par3 === 'green') {\n    msg.trayId = command.par2.substr(0,2);\n    msg.payload = flow.get('barcodeFolder');\n    return [msg,];  \n} else {\n    let commonFunctionsDas = flow.get('commonFunctionsDas');\n    let drawMsg = [];\n    drawMsg.push(commonFunctionsDas.updateTrayID('#tray_' + command.par2.substr(0,2) + '_id', \" \"));\n    flow.set('tray_' + command.par2.substr(0,2) + '_id', \" \")\n    msg.payload = drawMsg;\n    return [,msg];\n}\n","outputs":2,"noerr":0,"initialize":"","finalize":"","x":270,"y":1560,"wires":[["94f7b05a.9fd2f"],["7dcd1aa9.de3134"]]},{"id":"cb0c7afe.728748","type":"function","z":"33010803.e6c778","name":"Reset Tray","func":"let arrBuilder = flow.get('arrBuilder');\nfor(let i = 0; i < arrBuilder.length; i++) {\n    flow.set('tray_' + arrBuilder[i][4] + '_id', \" \");\n}\nlet listTray = flow.get('listTrayDb');\n\nfor (let i = 0; i < listTray.length; i++){\n    flow.set(listTray[i][2] + \"_LED\",\"gray\");\n}\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","x":610,"y":460,"wires":[[]]},{"id":"7dcd1aa9.de3134","type":"link out","z":"33010803.e6c778","name":"","links":["bda8d99f.780bd8"],"x":865,"y":1560,"wires":[]}]